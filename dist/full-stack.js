/*! For license information please see full-stack.js.LICENSE.txt */
(()=>{"use strict";var t={444:(t,e,n)=>{n.d(e,{BH:()=>o,G6:()=>g,L:()=>i,LL:()=>v,Mn:()=>m,Sg:()=>a,ZR:()=>w,b$:()=>l,d:()=>d,eu:()=>y,hl:()=>p,m9:()=>T,ru:()=>h,uI:()=>u,vZ:()=>I,w1:()=>f,z$:()=>c});const r=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const s=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(r(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],i=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==i||null==o||null==a)throw Error();const c=s<<2|i>>4;if(r.push(c),64!==o){const t=i<<4&240|o>>2;if(r.push(t),64!==a){const t=o<<6&192|a;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},i=function(t){return function(t){const e=r(t);return s.encodeByteArray(e,!0)}(t).replace(/\./g,"")};class o{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function a(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function u(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(c())}function h(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function l(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function d(){return c().indexOf("Electron/")>=0}function f(){const t=c();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function m(){return c().indexOf("MSAppHost/")>=0}function g(){return!function(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function p(){return"object"==typeof indexedDB}function y(){return new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class w extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,v.prototype.create)}}class v{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],i=s?function(t,e){return t.replace(b,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new w(r,o,n)}}const b=/\{\$([^}]+)}/g;function I(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(E(n)&&E(i)){if(!I(n,i))return!1}else if(n!==i)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function E(t){return null!==t&&"object"==typeof t}function T(t){return t&&t._delegate?t._delegate:t}},503:(t,e,n)=>{n.r(e),n.d(e,{FirebaseError:()=>r.ZR,SDK_VERSION:()=>r.Jn,_DEFAULT_ENTRY_NAME:()=>r.l4,_addComponent:()=>r.H9,_addOrOverwriteComponent:()=>r.Vr,_apps:()=>r.Af,_clearComponents:()=>r.Z8,_components:()=>r.lz,_getProvider:()=>r.qX,_registerComponent:()=>r.Xd,_removeServiceInstance:()=>r.wN,deleteApp:()=>r.P2,getApp:()=>r.Mq,getApps:()=>r.C6,initializeApp:()=>r.ZF,onLog:()=>r.TP,registerVersion:()=>r.KN,setLogLevel:()=>r.Ub});var r=n(389);(0,r.KN)("firebase","9.9.2","app")},591:(t,e,n)=>{n.r(e),n.d(e,{AbstractUserDataWriter:()=>Am,Bytes:()=>Tf,CACHE_SIZE_UNLIMITED:()=>rf,CollectionReference:()=>Qd,DocumentReference:()=>zd,DocumentSnapshot:()=>nm,FieldPath:()=>If,FieldValue:()=>Sf,Firestore:()=>sf,FirestoreError:()=>Mr,GeoPoint:()=>Df,LoadBundleTask:()=>nf,Query:()=>Hd,QueryConstraint:()=>cm,QueryDocumentSnapshot:()=>rm,QuerySnapshot:()=>sm,SnapshotMetadata:()=>em,Timestamp:()=>Wr,Transaction:()=>Qm,WriteBatch:()=>km,_DatabaseId:()=>Ws,_DocumentKey:()=>es,_EmptyAppCheckTokenProvider:()=>Kr,_EmptyAuthCredentialsProvider:()=>Vr,_FieldPath:()=>ts,_cast:()=>qd,_debugAssert:()=>Nr,_isBase64Available:()=>Bs,_logWarn:()=>xr,_validateIsNotUsedTogether:()=>Fd,addDoc:()=>Km,arrayRemove:()=>Zm,arrayUnion:()=>Jm,clearIndexedDbPersistence:()=>ff,collection:()=>Wd,collectionGroup:()=>Xd,connectFirestoreEmulator:()=>$d,deleteDoc:()=>jm,deleteField:()=>Xm,disableNetwork:()=>pf,doc:()=>Yd,documentId:()=>Ef,enableIndexedDbPersistence:()=>hf,enableMultiTabIndexedDbPersistence:()=>lf,enableNetwork:()=>gf,endAt:()=>Em,endBefore:()=>Im,ensureFirestoreConfigured:()=>cf,executeWrite:()=>zm,getDoc:()=>Mm,getDocFromCache:()=>Lm,getDocFromServer:()=>Vm,getDocs:()=>Fm,getDocsFromCache:()=>Pm,getDocsFromServer:()=>Bm,getFirestore:()=>af,increment:()=>tg,initializeFirestore:()=>of,limit:()=>gm,limitToLast:()=>pm,loadBundle:()=>wf,namedQuery:()=>vf,onSnapshot:()=>Gm,onSnapshotsInSync:()=>$m,orderBy:()=>fm,query:()=>um,queryEqual:()=>Zd,refEqual:()=>Jd,runTransaction:()=>Wm,serverTimestamp:()=>Ym,setDoc:()=>Um,setIndexConfiguration:()=>ng,setLogLevel:()=>Tr,snapshotEqual:()=>om,startAfter:()=>vm,startAt:()=>wm,terminate:()=>yf,updateDoc:()=>qm,waitForPendingWrites:()=>mf,where:()=>lm,writeBatch:()=>eg});var r,s=n(389),i=n(463),o=n(333),a=n(444),c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},u={},h=h||{},l=c||self;function d(){}function f(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function m(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),p=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function w(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function v(t,e,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:w).apply(null,arguments)}function b(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function I(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function E(){this.s=this.s,this.o=this.o}var T={};E.prototype.s=!1,E.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,g)&&t[g]||(t[g]=++p)}(this);delete T[t]}},E.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const S=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},D=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){const r=t.length,s="string"==typeof t?t.split(""):t;for(let i=0;i<r;i++)i in s&&e.call(n,s[i],i,t)};function x(t){return Array.prototype.concat.apply([],arguments)}function _(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function A(t){return/^[\s\xa0]*$/.test(t)}var C,N=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function k(t,e){return-1!=t.indexOf(e)}function O(t,e){return t<e?-1:t>e?1:0}t:{var M=l.navigator;if(M){var R=M.userAgent;if(R){C=R;break t}}C=""}function L(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function V(t){const e={};for(const n in t)e[n]=t[n];return e}var F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<F.length;e++)n=F[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function B(t){return B[" "](t),t}B[" "]=d;var U,q,j=k(C,"Opera"),K=k(C,"Trident")||k(C,"MSIE"),G=k(C,"Edge"),$=G||K,z=k(C,"Gecko")&&!(k(C.toLowerCase(),"webkit")&&!k(C,"Edge"))&&!(k(C,"Trident")||k(C,"MSIE"))&&!k(C,"Edge"),H=k(C.toLowerCase(),"webkit")&&!k(C,"Edge");function Q(){var t=l.document;return t?t.documentMode:void 0}t:{var W="",X=(q=C,z?/rv:([^\);]+)(\)|;)/.exec(q):G?/Edge\/([\d\.]+)/.exec(q):K?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(q):H?/WebKit\/(\S+)/.exec(q):j?/(?:Version)[ \/]?(\S+)/.exec(q):void 0);if(X&&(W=X?X[1]:""),K){var Y=Q();if(null!=Y&&Y>parseFloat(W)){U=String(Y);break t}}U=W}var J,Z={};function tt(){return t=Z,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let t=0;const e=N(String(U)).split("."),n=N("9").split("."),r=Math.max(e.length,n.length);for(let o=0;0==t&&o<r;o++){var s=e[o]||"",i=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;t=O(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||O(0==s[2].length,0==i[2].length)||O(s[2],i[2]),s=s[3],i=i[3]}while(0==t)}return 0<=t}();var t}l.document&&K?J=Q()||parseInt(U,10)||void 0:J=void 0;var et=J,nt=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",d,e),l.removeEventListener("test",d,e)}catch(t){}return t}();function rt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function st(t,e){if(rt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(z){t:{try{B(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:it[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&st.Z.h.call(this)}}rt.prototype.h=function(){this.defaultPrevented=!0},I(st,rt);var it={2:"touch",3:"pen",4:"mouse"};st.prototype.h=function(){st.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ot="closure_listenable_"+(1e6*Math.random()|0),at=0;function ct(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=s,this.key=++at,this.ca=this.fa=!1}function ut(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function ht(t){this.src=t,this.g={},this.h=0}function lt(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=S(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(ut(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function dt(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.ca&&i.listener==e&&i.capture==!!n&&i.ia==r)return s}return-1}ht.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=dt(t,e,r,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new ct(e,this.src,i,!!r,s)).fa=n,t.push(e)),e};var ft="closure_lm_"+(1e6*Math.random()|0),mt={};function gt(t,e,n,r,s){if(r&&r.once)return yt(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)gt(t,e[i],n,r,s);return null}return n=St(n),t&&t[ot]?t.N(e,n,m(r)?!!r.capture:!!r,s):pt(t,e,n,!1,r,s)}function pt(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=m(s)?!!s.capture:!!s,a=Et(t);if(a||(t[ft]=a=new ht(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){var t=It;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)nt||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(bt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function yt(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)yt(t,e[i],n,r,s);return null}return n=St(n),t&&t[ot]?t.O(e,n,m(r)?!!r.capture:!!r,s):pt(t,e,n,!0,r,s)}function wt(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)wt(t,e[i],n,r,s);else r=m(r)?!!r.capture:!!r,n=St(n),t&&t[ot]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=dt(i=t.g[e],n,r,s))&&(ut(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=Et(t))&&(e=t.g[e.toString()],t=-1,e&&(t=dt(e,n,r,s)),(n=-1<t?e[t]:null)&&vt(n))}function vt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[ot])lt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(bt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Et(e))?(lt(n,t),0==n.h&&(n.src=null,e[ft]=null)):ut(t)}}}function bt(t){return t in mt?mt[t]:mt[t]="on"+t}function It(t,e){if(t.ca)t=!0;else{e=new st(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&vt(t),t=n.call(r,e)}return t}function Et(t){return(t=t[ft])instanceof ht?t:null}var Tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function St(t){return"function"==typeof t?t:(t[Tt]||(t[Tt]=function(e){return t.handleEvent(e)}),t[Tt])}function Dt(){E.call(this),this.i=new ht(this),this.P=this,this.I=null}function xt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new rt(e,t);else if(e instanceof rt)e.target=e.target||t;else{var s=e;P(e=new rt(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=_t(o,r,!0,e)&&s}if(s=_t(o=e.g=t,r,!0,e)&&s,s=_t(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=_t(o=e.g=n[i],r,!1,e)&&s}function _t(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&lt(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}I(Dt,E),Dt.prototype[ot]=!0,Dt.prototype.removeEventListener=function(t,e,n,r){wt(this,t,e,n,r)},Dt.prototype.M=function(){if(Dt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)ut(n[r]);delete e.g[t],e.h--}}this.I=null},Dt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Dt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var At=l.JSON.stringify;function Ct(){var t=Vt;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Nt,kt=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Ot),(t=>t.reset()));class Ot{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Mt(t){l.setTimeout((()=>{throw t}),0)}function Rt(t,e){Nt||function(){var t=l.Promise.resolve(void 0);Nt=function(){t.then(Ft)}}(),Lt||(Nt(),Lt=!0),Vt.add(t,e)}var Lt=!1,Vt=new class{constructor(){this.h=this.g=null}add(t,e){const n=kt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function Ft(){for(var t;t=Ct();){try{t.h.call(t.g)}catch(t){Mt(t)}var e=kt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Lt=!1}function Pt(t,e){Dt.call(this),this.h=t||1,this.g=e||l,this.j=v(this.kb,this),this.l=Date.now()}function Bt(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Ut(t,e,n){if("function"==typeof t)n&&(t=v(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=v(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function qt(t){t.g=Ut((()=>{t.g=null,t.i&&(t.i=!1,qt(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}I(Pt,Dt),(r=Pt.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),xt(this,"tick"),this.da&&(Bt(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Pt.Z.M.call(this),Bt(this),delete this.g};class jt extends E{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:qt(this)}M(){super.M(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Kt(t){E.call(this),this.h=t,this.g={}}I(Kt,E);var Gt=[];function $t(t,e,n,r){Array.isArray(n)||(n&&(Gt[0]=n.toString()),n=Gt);for(var s=0;s<n.length;s++){var i=gt(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function zt(t){L(t.g,(function(t,e){this.g.hasOwnProperty(e)&&vt(t)}),t),t.g={}}function Ht(){this.g=!0}function Qt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return At(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Kt.prototype.M=function(){Kt.Z.M.call(this),zt(this)},Kt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ht.prototype.Aa=function(){this.g=!1},Ht.prototype.info=function(){};var Wt={},Xt=null;function Yt(){return Xt=Xt||new Dt}function Jt(t){rt.call(this,Wt.Ma,t)}function Zt(t){const e=Yt();xt(e,new Jt(e,t))}function te(t,e){rt.call(this,Wt.STAT_EVENT,t),this.stat=e}function ee(t){const e=Yt();xt(e,new te(e,t))}function ne(t,e){rt.call(this,Wt.Na,t),this.size=e}function re(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){t()}),e)}Wt.Ma="serverreachability",I(Jt,rt),Wt.STAT_EVENT="statevent",I(te,rt),Wt.Na="timingevent",I(ne,rt);var se={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ie={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function oe(){}function ae(t){return t.h||(t.h=t.i())}function ce(){}oe.prototype.h=null;var ue,he={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function le(){rt.call(this,"d")}function de(){rt.call(this,"c")}function fe(){}function me(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new Kt(this),this.P=pe,t=$?125:void 0,this.W=new Pt(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ge}function ge(){this.i=null,this.g="",this.h=!1}I(le,rt),I(de,rt),I(fe,oe),fe.prototype.g=function(){return new XMLHttpRequest},fe.prototype.i=function(){return{}},ue=new fe;var pe=45e3,ye={},we={};function ve(t,e,n){t.K=1,t.v=je(Ve(e)),t.s=n,t.U=!0,be(t,null)}function be(t,e){t.F=Date.now(),Se(t),t.A=Ve(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),en(n.h,"t",r),t.C=0,n=t.l.H,t.h=new ge,t.g=nr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new jt(v(t.Ia,t,t.g),t.O)),$t(t.V,t.g,"readystatechange",t.gb),e=t.H?V(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Zt(1),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ie(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Ee(t,e,n){let r,s=!0;for(;!t.I&&t.C<n.length;){if(r=Te(t,n),r==we){4==e&&(t.o=4,ee(14),s=!1),Qt(t.j,t.m,null,"[Incomplete Response]");break}if(r==ye){t.o=4,ee(15),Qt(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}Qt(t.j,t.m,r,null),Ce(t,r)}Ie(t)&&r!=we&&r!=ye&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ee(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qn(e),e.L=!0,ee(11))):(Qt(t.j,t.m,n,"[Invalid Chunked Response]"),Ae(t),_e(t))}function Te(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?we:(n=Number(e.substring(n,r)),isNaN(n)?ye:(r+=1)+n>e.length?we:(e=e.substr(r,n),t.C=r+n,e))}function Se(t){t.Y=Date.now()+t.P,De(t,t.P)}function De(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=re(v(t.eb,t),e)}function xe(t){t.B&&(l.clearTimeout(t.B),t.B=null)}function _e(t){0==t.l.G||t.I||Yn(t.l,t)}function Ae(t){xe(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Bt(t.W),zt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Ce(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||cn(n.i,t)))if(n.I=t.N,!t.J&&cn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Xn(n),Bn(n)}Hn(n),ee(18)}}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&0==n.A&&!n.v&&(n.v=re(v(n.ab,n),6e3));if(1>=an(n.i)&&n.ka){try{n.ka()}catch(t){}n.ka=void 0}}else Zn(n,11)}else if((t.J||n.g==t)&&Xn(n),!A(e))for(s=n.Ca.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const e=u[3];null!=e&&(n.ma=e,n.h.info("VER="+n.ma));const s=u[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.i;!i.g&&(k(t,"spdy")||k(t,"quic")||k(t,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(un(i,i.h),i.h=null))}if(r.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.sa=t,qe(r.F,r.D,t))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=t;if((r=n).oa=er(r,r.H?r.la:null,r.W),o.J){hn(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(xe(a),Se(a)),r.g=o}else zn(r);0<n.l.length&&jn(n)}else"stop"!=u[0]&&"close"!=u[0]||Zn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Zn(n,7):Pn(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}Zt(4)}catch(t){}}function Ne(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(f(t)||"string"==typeof t)D(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(f(t)||"string"==typeof t){n=[];for(var r=t.length,s=0;s<r;s++)n.push(s)}else for(s in n=[],r=0,t)n[r++]=s;r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(f(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length;for(var i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}}function ke(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ke)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Oe(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Me(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var s={};for(n=e=0;e<t.g.length;)Me(s,r=t.g[e])||(t.g[n++]=r,s[r]=1),e++;t.g.length=n}}function Me(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(r=me.prototype).setTimeout=function(t){this.P=t},r.gb=function(t){t=t.target;const e=this.L;e&&3==Mn(t)?e.l():this.Ia(t)},r.Ia=function(t){try{if(t==this.g)t:{const h=Mn(this.g);var e=this.g.Da();const d=this.g.ba();if(!(3>h)&&(3!=h||$||this.g&&(this.h.h||this.g.ga()||Rn(this.g)))){this.I||4!=h||7==e||Zt(8==e||0>=d?3:2),xe(this);var n=this.g.ba();this.N=n;e:if(Ie(this)){var r=Rn(this.g);t="";var s=r.length,i=4==Mn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ae(this),_e(this);var o="";break e}this.h.i=new l.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,ee(12),Ae(this),_e(this);break t}Qt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ce(this,n)}this.U?(Ee(this,h,o),$&&this.i&&3==h&&($t(this.V,this.W,"tick",this.fb),this.W.start())):(Qt(this.j,this.m,o,null),Ce(this,o)),4==h&&Ae(this),this.i&&!this.I&&(4==h?Yn(this.l,this):(this.i=!1,Se(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,ee(12)):(this.o=0,ee(13)),Ae(this),_e(this)}}}catch(t){}},r.fb=function(){if(this.g){var t=Mn(this.g),e=this.g.ga();this.C<e.length&&(xe(this),Ee(this,t,e),this.i&&4!=t&&Se(this))}},r.cancel=function(){this.I=!0,Ae(this)},r.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(Zt(3),ee(17)),Ae(this),this.o=2,_e(this)):De(this,this.Y-t)},(r=ke.prototype).R=function(){Oe(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},r.T=function(){return Oe(this),this.g.concat()},r.get=function(t,e){return Me(this.h,t)?this.h[t]:e},r.set=function(t,e){Me(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},r.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);t.call(e,i,s,this)}};var Re=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Le(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Le){this.g=void 0!==e?e:t.g,Fe(this,t.j),this.s=t.s,Pe(this,t.i),Be(this,t.m),this.l=t.l,e=t.h;var n=new Ye;n.i=e.i,e.g&&(n.g=new ke(e.g),n.h=e.h),Ue(this,n),this.o=t.o}else t&&(n=String(t).match(Re))?(this.g=!!e,Fe(this,n[1]||"",!0),this.s=Ke(n[2]||""),Pe(this,n[3]||"",!0),Be(this,n[4]),this.l=Ke(n[5]||"",!0),Ue(this,n[6]||"",!0),this.o=Ke(n[7]||"")):(this.g=!!e,this.h=new Ye(null,this.g))}function Ve(t){return new Le(t)}function Fe(t,e,n){t.j=n?Ke(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Pe(t,e,n){t.i=n?Ke(e,!0):e}function Be(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ue(t,e,n){e instanceof Ye?(t.h=e,function(t,e){e&&!t.j&&(Je(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Ze(this,e),en(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=Ge(e,We)),t.h=new Ye(e,t.g))}function qe(t,e,n){t.h.set(e,n)}function je(t){return qe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Ke(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ge(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,$e),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function $e(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Le.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ge(e,ze,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Ge(e,ze,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ge(n,"/"==n.charAt(0)?Qe:He,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Ge(n,Xe)),t.join("")};var ze=/[#\/\?@]/g,He=/[#\?:]/g,Qe=/[#\?]/g,We=/[#\?@]/g,Xe=/#/g;function Ye(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Je(t){t.g||(t.g=new ke,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Ze(t,e){Je(t),e=nn(t,e),Me(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Me((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Oe(t)))}function tn(t,e){return Je(t),e=nn(t,e),Me(t.g.h,e)}function en(t,e,n){Ze(t,e),0<n.length&&(t.i=null,t.g.set(nn(t,e),_(n)),t.h+=n.length)}function nn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function rn(t){this.l=t||sn,t=l.PerformanceNavigationTiming?0<(t=l.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(l.g&&l.g.Ea&&l.g.Ea()&&l.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(r=Ye.prototype).add=function(t,e){Je(this),this.i=null,t=nn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},r.forEach=function(t,e){Je(this),this.g.forEach((function(n,r){D(n,(function(n){t.call(e,n,r,this)}),this)}),this)},r.T=function(){Je(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var s=t[r],i=0;i<s.length;i++)n.push(e[r]);return n},r.R=function(t){Je(this);var e=[];if("string"==typeof t)tn(this,t)&&(e=x(e,this.g.get(nn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=x(e,t[n])}return e},r.set=function(t,e){return Je(this),this.i=null,tn(this,t=nn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},r.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),t.push(o)}}return this.i=t.join("&")};var sn=10;function on(t){return!!t.h||!!t.g&&t.g.size>=t.j}function an(t){return t.h?1:t.g?t.g.size:0}function cn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function un(t,e){t.g?t.g.add(e):t.h=e}function hn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ln(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return _(t.i)}function dn(){}function fn(){this.g=new dn}function mn(t,e,n){const r=n||"";try{Ne(t,(function(t,n){let s=t;m(t)&&(s=At(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function gn(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function pn(t){this.l=t.$b||null,this.j=t.ib||!1}function yn(t,e){Dt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=wn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}rn.prototype.cancel=function(){if(this.i=ln(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},dn.prototype.stringify=function(t){return l.JSON.stringify(t,void 0)},dn.prototype.parse=function(t){return l.JSON.parse(t,void 0)},I(pn,oe),pn.prototype.g=function(){return new yn(this.l,this.j)},pn.prototype.i=function(t){return function(){return t}}({}),I(yn,Dt);var wn=0;function vn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function bn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,In(t)}function In(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(r=yn.prototype).open=function(t,e){if(this.readyState!=wn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,In(this)},r.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||l).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,bn(this)),this.readyState=wn},r.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,In(this)),this.g&&(this.readyState=3,In(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==l.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;vn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?bn(this):In(this),3==this.readyState&&vn(this)}},r.Ua=function(t){this.g&&(this.response=this.responseText=t,bn(this))},r.Ta=function(t){this.g&&(this.response=t,bn(this))},r.ha=function(){this.g&&bn(this)},r.setRequestHeader=function(t,e){this.v.append(t,e)},r.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(yn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var En=l.JSON.parse;function Tn(t){Dt.call(this),this.headers=new ke,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Sn,this.K=this.L=!1}I(Tn,Dt);var Sn="",Dn=/^https?$/i,xn=["POST","PUT"];function _n(t){return"content-type"==t.toLowerCase()}function An(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Cn(t),kn(t)}function Cn(t){t.D||(t.D=!0,xt(t,"complete"),xt(t,"error"))}function Nn(t){if(t.h&&void 0!==h&&(!t.C[1]||4!=Mn(t)||2!=t.ba()))if(t.v&&4==Mn(t))Ut(t.Fa,0,t);else if(xt(t,"readystatechange"),4==Mn(t)){t.h=!1;try{const a=t.ba();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===a){var s=String(t.H).match(Re)[1]||null;if(!s&&l.self&&l.self.location){var i=l.self.location.protocol;s=i.substr(0,i.length-1)}r=!Dn.test(s?s.toLowerCase():"")}n=r}if(n)xt(t,"complete"),xt(t,"success");else{t.m=6;try{var o=2<Mn(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.ba()+"]",Cn(t)}}finally{kn(t)}}}function kn(t,e){if(t.g){On(t);const n=t.g,r=t.C[0]?d:null;t.g=null,t.C=null,e||xt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function On(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(l.clearTimeout(t.A),t.A=null)}function Mn(t){return t.g?t.g.readyState:0}function Rn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Sn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ln(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){let e="";return L(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):qe(t,e,n))}function Vn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Fn(t){this.za=0,this.l=[],this.h=new Ht,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Vn("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Vn("baseRetryDelayMs",5e3,t),this.$a=Vn("retryDelaySeedMs",1e4,t),this.Ya=Vn("forwardChannelMaxRetries",2,t),this.ra=Vn("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new rn(t&&t.concurrentRequestLimit),this.Ca=new fn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Pn(t){if(Un(t),3==t.G){var e=t.V++,n=Ve(t.F);qe(n,"SID",t.J),qe(n,"RID",e),qe(n,"TYPE","terminate"),Gn(t,n),(e=new me(t,t.h,e,void 0)).K=2,e.v=je(Ve(n)),n=!1,l.navigator&&l.navigator.sendBeacon&&(n=l.navigator.sendBeacon(e.v.toString(),"")),!n&&l.Image&&((new Image).src=e.v,n=!0),n||(e.g=nr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Se(e)}tr(t)}function Bn(t){t.g&&(Qn(t),t.g.cancel(),t.g=null)}function Un(t){Bn(t),t.u&&(l.clearTimeout(t.u),t.u=null),Xn(t),t.i.cancel(),t.m&&("number"==typeof t.m&&l.clearTimeout(t.m),t.m=null)}function qn(t,e){t.l.push(new class{constructor(t,e){this.h=t,this.g=e}}(t.Za++,e)),3==t.G&&jn(t)}function jn(t){on(t.i)||t.m||(t.m=!0,Rt(t.Ha,t),t.C=0)}function Kn(t,e){var n;n=e?e.m:t.V++;const r=Ve(t.F);qe(r,"SID",t.J),qe(r,"RID",n),qe(r,"AID",t.U),Gn(t,r),t.o&&t.s&&Ln(r,t.o,t.s),n=new me(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=$n(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),un(t.i,n),ve(n,r,e)}function Gn(t,e){t.j&&Ne({},(function(t,n){qe(e,n,t)}))}function $n(t,e,n){n=Math.min(t.l.length,n);var r=t.j?v(t.j.Oa,t.j,t):null;t:{var s=t.l;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=e,0>n)e=Math.max(0,s[o].h-100),i=!1;else try{mn(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.l.splice(0,n),e.D=t,r}function zn(t){t.g||t.u||(t.Y=1,Rt(t.Ga,t),t.A=0)}function Hn(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=re(v(t.Ga,t),Jn(t,t.A)),t.A++,0))}function Qn(t){null!=t.B&&(l.clearTimeout(t.B),t.B=null)}function Wn(t){t.g=new me(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Ve(t.oa);qe(e,"RID","rpc"),qe(e,"SID",t.J),qe(e,"CI",t.N?"0":"1"),qe(e,"AID",t.U),Gn(t,e),qe(e,"TYPE","xmlhttp"),t.o&&t.s&&Ln(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=je(Ve(e)),n.s=null,n.U=!0,be(n,t)}function Xn(t){null!=t.v&&(l.clearTimeout(t.v),t.v=null)}function Yn(t,e){var n=null;if(t.g==e){Xn(t),Qn(t),t.g=null;var r=2}else{if(!cn(t.i,e))return;n=e.D,hn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;xt(r=Yt(),new ne(r,n,e,s)),jn(t)}else zn(t);else if(3==(s=e.o)||0==s&&0<t.I||!(1==r&&function(t,e){return!(an(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=re(v(t.Ha,t,e),Jn(t,t.C)),t.C++,0)))}(t,e)||2==r&&Hn(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:Zn(t,5);break;case 4:Zn(t,10);break;case 3:Zn(t,6);break;default:Zn(t,2)}}function Jn(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Zn(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=v(t.jb,t);n||(n=new Le("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Fe(n,"https"),je(n)),function(t,e){const n=new Ht;if(l.Image){const r=new Image;r.onload=b(gn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=b(gn,n,r,"TestLoadImage: error",!1,e),r.onabort=b(gn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=b(gn,n,r,"TestLoadImage: timeout",!1,e),l.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else ee(2);t.G=0,t.j&&t.j.va(e),tr(t),Un(t)}function tr(t){t.G=0,t.I=-1,t.j&&(0==ln(t.i).length&&0==t.l.length||(t.i.i.length=0,_(t.l),t.l.length=0),t.j.ua())}function er(t,e,n){let r=function(t){return t instanceof Le?Ve(t):new Le(t,void 0)}(n);if(""!=r.i)e&&Pe(r,e+"."+r.i),Be(r,r.m);else{const t=l.location;r=function(t,e,n,r){var s=new Le(null,void 0);return t&&Fe(s,t),e&&Pe(s,e),n&&Be(s,n),r&&(s.l=r),s}(t.protocol,e?e+"."+t.hostname:t.hostname,+t.port,n)}return t.aa&&L(t.aa,(function(t,e){qe(r,e,t)})),e=t.D,n=t.sa,e&&n&&qe(r,e,n),qe(r,"VER",t.ma),Gn(t,r),r}function nr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Tn(new pn({ib:!0})):new Tn(t.qa)).L=t.H,e}function rr(){}function sr(){if(K&&!(10<=Number(et)))throw Error("Environmental error: no available transport.")}function ir(t,e){Dt.call(this),this.g=new Fn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!A(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!A(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new cr(this)}function or(t){le.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function ar(){de.call(this),this.status=1}function cr(t){this.g=t}(r=Tn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ue.g(),this.C=this.u?ae(this.u):ae(ue),this.g.onreadystatechange=v(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void An(this,t)}t=n||"";const s=new ke(this.headers);r&&Ne(r,(function(t,e){s.set(e,t)})),r=function(t){t:{var e=_n;const n=t.length,r="string"==typeof t?t.split(""):t;for(let s=0;s<n;s++)if(s in r&&e.call(void 0,r[s],s,t)){e=s;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(s.T()),n=l.FormData&&t instanceof l.FormData,!(0<=S(xn,e))||r||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{On(this),0<this.B&&((this.K=function(t){return K&&tt()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=v(this.pa,this)):this.A=Ut(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){An(this,t)}},r.pa=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,xt(this,"timeout"),this.abort(8))},r.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,xt(this,"complete"),xt(this,"abort"),kn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),kn(this,!0)),Tn.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?Nn(this):this.cb())},r.cb=function(){Nn(this)},r.ba=function(){try{return 2<Mn(this)?this.g.status:-1}catch(t){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),En(e)}},r.Da=function(){return this.m},r.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=Fn.prototype).ma=8,r.G=1,r.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},r.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new me(this,this.h,t,void 0);let i=this.s;if(this.P&&(i?(i=V(i),P(i,this.P)):i=this.P),null===this.o&&(s.H=i),this.ja)t:{for(var e=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.l.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=$n(this,s,e),qe(n=Ve(this.F),"RID",t),qe(n,"CVER",22),this.D&&qe(n,"X-HTTP-Session-Id",this.D),Gn(this,n),this.o&&i&&Ln(n,this.o,i),un(this.i,s),this.Ra&&qe(n,"TYPE","init"),this.ja?(qe(n,"$req",e),qe(n,"SID","null"),s.$=!0,ve(s,n,null)):ve(s,n,e),this.G=2}}else 3==this.G&&(t?Kn(this,t):0==this.l.length||on(this.i)||Kn(this))},r.Ga=function(){if(this.u=null,Wn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=re(v(this.bb,this),t)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ee(10),Bn(this),Wn(this))},r.ab=function(){null!=this.v&&(this.v=null,Bn(this),Hn(this),ee(19))},r.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ee(2)):(this.h.info("Failed to ping google.com"),ee(1))},(r=rr.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},sr.prototype.g=function(t,e){return new ir(t,e)},I(ir,Dt),ir.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Rt(v(t.hb,t,e))),ee(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=er(t,null,t.W),jn(t)},ir.prototype.close=function(){Pn(this.g)},ir.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,qn(this.g,e)}else this.v?((e={}).__data__=At(t),qn(this.g,e)):qn(this.g,t)},ir.prototype.M=function(){this.g.j=null,delete this.j,Pn(this.g),delete this.g,ir.Z.M.call(this)},I(or,le),I(ar,de),I(cr,rr),cr.prototype.xa=function(){xt(this.g,"a")},cr.prototype.wa=function(t){xt(this.g,new or(t))},cr.prototype.va=function(t){xt(this.g,new ar(t))},cr.prototype.ua=function(){xt(this.g,"b")},sr.prototype.createWebChannel=sr.prototype.g,ir.prototype.send=ir.prototype.u,ir.prototype.open=ir.prototype.m,ir.prototype.close=ir.prototype.close,se.NO_ERROR=0,se.TIMEOUT=8,se.HTTP_ERROR=6,ie.COMPLETE="complete",ce.EventType=he,he.OPEN="a",he.CLOSE="b",he.ERROR="c",he.MESSAGE="d",Dt.prototype.listen=Dt.prototype.N,Tn.prototype.listenOnce=Tn.prototype.O,Tn.prototype.getLastError=Tn.prototype.La,Tn.prototype.getLastErrorCode=Tn.prototype.Da,Tn.prototype.getStatus=Tn.prototype.ba,Tn.prototype.getResponseJson=Tn.prototype.Qa,Tn.prototype.getResponseText=Tn.prototype.ga,Tn.prototype.send=Tn.prototype.ea;var ur=u.createWebChannelTransport=function(){return new sr},hr=u.getStatEventTarget=function(){return Yt()},lr=u.ErrorCode=se,dr=u.EventType=ie,fr=u.Event=Wt,mr=u.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},gr=u.FetchXmlHttpFactory=pn,pr=u.WebChannel=ce,yr=u.XhrIo=Tn;const wr="@firebase/firestore";class vr{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}vr.UNAUTHENTICATED=new vr(null),vr.GOOGLE_CREDENTIALS=new vr("google-credentials-uid"),vr.FIRST_PARTY=new vr("first-party-uid"),vr.MOCK_USER=new vr("mock-user");let br="9.9.2";const Ir=new o.Yd("@firebase/firestore");function Er(){return Ir.logLevel}function Tr(t){Ir.setLogLevel(t)}function Sr(t,...e){if(Ir.logLevel<=o.in.DEBUG){const n=e.map(_r);Ir.debug(`Firestore (${br}): ${t}`,...n)}}function Dr(t,...e){if(Ir.logLevel<=o.in.ERROR){const n=e.map(_r);Ir.error(`Firestore (${br}): ${t}`,...n)}}function xr(t,...e){if(Ir.logLevel<=o.in.WARN){const n=e.map(_r);Ir.warn(`Firestore (${br}): ${t}`,...n)}}function _r(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Ar(t="Unexpected state"){const e=`FIRESTORE (${br}) INTERNAL ASSERTION FAILED: `+t;throw Dr(e),new Error(e)}function Cr(t,e){t||Ar()}function Nr(t,e){t||Ar()}function kr(t,e){return t}const Or={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Mr extends a.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Rr{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Lr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Vr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(vr.UNAUTHENTICATED)))}shutdown(){}}class Fr{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Pr{constructor(t){this.t=t,this.currentUser=vr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new Rr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Rr,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Sr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Sr("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Rr)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Sr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Cr("string"==typeof e.accessToken),new Lr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Cr(null===t||"string"==typeof t),new vr(t)}}class Br{constructor(t,e,n){this.type="FirstParty",this.user=vr.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const r=t.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class Ur{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new Br(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(vr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class qr{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class jr{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,e){const n=t=>{null!=t.error&&Sr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.p;return this.p=t.token,Sr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{Sr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?r(t):Sr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Cr("string"==typeof t.token),this.p=t.token,new qr(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Kr{getToken(){return Promise.resolve(new qr(""))}invalidateToken(){}start(t,e){}shutdown(){}}function Gr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class $r{static I(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=Gr(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<e&&(n+=t.charAt(r[s]%t.length))}return n}}function zr(t,e){return t<e?-1:t>e?1:0}function Hr(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}function Qr(t){return t+"\0"}class Wr{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Mr(Or.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Mr(Or.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Mr(Or.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Mr(Or.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Wr.fromMillis(Date.now())}static fromDate(t){return Wr.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Wr(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?zr(this.nanoseconds,t.nanoseconds):zr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Xr{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Xr(t)}static min(){return new Xr(new Wr(0,0))}static max(){return new Xr(new Wr(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Yr{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ar(),void 0===n?n=t.length-e:n>t.length-e&&Ar(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Yr.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Yr?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Jr extends Yr{construct(t,e,n){return new Jr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Mr(Or.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Jr(e)}static emptyPath(){return new Jr([])}}const Zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ts extends Yr{construct(t,e,n){return new ts(t,e,n)}static isValidIdentifier(t){return Zr.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ts.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ts(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new Mr(Or.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Mr(Or.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Mr(Or.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new Mr(Or.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ts(e)}static emptyPath(){return new ts([])}}class es{constructor(t){this.path=t}static fromPath(t){return new es(Jr.fromString(t))}static fromName(t){return new es(Jr.fromString(t).popFirst(5))}static empty(){return new es(Jr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Jr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Jr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new es(new Jr(t.slice()))}}class ns{constructor(t,e,n,r){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=r}}function rs(t){return t.fields.find((t=>2===t.kind))}function ss(t){return t.fields.filter((t=>2!==t.kind))}function is(t,e){let n=zr(t.collectionGroup,e.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(t.fields.length,e.fields.length);++r)if(n=as(t.fields[r],e.fields[r]),0!==n)return n;return zr(t.fields.length,e.fields.length)}ns.UNKNOWN_ID=-1;class os{constructor(t,e){this.fieldPath=t,this.kind=e}}function as(t,e){const n=ts.comparator(t.fieldPath,e.fieldPath);return 0!==n?n:zr(t.kind,e.kind)}class cs{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new cs(0,ls.min())}}function us(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Xr.fromTimestamp(1e9===r?new Wr(n+1,0):new Wr(n,r));return new ls(s,es.empty(),e)}function hs(t){return new ls(t.readTime,t.key,-1)}class ls{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new ls(Xr.min(),es.empty(),-1)}static max(){return new ls(Xr.max(),es.empty(),-1)}}function ds(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=es.comparator(t.documentKey,e.documentKey),0!==n?n:zr(t.largestBatchId,e.largestBatchId))}const fs="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ms{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function gs(t){if(t.code!==Or.FAILED_PRECONDITION||t.message!==fs)throw t;Sr("LocalStore","Unexpectedly lost primary lease")}class ps{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Ar(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new ps(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof ps?e:ps.resolve(e)}catch(t){return ps.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):ps.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):ps.reject(e)}static resolve(t){return new ps(((e,n)=>{e(t)}))}static reject(t){return new ps(((e,n)=>{n(t)}))}static waitFor(t){return new ps(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=ps.resolve(!1);for(const n of t)e=e.next((t=>t?ps.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new ps(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{i[c]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new ps(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}class ys{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.T=new Rr,this.transaction.oncomplete=()=>{this.T.resolve()},this.transaction.onabort=()=>{e.error?this.T.reject(new bs(t,e.error)):this.T.resolve()},this.transaction.onerror=e=>{const n=Ds(e.target.error);this.T.reject(new bs(t,n))}}static open(t,e,n,r){try{return new ys(e,t.transaction(r,n))}catch(t){throw new bs(e,t)}}get A(){return this.T.promise}abort(t){t&&this.T.reject(t),this.aborted||(Sr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}R(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Es(e)}}class ws{constructor(t,e,n){this.name=t,this.version=e,this.P=n,12.2===ws.v((0,a.z$)())&&Dr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Sr("SimpleDb","Removing database:",t),Ts(window.indexedDB.deleteDatabase(t)).toPromise()}static V(){if(!(0,a.hl)())return!1;if(ws.S())return!0;const t=(0,a.z$)(),e=ws.v(t),n=0<e&&e<10,r=ws.D(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static S(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.C)}static N(t,e){return t.store(e)}static v(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static D(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async k(t){return this.db||(Sr("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new bs(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Mr(Or.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Mr(Or.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new bs(t,r))},r.onupgradeneeded=t=>{Sr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.P.M(e,r.transaction,t.oldVersion,this.version).next((()=>{Sr("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.O&&(this.db.onversionchange=t=>this.O(t)),this.db}F(t){this.O=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.k(t);const e=ys.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).next((t=>(e.R(),t))).catch((t=>(e.abort(t),ps.reject(t)))).toPromise();return i.catch((()=>{})),await e.A,i}catch(t){const e=t,n="FirebaseError"!==e.name&&i<3;if(Sr("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class vs{constructor(t){this.$=t,this.B=!1,this.L=null}get isDone(){return this.B}get U(){return this.L}set cursor(t){this.$=t}done(){this.B=!0}q(t){this.L=t}delete(){return Ts(this.$.delete())}}class bs extends Mr{constructor(t,e){super(Or.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Is(t){return"IndexedDbTransactionError"===t.name}class Es{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Sr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Sr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ts(n)}add(t){return Sr("SimpleDb","ADD",this.store.name,t,t),Ts(this.store.add(t))}get(t){return Ts(this.store.get(t)).next((e=>(void 0===e&&(e=null),Sr("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return Sr("SimpleDb","DELETE",this.store.name,t),Ts(this.store.delete(t))}count(){return Sr("SimpleDb","COUNT",this.store.name),Ts(this.store.count())}K(t,e){const n=this.options(t,e);if(n.index||"function"!=typeof this.store.getAll){const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}{const t=this.store.getAll(n.range);return new ps(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new ps(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}W(t,e){Sr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.H=!1;const r=this.cursor(n);return this.G(r,((t,e,n)=>n.delete()))}J(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.G(r,e)}Y(t){const e=this.cursor({});return new ps(((n,r)=>{e.onerror=t=>{const e=Ds(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}G(t,e){const n=[];return new ps(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new vs(s),o=e(s.primaryKey,s.value,i);if(o instanceof ps){const t=o.catch((t=>(i.done(),ps.reject(t))));n.push(t)}i.isDone?r():null===i.U?s.continue():s.continue(i.U)}})).next((()=>ps.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.H?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ts(t){return new ps(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Ds(t.target.error);n(e)}}))}let Ss=!1;function Ds(t){const e=ws.v((0,a.z$)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Mr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ss||(Ss=!0,setTimeout((()=>{throw t}),0)),t}}return t}class xs{constructor(t,e){this.asyncQueue=t,this.X=e,this.task=null}start(){this.Z(15)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}Z(t){Sr("IndexBackiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{Sr("IndexBackiller",`Documents written: ${await this.X.tt()}`)}catch(t){Is(t)?Sr("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await gs(t)}await this.Z(1)}))}}class _s{constructor(t,e){this.localStore=t,this.persistence=e}async tt(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.et(e,t)))}et(t,e){const n=new Set;let r=e,s=!0;return ps.doWhile((()=>!0===s&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((e=>{if(null!==e&&!n.has(e))return Sr("IndexBackiller",`Processing collection: ${e}`),this.nt(t,e,r).next((t=>{r-=t,n.add(e)}));s=!1})))).next((()=>e-r))}nt(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((r=>this.localStore.localDocuments.getNextDocuments(t,e,r,n).next((n=>{const s=n.changes;return this.localStore.indexManager.updateIndexEntries(t,s).next((()=>this.st(r,n))).next((n=>(Sr("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(t,e,n)))).next((()=>s.size))}))))}st(t,e){let n=t;return e.changes.forEach(((t,e)=>{const r=hs(e);ds(r,n)>0&&(n=r)})),new ls(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class As{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.it(t),this.rt=t=>e.writeSequenceNumber(t))}it(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.rt&&this.rt(t),t}}function Cs(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ns(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ks(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}As.ot=-1;class Os{constructor(t,e){this.comparator=t,this.root=e||Rs.EMPTY}insert(t,e){return new Os(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Rs.BLACK,null,null))}remove(t){return new Os(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Rs.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ms(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ms(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ms(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ms(this.root,t,this.comparator,!0)}}class Ms{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Rs{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:Rs.RED,this.left=null!=r?r:Rs.EMPTY,this.right=null!=s?s:Rs.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new Rs(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Rs.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Rs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Rs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Rs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ar();if(this.right.isRed())throw Ar();const t=this.left.check();if(t!==this.right.check())throw Ar();return t+(this.isRed()?0:1)}}Rs.EMPTY=null,Rs.RED=!0,Rs.BLACK=!1,Rs.EMPTY=new class{constructor(){this.size=0}get key(){throw Ar()}get value(){throw Ar()}get color(){throw Ar()}get left(){throw Ar()}get right(){throw Ar()}copy(t,e,n,r,s){return this}insert(t,e,n){return new Rs(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ls{constructor(t){this.comparator=t,this.data=new Os(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Vs(this.data.getIterator())}getIteratorFrom(t){return new Vs(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ls))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ls(this.comparator);return e.data=t,e}}class Vs{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Fs(t){return t.hasNext()?t.getNext():void 0}class Ps{constructor(t){this.fields=t,t.sort(ts.comparator)}static empty(){return new Ps([])}unionWith(t){let e=new Ls(ts.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ps(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Hr(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}function Bs(){return"undefined"!=typeof atob}class Us{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new Us(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Us(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return zr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Us.EMPTY_BYTE_STRING=new Us("");const qs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function js(t){if(Cr(!!t),"string"==typeof t){let e=0;const n=qs.exec(t);if(Cr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ks(t.seconds),nanos:Ks(t.nanos)}}function Ks(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Gs(t){return"string"==typeof t?Us.fromBase64String(t):Us.fromUint8Array(t)}function $s(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function zs(t){const e=t.mapValue.fields.__previous_value__;return $s(e)?zs(e):e}function Hs(t){const e=js(t.mapValue.fields.__local_write_time__.timestampValue);return new Wr(e.seconds,e.nanos)}class Qs{constructor(t,e,n,r,s,i,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Ws{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Ws("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Ws&&t.projectId===this.projectId&&t.database===this.database}}function Xs(t){return null==t}function Ys(t){return 0===t&&1/t==-1/0}function Js(t){return"number"==typeof t&&Number.isInteger(t)&&!Ys(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const Zs={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ti={nullValue:"NULL_VALUE"};function ei(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?$s(t)?4:gi(t)?9007199254740991:10:Ar()}function ni(t,e){if(t===e)return!0;const n=ei(t);if(n!==ei(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Hs(t).isEqual(Hs(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=js(t.timestampValue),r=js(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Gs(t.bytesValue).isEqual(Gs(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ks(t.geoPointValue.latitude)===Ks(e.geoPointValue.latitude)&&Ks(t.geoPointValue.longitude)===Ks(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ks(t.integerValue)===Ks(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Ks(t.doubleValue),r=Ks(e.doubleValue);return n===r?Ys(n)===Ys(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Hr(t.arrayValue.values||[],e.arrayValue.values||[],ni);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Cs(n)!==Cs(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!ni(n[t],r[t])))return!1;return!0}(t,e);default:return Ar()}}function ri(t,e){return void 0!==(t.values||[]).find((t=>ni(t,e)))}function si(t,e){if(t===e)return 0;const n=ei(t),r=ei(e);if(n!==r)return zr(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return zr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Ks(t.integerValue||t.doubleValue),r=Ks(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ii(t.timestampValue,e.timestampValue);case 4:return ii(Hs(t),Hs(e));case 5:return zr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Gs(t),r=Gs(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=zr(n[t],r[t]);if(0!==e)return e}return zr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=zr(Ks(t.latitude),Ks(e.latitude));return 0!==n?n:zr(Ks(t.longitude),Ks(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=si(n[t],r[t]);if(e)return e}return zr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Zs.mapValue&&e===Zs.mapValue)return 0;if(t===Zs.mapValue)return 1;if(e===Zs.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=zr(r[t],i[t]);if(0!==e)return e;const o=si(n[r[t]],s[i[t]]);if(0!==o)return o}return zr(r.length,i.length)}(t.mapValue,e.mapValue);default:throw Ar()}}function ii(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return zr(t,e);const n=js(t),r=js(e),s=zr(n.seconds,r.seconds);return 0!==s?s:zr(n.nanos,r.nanos)}function oi(t){return ai(t)}function ai(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=js(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Gs(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,es.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=ai(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${ai(t.fields[s])}`;return n+"}"}(t.mapValue):Ar();var e,n}function ci(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function ui(t){return!!t&&"integerValue"in t}function hi(t){return!!t&&"arrayValue"in t}function li(t){return!!t&&"nullValue"in t}function di(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function fi(t){return!!t&&"mapValue"in t}function mi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ns(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=mi(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=mi(t.arrayValue.values[n]);return e}return Object.assign({},t)}function gi(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}function pi(t){return"nullValue"in t?ti:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?ci(Ws.empty(),es.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:Ar()}function yi(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?ci(Ws.empty(),es.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?Zs:Ar()}function wi(t,e){const n=si(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function vi(t,e){const n=si(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}class bi{constructor(t){this.value=t}static empty(){return new bi({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!fi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=mi(e)}setAll(t){let e=ts.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=mi(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());fi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ni(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];fi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Ns(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new bi(mi(this.value))}}function Ii(t){const e=[];return Ns(t.fields,((t,n)=>{const r=new ts([t]);if(fi(n)){const t=Ii(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new Ps(e)}class Ei{constructor(t,e,n,r,s,i){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.data=s,this.documentState=i}static newInvalidDocument(t){return new Ei(t,0,Xr.min(),Xr.min(),bi.empty(),0)}static newFoundDocument(t,e,n){return new Ei(t,1,e,Xr.min(),n,0)}static newNoDocument(t,e){return new Ei(t,2,e,Xr.min(),bi.empty(),0)}static newUnknownDocument(t,e){return new Ei(t,3,e,Xr.min(),bi.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=bi.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=bi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Xr.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ei&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ei(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ti{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ut=null}}function Si(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Ti(t,e,n,r,s,i,o)}function Di(t){const e=kr(t);if(null===e.ut){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+oi(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Xs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>oi(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>oi(t))).join(",")),e.ut=t}return e.ut}function xi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ji(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],r=e.filters[s],n.op!==r.op||!n.field.isEqual(r.field)||!ni(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Gi(t.startAt,e.startAt)&&Gi(t.endAt,e.endAt)}function _i(t){return es.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function Ai(t,e){return t.filters.filter((t=>t instanceof ki&&t.field.isEqual(e)))}function Ci(t,e,n){let r=ti,s=!0;for(const n of Ai(t,e)){let t=ti,e=!0;switch(n.op){case"<":case"<=":t=pi(n.value);break;case"==":case"in":case">=":t=n.value;break;case">":t=n.value,e=!1;break;case"!=":case"not-in":t=ti}wi({value:r,inclusive:s},{value:t,inclusive:e})<0&&(r=t,s=e)}if(null!==n)for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const t=n.position[i];wi({value:r,inclusive:s},{value:t,inclusive:n.inclusive})<0&&(r=t,s=n.inclusive);break}return{value:r,inclusive:s}}function Ni(t,e,n){let r=Zs,s=!0;for(const n of Ai(t,e)){let t=Zs,e=!0;switch(n.op){case">=":case">":t=yi(n.value),e=!1;break;case"==":case"in":case"<=":t=n.value;break;case"<":t=n.value,e=!1;break;case"!=":case"not-in":t=Zs}vi({value:r,inclusive:s},{value:t,inclusive:e})>0&&(r=t,s=e)}if(null!==n)for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const t=n.position[i];vi({value:r,inclusive:s},{value:t,inclusive:n.inclusive})>0&&(r=t,s=n.inclusive);break}return{value:r,inclusive:s}}class ki extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.ct(t,e,n):new Oi(t,e,n):"array-contains"===e?new Vi(t,n):"in"===e?new Fi(t,n):"not-in"===e?new Pi(t,n):"array-contains-any"===e?new Bi(t,n):new ki(t,e,n)}static ct(t,e,n){return"in"===e?new Mi(t,n):new Ri(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.at(si(e,this.value)):null!==e&&ei(this.value)===ei(e)&&this.at(si(e,this.value))}at(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ar()}}ht(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Oi extends ki{constructor(t,e,n){super(t,e,n),this.key=es.fromName(n.referenceValue)}matches(t){const e=es.comparator(t.key,this.key);return this.at(e)}}class Mi extends ki{constructor(t,e){super(t,"in",e),this.keys=Li(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Ri extends ki{constructor(t,e){super(t,"not-in",e),this.keys=Li(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Li(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>es.fromName(t.referenceValue)))}class Vi extends ki{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return hi(e)&&ri(e.arrayValue,this.value)}}class Fi extends ki{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&ri(this.value.arrayValue,e)}}class Pi extends ki{constructor(t,e){super(t,"not-in",e)}matches(t){if(ri(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!ri(this.value.arrayValue,e)}}class Bi extends ki{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!hi(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>ri(this.value.arrayValue,t)))}}class Ui{constructor(t,e){this.position=t,this.inclusive=e}}class qi{constructor(t,e="asc"){this.field=t,this.dir=e}}function ji(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ki(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?es.comparator(es.fromName(o.referenceValue),n.key):si(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Gi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ni(t.position[n],e.position[n]))return!1;return!0}class $i{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.lt=null,this.ft=null,this.startAt,this.endAt}}function zi(t,e,n,r,s,i,o,a){return new $i(t,e,n,r,s,i,o,a)}function Hi(t){return new $i(t)}function Qi(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Wi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Xi(t){for(const e of t.filters)if(e.ht())return e.field;return null}function Yi(t){return null!==t.collectionGroup}function Ji(t){const e=kr(t);if(null===e.lt){e.lt=[];const t=Xi(e),n=Wi(e);if(null!==t&&null===n)t.isKeyField()||e.lt.push(new qi(t)),e.lt.push(new qi(ts.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.lt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.lt.push(new qi(ts.keyField(),t))}}}return e.lt}function Zi(t){const e=kr(t);if(!e.ft)if("F"===e.limitType)e.ft=Si(e.path,e.collectionGroup,Ji(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Ji(e)){const e="desc"===n.dir?"asc":"desc";t.push(new qi(n.field,e))}const n=e.endAt?new Ui(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Ui(e.startAt.position,e.startAt.inclusive):null;e.ft=Si(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.ft}function to(t,e,n){return new $i(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function eo(t,e){return xi(Zi(t),Zi(e))&&t.limitType===e.limitType}function no(t){return`${Di(Zi(t))}|lt:${t.limitType}`}function ro(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${oi(e.value)}`;var e})).join(", ")}]`),Xs(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>oi(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>oi(t))).join(",")),`Target(${e})`}(Zi(t))}; limitType=${t.limitType})`}function so(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):es.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=Ki(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Ji(t),e)||t.endAt&&!function(t,e,n){const r=Ki(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Ji(t),e))}(t,e)}function io(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function oo(t){return(e,n)=>{let r=!1;for(const s of Ji(t)){const t=ao(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function ao(t,e,n){const r=t.field.isKeyField()?es.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?si(r,s):Ar()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ar()}}function co(t,e){if(t.dt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ys(e)?"-0":e}}function uo(t){return{integerValue:""+t}}function ho(t,e){return Js(e)?uo(e):co(t,e)}class lo{constructor(){this._=void 0}}function fo(t,e,n){return t instanceof po?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof yo?wo(t,e):t instanceof vo?bo(t,e):function(t,e){const n=go(t,e),r=Eo(n)+Eo(t._t);return ui(n)&&ui(t._t)?uo(r):co(t.wt,r)}(t,e)}function mo(t,e,n){return t instanceof yo?wo(t,e):t instanceof vo?bo(t,e):n}function go(t,e){return t instanceof Io?ui(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class po extends lo{}class yo extends lo{constructor(t){super(),this.elements=t}}function wo(t,e){const n=To(e);for(const e of t.elements)n.some((t=>ni(t,e)))||n.push(e);return{arrayValue:{values:n}}}class vo extends lo{constructor(t){super(),this.elements=t}}function bo(t,e){let n=To(e);for(const e of t.elements)n=n.filter((t=>!ni(t,e)));return{arrayValue:{values:n}}}class Io extends lo{constructor(t,e){super(),this.wt=t,this._t=e}}function Eo(t){return Ks(t.integerValue||t.doubleValue)}function To(t){return hi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class So{constructor(t,e){this.field=t,this.transform=e}}class Do{constructor(t,e){this.version=t,this.transformResults=e}}class xo{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new xo}static exists(t){return new xo(void 0,t)}static updateTime(t){return new xo(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function _o(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ao{}function Co(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Bo(t.key,xo.none()):new Ro(t.key,t.data,xo.none());{const n=t.data,r=bi.empty();let s=new Ls(ts.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new Lo(t.key,r,new Ps(s.toArray()),xo.none())}}function No(t,e,n){t instanceof Ro?function(t,e,n){const r=t.value.clone(),s=Fo(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Lo?function(t,e,n){if(!_o(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Fo(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Vo(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ko(t,e,n,r){return t instanceof Ro?function(t,e,n,r){if(!_o(t.precondition,e))return n;const s=t.value.clone(),i=Po(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof Lo?function(t,e,n,r){if(!_o(t.precondition,e))return n;const s=Po(t.fieldTransforms,r,e),i=e.data;return i.setAll(Vo(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return _o(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Oo(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=go(r.transform,t||null);null!=s&&(null===n&&(n=bi.empty()),n.set(r.field,s))}return n||null}function Mo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Hr(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof yo&&e instanceof yo||t instanceof vo&&e instanceof vo?Hr(t.elements,e.elements,ni):t instanceof Io&&e instanceof Io?ni(t._t,e._t):t instanceof po&&e instanceof po}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ro extends Ao{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Lo extends Ao{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Vo(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Fo(t,e,n){const r=new Map;Cr(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,mo(o,a,n[s]))}return r}function Po(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,fo(t,i,e))}return r}class Bo extends Ao{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Uo extends Ao{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class qo{constructor(t){this.count=t}}var jo,Ko;function Go(t){switch(t){default:return Ar();case Or.CANCELLED:case Or.UNKNOWN:case Or.DEADLINE_EXCEEDED:case Or.RESOURCE_EXHAUSTED:case Or.INTERNAL:case Or.UNAVAILABLE:case Or.UNAUTHENTICATED:return!1;case Or.INVALID_ARGUMENT:case Or.NOT_FOUND:case Or.ALREADY_EXISTS:case Or.PERMISSION_DENIED:case Or.FAILED_PRECONDITION:case Or.ABORTED:case Or.OUT_OF_RANGE:case Or.UNIMPLEMENTED:case Or.DATA_LOSS:return!0}}function $o(t){if(void 0===t)return Dr("GRPC error has no .code"),Or.UNKNOWN;switch(t){case jo.OK:return Or.OK;case jo.CANCELLED:return Or.CANCELLED;case jo.UNKNOWN:return Or.UNKNOWN;case jo.DEADLINE_EXCEEDED:return Or.DEADLINE_EXCEEDED;case jo.RESOURCE_EXHAUSTED:return Or.RESOURCE_EXHAUSTED;case jo.INTERNAL:return Or.INTERNAL;case jo.UNAVAILABLE:return Or.UNAVAILABLE;case jo.UNAUTHENTICATED:return Or.UNAUTHENTICATED;case jo.INVALID_ARGUMENT:return Or.INVALID_ARGUMENT;case jo.NOT_FOUND:return Or.NOT_FOUND;case jo.ALREADY_EXISTS:return Or.ALREADY_EXISTS;case jo.PERMISSION_DENIED:return Or.PERMISSION_DENIED;case jo.FAILED_PRECONDITION:return Or.FAILED_PRECONDITION;case jo.ABORTED:return Or.ABORTED;case jo.OUT_OF_RANGE:return Or.OUT_OF_RANGE;case jo.UNIMPLEMENTED:return Or.UNIMPLEMENTED;case jo.DATA_LOSS:return Or.DATA_LOSS;default:return Ar()}}(Ko=jo||(jo={}))[Ko.OK=0]="OK",Ko[Ko.CANCELLED=1]="CANCELLED",Ko[Ko.UNKNOWN=2]="UNKNOWN",Ko[Ko.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ko[Ko.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ko[Ko.NOT_FOUND=5]="NOT_FOUND",Ko[Ko.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ko[Ko.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ko[Ko.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ko[Ko.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ko[Ko.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ko[Ko.ABORTED=10]="ABORTED",Ko[Ko.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ko[Ko.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ko[Ko.INTERNAL=13]="INTERNAL",Ko[Ko.UNAVAILABLE=14]="UNAVAILABLE",Ko[Ko.DATA_LOSS=15]="DATA_LOSS";class zo{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Ns(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return ks(this.inner)}size(){return this.innerSize}}const Ho=new Os(es.comparator);function Qo(){return Ho}const Wo=new Os(es.comparator);function Xo(...t){let e=Wo;for(const n of t)e=e.insert(n.key,n);return e}function Yo(t){let e=Wo;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Jo(){return ta()}function Zo(){return ta()}function ta(){return new zo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const ea=new Os(es.comparator),na=new Ls(es.comparator);function ra(...t){let e=na;for(const n of t)e=e.add(n);return e}const sa=new Ls(zr);function ia(){return sa}class oa{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,aa.createSynthesizedTargetChangeForCurrentChange(t,e)),new oa(Xr.min(),n,ia(),Qo(),ra())}}class aa{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e){return new aa(Us.EMPTY_BYTE_STRING,e,ra(),ra(),ra())}}class ca{constructor(t,e,n,r){this.gt=t,this.removedTargetIds=e,this.key=n,this.yt=r}}class ua{constructor(t,e){this.targetId=t,this.It=e}}class ha{constructor(t,e,n=Us.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class la{constructor(){this.Tt=0,this.Et=ma(),this.At=Us.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return 0!==this.Tt}get vt(){return this.bt}Vt(t){t.approximateByteSize()>0&&(this.bt=!0,this.At=t)}St(){let t=ra(),e=ra(),n=ra();return this.Et.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ar()}})),new aa(this.At,this.Rt,t,e,n)}Dt(){this.bt=!1,this.Et=ma()}Ct(t,e){this.bt=!0,this.Et=this.Et.insert(t,e)}xt(t){this.bt=!0,this.Et=this.Et.remove(t)}Nt(){this.Tt+=1}kt(){this.Tt-=1}Mt(){this.bt=!0,this.Rt=!0}}class da{constructor(t){this.Ot=t,this.Ft=new Map,this.$t=Qo(),this.Bt=fa(),this.Lt=new Ls(zr)}Ut(t){for(const e of t.gt)t.yt&&t.yt.isFoundDocument()?this.qt(e,t.yt):this.Kt(e,t.key,t.yt);for(const e of t.removedTargetIds)this.Kt(e,t.key,t.yt)}Gt(t){this.forEachTarget(t,(e=>{const n=this.Qt(e);switch(t.state){case 0:this.jt(e)&&n.Vt(t.resumeToken);break;case 1:n.kt(),n.Pt||n.Dt(),n.Vt(t.resumeToken);break;case 2:n.kt(),n.Pt||this.removeTarget(e);break;case 3:this.jt(e)&&(n.Mt(),n.Vt(t.resumeToken));break;case 4:this.jt(e)&&(this.Wt(e),n.Vt(t.resumeToken));break;default:Ar()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ft.forEach(((t,n)=>{this.jt(n)&&e(n)}))}zt(t){const e=t.targetId,n=t.It.count,r=this.Ht(e);if(r){const t=r.target;if(_i(t))if(0===n){const n=new es(t.path);this.Kt(e,n,Ei.newNoDocument(n,Xr.min()))}else Cr(1===n);else this.Jt(e)!==n&&(this.Wt(e),this.Lt=this.Lt.add(e))}}Yt(t){const e=new Map;this.Ft.forEach(((n,r)=>{const s=this.Ht(r);if(s){if(n.current&&_i(s.target)){const e=new es(s.target.path);null!==this.$t.get(e)||this.Xt(r,e)||this.Kt(r,e,Ei.newNoDocument(e,t))}n.vt&&(e.set(r,n.St()),n.Dt())}}));let n=ra();this.Bt.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ht(t);return!e||2===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.$t.forEach(((e,n)=>n.setReadTime(t)));const r=new oa(t,e,this.Lt,this.$t,n);return this.$t=Qo(),this.Bt=fa(),this.Lt=new Ls(zr),r}qt(t,e){if(!this.jt(t))return;const n=this.Xt(t,e.key)?2:0;this.Qt(t).Ct(e.key,n),this.$t=this.$t.insert(e.key,e),this.Bt=this.Bt.insert(e.key,this.Zt(e.key).add(t))}Kt(t,e,n){if(!this.jt(t))return;const r=this.Qt(t);this.Xt(t,e)?r.Ct(e,1):r.xt(e),this.Bt=this.Bt.insert(e,this.Zt(e).delete(t)),n&&(this.$t=this.$t.insert(e,n))}removeTarget(t){this.Ft.delete(t)}Jt(t){const e=this.Qt(t).St();return this.Ot.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Nt(t){this.Qt(t).Nt()}Qt(t){let e=this.Ft.get(t);return e||(e=new la,this.Ft.set(t,e)),e}Zt(t){let e=this.Bt.get(t);return e||(e=new Ls(zr),this.Bt=this.Bt.insert(t,e)),e}jt(t){const e=null!==this.Ht(t);return e||Sr("WatchChangeAggregator","Detected inactive target",t),e}Ht(t){const e=this.Ft.get(t);return e&&e.Pt?null:this.Ot.te(t)}Wt(t){this.Ft.set(t,new la),this.Ot.getRemoteKeysForTarget(t).forEach((e=>{this.Kt(t,e,null)}))}Xt(t,e){return this.Ot.getRemoteKeysForTarget(t).has(e)}}function fa(){return new Os(es.comparator)}function ma(){return new Os(es.comparator)}const ga={asc:"ASCENDING",desc:"DESCENDING"},pa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class ya{constructor(t,e){this.databaseId=t,this.dt=e}}function wa(t,e){return t.dt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function va(t,e){return t.dt?e.toBase64():e.toUint8Array()}function ba(t,e){return wa(t,e.toTimestamp())}function Ia(t){return Cr(!!t),Xr.fromTimestamp(function(t){const e=js(t);return new Wr(e.seconds,e.nanos)}(t))}function Ea(t,e){return function(t){return new Jr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ta(t){const e=Jr.fromString(t);return Cr($a(e)),e}function Sa(t,e){return Ea(t.databaseId,e.path)}function Da(t,e){const n=Ta(e);if(n.get(1)!==t.databaseId.projectId)throw new Mr(Or.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Mr(Or.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new es(Ca(n))}function xa(t,e){return Ea(t.databaseId,e)}function _a(t){const e=Ta(t);return 4===e.length?Jr.emptyPath():Ca(e)}function Aa(t){return new Jr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ca(t){return Cr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Na(t,e,n){return{name:Sa(t,e),fields:n.value.mapValue.fields}}function ka(t,e,n){const r=Da(t,e.name),s=Ia(e.updateTime),i=new bi({mapValue:{fields:e.fields}}),o=Ei.newFoundDocument(r,s,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Oa(t,e){let n;if(e instanceof Ro)n={update:Na(t,e.key,e.value)};else if(e instanceof Bo)n={delete:Sa(t,e.key)};else if(e instanceof Lo)n={update:Na(t,e.key,e.data),updateMask:Ga(e.fieldMask)};else{if(!(e instanceof Uo))return Ar();n={verify:Sa(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof po)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof yo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof vo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Io)return{fieldPath:e.field.canonicalString(),increment:n._t};throw Ar()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ba(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Ar()}(t,e.precondition)),n}function Ma(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?xo.updateTime(Ia(t.updateTime)):void 0!==t.exists?xo.exists(t.exists):xo.none()}(e.currentDocument):xo.none(),r=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)Cr("REQUEST_TIME"===e.setToServerValue),n=new po;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new yo(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new vo(t)}else"increment"in e?n=new Io(t,e.increment):Ar();const r=ts.fromServerFormat(e.fieldPath);return new So(r,n)}(t,e))):[];if(e.update){e.update.name;const s=Da(t,e.update.name),i=new bi({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new Ps(e.map((t=>ts.fromServerFormat(t))))}(e.updateMask);return new Lo(s,i,t,n,r)}return new Ro(s,i,n,r)}if(e.delete){const r=Da(t,e.delete);return new Bo(r,n)}if(e.verify){const r=Da(t,e.verify);return new Uo(r,n)}return Ar()}function Ra(t,e){return{documents:[xa(t,e.path)]}}function La(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=xa(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=xa(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(di(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NAN"}};if(li(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(di(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NOT_NAN"}};if(li(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ua(t.field),op:Ba(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const i=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Ua(t.field),direction:Pa(t.dir)}}(t)))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.dt||Xs(e)?e:{value:e}}(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Va(t){let e=_a(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Cr(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=Fa(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new qi(qa(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Xs(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Ui(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new Ui(n,e)}(n.endAt)),zi(e,s,o,i,a,"F",c,u)}function Fa(t){return t?void 0!==t.unaryFilter?[Ka(t)]:void 0!==t.fieldFilter?[ja(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Fa(t))).reduce(((t,e)=>t.concat(e))):Ar():[]}function Pa(t){return ga[t]}function Ba(t){return pa[t]}function Ua(t){return{fieldPath:t.canonicalString()}}function qa(t){return ts.fromServerFormat(t.fieldPath)}function ja(t){return ki.create(qa(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ar()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ka(t){switch(t.unaryFilter.op){case"IS_NAN":const e=qa(t.unaryFilter.field);return ki.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=qa(t.unaryFilter.field);return ki.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=qa(t.unaryFilter.field);return ki.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=qa(t.unaryFilter.field);return ki.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Ar()}}function Ga(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function $a(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function za(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Qa(e)),e=Ha(t.get(n),e);return Qa(e)}function Ha(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Qa(t){return t+""}function Wa(t){const e=t.length;if(Cr(e>=2),2===e)return Cr(""===t.charAt(0)&&""===t.charAt(1)),Jr.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const e=t.indexOf("",i);switch((e<0||e>n)&&Ar(),t.charAt(e+1)){case"":const n=t.substring(i,e);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"":s+=t.substring(i,e),s+="\0";break;case"":s+=t.substring(i,e+1);break;default:Ar()}i=e+2}return new Jr(r)}const Xa=["userId","batchId"];function Ya(t,e){return[t,za(e)]}function Ja(t,e,n){return[t,za(e),n]}const Za={},tc=["prefixPath","collectionGroup","readTime","documentId"],ec=["prefixPath","collectionGroup","documentId"],nc=["collectionGroup","readTime","prefixPath","documentId"],rc=["canonicalId","targetId"],sc=["targetId","path"],ic=["path","targetId"],oc=["collectionId","parent"],ac=["indexId","uid"],cc=["uid","sequenceNumber"],uc=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],hc=["indexId","uid","orderedDocumentKey"],lc=["userId","collectionPath","documentId"],dc=["userId","collectionPath","largestBatchId"],fc=["userId","collectionGroup","largestBatchId"],mc=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],gc=[...mc,"documentOverlays"],pc=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],yc=pc,wc=[...yc,"indexConfiguration","indexState","indexEntries"];class vc extends ms{constructor(t,e){super(),this.ee=t,this.currentSequenceNumber=e}}function bc(t,e){const n=kr(t);return ws.N(n.ee,e)}class Ic{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&No(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=ko(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=ko(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Zo();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=Co(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(Xr.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ra())}isEqual(t){return this.batchId===t.batchId&&Hr(this.mutations,t.mutations,((t,e)=>Mo(t,e)))&&Hr(this.baseMutations,t.baseMutations,((t,e)=>Mo(t,e)))}}class Ec{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Cr(t.mutations.length===n.length);let r=ea;const s=t.mutations;for(let t=0;t<s.length;t++)r=r.insert(s[t].key,n[t].version);return new Ec(t,e,n,r)}}class Tc{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Sc{constructor(t,e,n,r,s=Xr.min(),i=Xr.min(),o=Us.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(t){return new Sc(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Sc(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Sc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Dc{constructor(t){this.ne=t}}function xc(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:_c(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(t,e){return{name:Sa(t,e.key),fields:e.data.value.mapValue.fields,updateTime:wa(t,e.version.toTimestamp())}}(t.ne,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Ac(e.version)};else{if(!e.isUnknownDocument())return Ar();r.unknownDocument={path:n.path.toArray(),version:Ac(e.version)}}return r}function _c(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ac(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Cc(t){const e=new Wr(t.seconds,t.nanoseconds);return Xr.fromTimestamp(e)}function Nc(t,e){const n=(e.baseMutations||[]).map((e=>Ma(t.ne,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const r=e.mutations[t+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const r=e.mutations.map((e=>Ma(t.ne,e))),s=Wr.fromMillis(e.localWriteTimeMs);return new Ic(e.batchId,s,n,r)}function kc(t){const e=Cc(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Cc(t.lastLimboFreeSnapshotVersion):Xr.min();let r;var s;return void 0!==t.query.documents?(Cr(1===(s=t.query).documents.length),r=Zi(Hi(_a(s.documents[0])))):r=function(t){return Zi(Va(t))}(t.query),new Sc(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Us.fromBase64String(t.resumeToken))}function Oc(t,e){const n=Ac(e.snapshotVersion),r=Ac(e.lastLimboFreeSnapshotVersion);let s;s=_i(e.target)?Ra(t.ne,e.target):La(t.ne,e.target);const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Di(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Mc(t){const e=Va({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?to(e,e.limit,"L"):e}function Rc(t,e){return new Tc(e.largestBatchId,Ma(t.ne,e.overlayMutation))}function Lc(t,e){const n=e.path.lastSegment();return[t,za(e.path.popLast()),n]}function Vc(t,e,n,r){return{indexId:t,uid:e.uid||"",sequenceNumber:n,readTime:Ac(r.readTime),documentKey:za(r.documentKey.path),largestBatchId:r.largestBatchId}}class Fc{getBundleMetadata(t,e){return Pc(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:Cc(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return Pc(t).put({bundleId:(n=e).id,createTime:Ac(Ia(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return Bc(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:Mc(e.bundledQuery),readTime:Cc(e.readTime)};var e}))}saveNamedQuery(t,e){return Bc(t).put(function(t){return{name:t.name,readTime:Ac(Ia(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function Pc(t){return bc(t,"bundles")}function Bc(t){return bc(t,"namedQueries")}class Uc{constructor(t,e){this.wt=t,this.userId=e}static se(t,e){const n=e.uid||"";return new Uc(t,n)}getOverlay(t,e){return qc(t).get(Lc(this.userId,e)).next((t=>t?Rc(this.wt,t):null))}getOverlays(t,e){const n=Jo();return ps.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){const r=[];return n.forEach(((n,s)=>{const i=new Tc(e,s);r.push(this.ie(t,i))})),ps.waitFor(r)}removeOverlaysForBatchId(t,e,n){const r=new Set;e.forEach((t=>r.add(za(t.getCollectionPath()))));const s=[];return r.forEach((e=>{const r=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);s.push(qc(t).W("collectionPathOverlayIndex",r))})),ps.waitFor(s)}getOverlaysForCollection(t,e,n){const r=Jo(),s=za(e),i=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return qc(t).K("collectionPathOverlayIndex",i).next((t=>{for(const e of t){const t=Rc(this.wt,e);r.set(t.getKey(),t)}return r}))}getOverlaysForCollectionGroup(t,e,n,r){const s=Jo();let i;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return qc(t).J({index:"collectionGroupOverlayIndex",range:o},((t,e,n)=>{const o=Rc(this.wt,e);s.size()<r||o.largestBatchId===i?(s.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((()=>s))}ie(t,e){return qc(t).put(function(t,e,n){const[r,s,i]=Lc(e,n.mutation.key);return{userId:e,collectionPath:s,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Oa(t.ne,n.mutation)}}(this.wt,this.userId,e))}}function qc(t){return bc(t,"documentOverlays")}class jc{constructor(){}re(t,e){this.oe(t,e),e.ue()}oe(t,e){if("nullValue"in t)this.ce(e,5);else if("booleanValue"in t)this.ce(e,10),e.ae(t.booleanValue?1:0);else if("integerValue"in t)this.ce(e,15),e.ae(Ks(t.integerValue));else if("doubleValue"in t){const n=Ks(t.doubleValue);isNaN(n)?this.ce(e,13):(this.ce(e,15),Ys(n)?e.ae(0):e.ae(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ce(e,20),"string"==typeof n?e.he(n):(e.he(`${n.seconds||""}`),e.ae(n.nanos||0))}else if("stringValue"in t)this.le(t.stringValue,e),this.fe(e);else if("bytesValue"in t)this.ce(e,30),e.de(Gs(t.bytesValue)),this.fe(e);else if("referenceValue"in t)this._e(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ce(e,45),e.ae(n.latitude||0),e.ae(n.longitude||0)}else"mapValue"in t?gi(t)?this.ce(e,Number.MAX_SAFE_INTEGER):(this.we(t.mapValue,e),this.fe(e)):"arrayValue"in t?(this.me(t.arrayValue,e),this.fe(e)):Ar()}le(t,e){this.ce(e,25),this.ge(t,e)}ge(t,e){e.he(t)}we(t,e){const n=t.fields||{};this.ce(e,55);for(const t of Object.keys(n))this.le(t,e),this.oe(n[t],e)}me(t,e){const n=t.values||[];this.ce(e,50);for(const t of n)this.oe(t,e)}_e(t,e){this.ce(e,37),es.fromName(t).path.forEach((t=>{this.ce(e,60),this.ge(t,e)}))}ce(t,e){t.ae(e)}fe(t){t.ae(2)}}function Kc(t){if(0===t)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function Gc(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const r=Kc(255&t[n]);if(e+=r,8!==r)break}return e}(t);return Math.ceil(e/8)}jc.ye=new jc;class $c{constructor(){this.buffer=new Uint8Array(1024),this.position=0}pe(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Ie(n.value),n=e.next();this.Te()}Ee(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Ae(n.value),n=e.next();this.Re()}be(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Ie(t);else if(t<2048)this.Ie(960|t>>>6),this.Ie(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Ie(480|t>>>12),this.Ie(128|63&t>>>6),this.Ie(128|63&t);else{const t=e.codePointAt(0);this.Ie(240|t>>>18),this.Ie(128|63&t>>>12),this.Ie(128|63&t>>>6),this.Ie(128|63&t)}}this.Te()}Pe(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Ae(t);else if(t<2048)this.Ae(960|t>>>6),this.Ae(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Ae(480|t>>>12),this.Ae(128|63&t>>>6),this.Ae(128|63&t);else{const t=e.codePointAt(0);this.Ae(240|t>>>18),this.Ae(128|63&t>>>12),this.Ae(128|63&t>>>6),this.Ae(128|63&t)}}this.Re()}ve(t){const e=this.Ve(t),n=Gc(e);this.Se(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}De(t){const e=this.Ve(t),n=Gc(e);this.Se(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}Ce(){this.xe(255),this.xe(255)}Ne(){this.ke(255),this.ke(255)}reset(){this.position=0}seed(t){this.Se(t.length),this.buffer.set(t,this.position),this.position+=t.length}Me(){return this.buffer.slice(0,this.position)}Ve(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=0!=(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}Ie(t){const e=255&t;0===e?(this.xe(0),this.xe(255)):255===e?(this.xe(255),this.xe(0)):this.xe(e)}Ae(t){const e=255&t;0===e?(this.ke(0),this.ke(255)):255===e?(this.ke(255),this.ke(0)):this.ke(t)}Te(){this.xe(0),this.xe(1)}Re(){this.ke(0),this.ke(1)}xe(t){this.Se(1),this.buffer[this.position++]=t}ke(t){this.Se(1),this.buffer[this.position++]=~t}Se(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class zc{constructor(t){this.Oe=t}de(t){this.Oe.pe(t)}he(t){this.Oe.be(t)}ae(t){this.Oe.ve(t)}ue(){this.Oe.Ce()}}class Hc{constructor(t){this.Oe=t}de(t){this.Oe.Ee(t)}he(t){this.Oe.Pe(t)}ae(t){this.Oe.De(t)}ue(){this.Oe.Ne()}}class Qc{constructor(){this.Oe=new $c,this.Fe=new zc(this.Oe),this.$e=new Hc(this.Oe)}seed(t){this.Oe.seed(t)}Be(t){return 0===t?this.Fe:this.$e}Me(){return this.Oe.Me()}reset(){this.Oe.reset()}}class Wc{constructor(t,e,n,r){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=r}Le(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new Wc(this.indexId,this.documentKey,this.arrayValue,n)}}function Xc(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=Yc(t.arrayValue,e.arrayValue),0!==n?n:(n=Yc(t.directionalValue,e.directionalValue),0!==n?n:es.comparator(t.documentKey,e.documentKey)))}function Yc(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(0!==r)return r}return t.length-e.length}class Jc{constructor(t){this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Ue=t.orderBy,this.qe=[];for(const e of t.filters){const t=e;t.ht()?this.Ke=t:this.qe.push(t)}}Ge(t){const e=rs(t);if(void 0!==e&&!this.Qe(e))return!1;const n=ss(t);let r=0,s=0;for(;r<n.length&&this.Qe(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Ke){const t=n[r];if(!this.je(this.Ke,t)||!this.We(this.Ue[s++],t))return!1;++r}for(;r<n.length;++r){const t=n[r];if(s>=this.Ue.length||!this.We(this.Ue[s++],t))return!1}return!0}Qe(t){for(const e of this.qe)if(this.je(e,t))return!0;return!1}je(t,e){if(void 0===t||!t.field.isEqual(e.fieldPath))return!1;const n="array-contains"===t.op||"array-contains-any"===t.op;return 2===e.kind===n}We(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}class Zc{constructor(){this.ze=new tu}addToCollectionParentIndex(t,e){return this.ze.add(e),ps.resolve()}getCollectionParents(t,e){return ps.resolve(this.ze.getEntries(e))}addFieldIndex(t,e){return ps.resolve()}deleteFieldIndex(t,e){return ps.resolve()}getDocumentsMatchingTarget(t,e){return ps.resolve(null)}getIndexType(t,e){return ps.resolve(0)}getFieldIndexes(t,e){return ps.resolve([])}getNextCollectionGroupToUpdate(t){return ps.resolve(null)}getMinOffset(t,e){return ps.resolve(ls.min())}getMinOffsetFromCollectionGroup(t,e){return ps.resolve(ls.min())}updateCollectionGroup(t,e,n){return ps.resolve()}updateIndexEntries(t,e){return ps.resolve()}}class tu{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ls(Jr.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Ls(Jr.comparator)).toArray()}}const eu=new Uint8Array(0);class nu{constructor(t,e){this.user=t,this.databaseId=e,this.He=new tu,this.Je=new zo((t=>Di(t)),((t,e)=>xi(t,e))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.He.has(e)){const n=e.lastSegment(),r=e.popLast();t.addOnCommittedListener((()=>{this.He.add(e)}));const s={collectionId:n,parent:za(r)};return ru(t).put(s)}return ps.resolve()}getCollectionParents(t,e){const n=[],r=IDBKeyRange.bound([e,""],[Qr(e),""],!1,!0);return ru(t).K(r).next((t=>{for(const r of t){if(r.collectionId!==e)break;n.push(Wa(r.parent))}return n}))}addFieldIndex(t,e){const n=iu(t),r=function(t){return{indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind]))}}(e);delete r.indexId;const s=n.add(r);if(e.indexState){const n=ou(t);return s.next((t=>{n.put(Vc(t,this.user,e.indexState.sequenceNumber,e.indexState.offset))}))}return s.next()}deleteFieldIndex(t,e){const n=iu(t),r=ou(t),s=su(t);return n.delete(e.indexId).next((()=>r.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}getDocumentsMatchingTarget(t,e){const n=su(t);let r=!0;const s=new Map;return ps.forEach(this.Ye(e),(e=>this.Xe(t,e).next((t=>{r&&(r=!!t),s.set(e,t)})))).next((()=>{if(r){let t=ra();const r=[];return ps.forEach(s,((s,i)=>{var o;Sr("IndexedDbIndexManager",`Using index ${o=s,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((t=>`${t.fieldPath}:${t.kind}`)).join(",")}`} to execute ${Di(e)}`);const a=function(t,e){const n=rs(e);if(void 0===n)return null;for(const e of Ai(t,n.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null}(i,s),c=function(t,e){const n=new Map;for(const r of ss(e))for(const e of Ai(t,r.fieldPath))switch(e.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),e.value),Array.from(n.values())}return null}(i,s),u=function(t,e){const n=[];let r=!0;for(const s of ss(e)){const e=0===s.kind?Ci(t,s.fieldPath,t.startAt):Ni(t,s.fieldPath,t.startAt);n.push(e.value),r&&(r=e.inclusive)}return new Ui(n,r)}(i,s),h=function(t,e){const n=[];let r=!0;for(const s of ss(e)){const e=0===s.kind?Ni(t,s.fieldPath,t.endAt):Ci(t,s.fieldPath,t.endAt);n.push(e.value),r&&(r=e.inclusive)}return new Ui(n,r)}(i,s),l=this.Ze(s,i,u),d=this.Ze(s,i,h),f=this.tn(s,i,c),m=this.en(s.indexId,a,l,u.inclusive,d,h.inclusive,f);return ps.forEach(m,(s=>n.j(s,e.limit).next((e=>{e.forEach((e=>{const n=es.fromSegments(e.documentKey);t.has(n)||(t=t.add(n),r.push(n))}))}))))})).next((()=>r))}return ps.resolve(null)}))}Ye(t){let e=this.Je.get(t);return e||(e=[t],this.Je.set(t,e),e)}en(t,e,n,r,s,i,o){const a=(null!=e?e.length:1)*Math.max(n.length,s.length),c=a/(null!=e?e.length:1),u=[];for(let h=0;h<a;++h){const a=e?this.nn(e[h/c]):eu,l=this.sn(t,a,n[h%c],r),d=this.rn(t,a,s[h%c],i),f=o.map((e=>this.sn(t,a,e,!0)));u.push(...this.createRange(l,d,f))}return u}sn(t,e,n,r){const s=new Wc(t,es.empty(),e,n);return r?s:s.Le()}rn(t,e,n,r){const s=new Wc(t,es.empty(),e,n);return r?s.Le():s}Xe(t,e){const n=new Jc(e),r=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,r).next((t=>{let e=null;for(const r of t)n.Ge(r)&&(!e||r.fields.length>e.fields.length)&&(e=r);return e}))}getIndexType(t,e){let n=2;return ps.forEach(this.Ye(e),(e=>this.Xe(t,e).next((t=>{t?0!==n&&t.fields.length<function(t){let e=new Ls(ts.comparator),n=!1;for(const r of t.filters){const t=r;t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n=!0:e=e.add(t.field))}for(const n of t.orderBy)n.field.isKeyField()||(e=e.add(n.field));return e.size+(n?1:0)}(e)&&(n=1):n=0})))).next((()=>n))}on(t,e){const n=new Qc;for(const r of ss(t)){const t=e.data.field(r.fieldPath);if(null==t)return null;const s=n.Be(r.kind);jc.ye.re(t,s)}return n.Me()}nn(t){const e=new Qc;return jc.ye.re(t,e.Be(0)),e.Me()}un(t,e){const n=new Qc;return jc.ye.re(ci(this.databaseId,e),n.Be(function(t){const e=ss(t);return 0===e.length?0:e[e.length-1].kind}(t))),n.Me()}tn(t,e,n){if(null===n)return[];let r=[];r.push(new Qc);let s=0;for(const i of ss(t)){const t=n[s++];for(const n of r)if(this.cn(e,i.fieldPath)&&hi(t))r=this.an(r,i,t);else{const e=n.Be(i.kind);jc.ye.re(t,e)}}return this.hn(r)}Ze(t,e,n){return this.tn(t,e,n.position)}hn(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Me();return e}an(t,e,n){const r=[...t],s=[];for(const t of n.arrayValue.values||[])for(const n of r){const r=new Qc;r.seed(n.Me()),jc.ye.re(t,r.Be(e.kind)),s.push(r)}return s}cn(t,e){return!!t.filters.find((t=>t instanceof ki&&t.field.isEqual(e)&&("in"===t.op||"not-in"===t.op)))}getFieldIndexes(t,e){const n=iu(t),r=ou(t);return(e?n.K("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.K()).next((t=>{const e=[];return ps.forEach(t,(t=>r.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new cs(e.sequenceNumber,new ls(Cc(e.readTime),new es(Wa(e.documentKey)),e.largestBatchId)):cs.empty(),r=t.fields.map((([t,e])=>new os(ts.fromServerFormat(t),e)));return new ns(t.indexId,t.collectionGroup,r,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>{const n=t.indexState.sequenceNumber-e.indexState.sequenceNumber;return 0!==n?n:zr(t.collectionGroup,e.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const r=iu(t),s=ou(t);return this.ln(t).next((t=>r.K("collectionGroupIndex",IDBKeyRange.bound(e,e)).next((e=>ps.forEach(e,(e=>s.put(Vc(e.indexId,this.user,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return ps.forEach(e,((e,r)=>{const s=n.get(e.collectionGroup);return(s?ps.resolve(s):this.getFieldIndexes(t,e.collectionGroup)).next((s=>(n.set(e.collectionGroup,s),ps.forEach(s,(n=>this.fn(t,e,n).next((e=>{const s=this.dn(r,n);return e.isEqual(s)?ps.resolve():this._n(t,r,n,e,s)})))))))}))}wn(t,e,n,r){return su(t).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.un(n,e.key),documentKey:e.key.path.toArray()})}mn(t,e,n,r){return su(t).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.un(n,e.key),e.key.path.toArray()])}fn(t,e,n){const r=su(t);let s=new Ls(Xc);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.un(n,e)])},((t,r)=>{s=s.add(new Wc(n.indexId,e,r.arrayValue,r.directionalValue))})).next((()=>s))}dn(t,e){let n=new Ls(Xc);const r=this.on(e,t);if(null==r)return n;const s=rs(e);if(null!=s){const i=t.data.field(s.fieldPath);if(hi(i))for(const s of i.arrayValue.values||[])n=n.add(new Wc(e.indexId,t.key,this.nn(s),r))}else n=n.add(new Wc(e.indexId,t.key,eu,r));return n}_n(t,e,n,r,s){Sr("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const i=[];return function(t,e,n,r,s){const i=t.getIterator(),o=e.getIterator();let a=Fs(i),c=Fs(o);for(;a||c;){let t=!1,e=!1;if(a&&c){const r=n(a,c);r<0?e=!0:r>0&&(t=!0)}else null!=a?e=!0:t=!0;t?(r(c),c=Fs(o)):e?(s(a),a=Fs(i)):(a=Fs(i),c=Fs(o))}}(r,s,Xc,(r=>{i.push(this.wn(t,e,n,r))}),(r=>{i.push(this.mn(t,e,n,r))})),ps.waitFor(i)}ln(t){let e=1;return ou(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,r)=>{r.done(),e=n.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((t,e)=>Xc(t,e))).filter(((t,e,n)=>!e||0!==Xc(t,n[e-1])));const r=[];r.push(t);for(const s of n){const n=Xc(s,t),i=Xc(s,e);if(0===n)r[0]=t.Le();else if(n>0&&i<0)r.push(s),r.push(s.Le());else if(i>0)break}r.push(e);const s=[];for(let t=0;t<r.length;t+=2)s.push(IDBKeyRange.bound([r[t].indexId,this.uid,r[t].arrayValue,r[t].directionalValue,eu,[]],[r[t+1].indexId,this.uid,r[t+1].arrayValue,r[t+1].directionalValue,eu,[]]));return s}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(au)}getMinOffset(t,e){return ps.mapArray(this.Ye(e),(e=>this.Xe(t,e).next((t=>t||Ar())))).next(au)}}function ru(t){return bc(t,"collectionParents")}function su(t){return bc(t,"indexEntries")}function iu(t){return bc(t,"indexConfiguration")}function ou(t){return bc(t,"indexState")}function au(t){Cr(0!==t.length);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;ds(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new ls(e.readTime,e.documentKey,n)}const cu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class uu{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new uu(t,uu.DEFAULT_COLLECTION_PERCENTILE,uu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function hu(t,e,n){const r=t.store("mutations"),s=t.store("documentMutations"),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.J({range:o},((t,e,n)=>(a++,n.delete())));i.push(c.next((()=>{Cr(1===a)})));const u=[];for(const t of n.mutations){const r=Ja(e,t.key.path,n.batchId);i.push(s.delete(r)),u.push(t.key)}return ps.waitFor(i).next((()=>u))}function lu(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ar();e=t.noDocument}return JSON.stringify(e).length}uu.DEFAULT_COLLECTION_PERCENTILE=10,uu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,uu.DEFAULT=new uu(41943040,uu.DEFAULT_COLLECTION_PERCENTILE,uu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),uu.DISABLED=new uu(-1,0,0);class du{constructor(t,e,n,r){this.userId=t,this.wt=e,this.indexManager=n,this.referenceDelegate=r,this.gn={}}static se(t,e,n,r){Cr(""!==t.uid);const s=t.isAuthenticated()?t.uid:"";return new du(s,e,n,r)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mu(t).J({index:"userMutationsIndex",range:n},((t,n,r)=>{e=!1,r.done()})).next((()=>e))}addMutationBatch(t,e,n,r){const s=gu(t),i=mu(t);return i.add({}).next((o=>{Cr("number"==typeof o);const a=new Ic(o,e,n,r),c=function(t,e,n){const r=n.baseMutations.map((e=>Oa(t.ne,e))),s=n.mutations.map((e=>Oa(t.ne,e)));return{userId:e,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:s}}(this.wt,this.userId,a),u=[];let h=new Ls(((t,e)=>zr(t.canonicalString(),e.canonicalString())));for(const t of r){const e=Ja(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(i.put(c)),u.push(s.put(e,Za))}return h.forEach((e=>{u.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.gn[o]=a.keys()})),ps.waitFor(u).next((()=>a))}))}lookupMutationBatch(t,e){return mu(t).get(e).next((t=>t?(Cr(t.userId===this.userId),Nc(this.wt,t)):null))}yn(t,e){return this.gn[e]?ps.resolve(this.gn[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.gn[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return mu(t).J({index:"userMutationsIndex",range:r},((t,e,r)=>{e.userId===this.userId&&(Cr(e.batchId>=n),s=Nc(this.wt,e)),r.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return mu(t).J({index:"userMutationsIndex",range:e,reverse:!0},((t,e,r)=>{n=e.batchId,r.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return mu(t).K("userMutationsIndex",e).next((t=>t.map((t=>Nc(this.wt,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=Ya(this.userId,e.path),r=IDBKeyRange.lowerBound(n),s=[];return gu(t).J({range:r},((n,r,i)=>{const[o,a,c]=n,u=Wa(a);if(o===this.userId&&e.path.isEqual(u))return mu(t).get(c).next((t=>{if(!t)throw Ar();Cr(t.userId===this.userId),s.push(Nc(this.wt,t))}));i.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ls(zr);const r=[];return e.forEach((e=>{const s=Ya(this.userId,e.path),i=IDBKeyRange.lowerBound(s),o=gu(t).J({range:i},((t,r,s)=>{const[i,o,a]=t,c=Wa(o);i===this.userId&&e.path.isEqual(c)?n=n.add(a):s.done()}));r.push(o)})),ps.waitFor(r).next((()=>this.pn(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1,s=Ya(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new Ls(zr);return gu(t).J({range:i},((t,e,s)=>{const[i,a,c]=t,u=Wa(a);i===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):s.done()})).next((()=>this.pn(t,o)))}pn(t,e){const n=[],r=[];return e.forEach((e=>{r.push(mu(t).get(e).next((t=>{if(null===t)throw Ar();Cr(t.userId===this.userId),n.push(Nc(this.wt,t))})))})),ps.waitFor(r).next((()=>n))}removeMutationBatch(t,e){return hu(t.ee,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.In(e.batchId)})),ps.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}In(t){delete this.gn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return ps.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return gu(t).J({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=Wa(t[1]);r.push(e)}else n.done()})).next((()=>{Cr(0===r.length)}))}))}containsKey(t,e){return fu(t,this.userId,e)}Tn(t){return pu(t).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function fu(t,e,n){const r=Ya(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return gu(t).J({range:i,H:!0},((t,n,r)=>{const[i,a,c]=t;i===e&&a===s&&(o=!0),r.done()})).next((()=>o))}function mu(t){return bc(t,"mutations")}function gu(t){return bc(t,"documentMutations")}function pu(t){return bc(t,"mutationQueues")}class yu{constructor(t){this.En=t}next(){return this.En+=2,this.En}static An(){return new yu(0)}static Rn(){return new yu(-1)}}class wu{constructor(t,e){this.referenceDelegate=t,this.wt=e}allocateTargetId(t){return this.bn(t).next((e=>{const n=new yu(e.highestTargetId);return e.highestTargetId=n.next(),this.Pn(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.bn(t).next((t=>Xr.fromTimestamp(new Wr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.bn(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.bn(t).next((r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.Pn(t,r))))}addTargetData(t,e){return this.vn(t,e).next((()=>this.bn(t).next((n=>(n.targetCount+=1,this.Vn(e,n),this.Pn(t,n))))))}updateTargetData(t,e){return this.vn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>vu(t).delete(e.targetId))).next((()=>this.bn(t))).next((e=>(Cr(e.targetCount>0),e.targetCount-=1,this.Pn(t,e))))}removeTargets(t,e,n){let r=0;const s=[];return vu(t).J(((i,o)=>{const a=kc(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r++,s.push(this.removeTargetData(t,a)))})).next((()=>ps.waitFor(s))).next((()=>r))}forEachTarget(t,e){return vu(t).J(((t,n)=>{const r=kc(n);e(r)}))}bn(t){return bu(t).get("targetGlobalKey").next((t=>(Cr(null!==t),t)))}Pn(t,e){return bu(t).put("targetGlobalKey",e)}vn(t,e){return vu(t).put(Oc(this.wt,e))}Vn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.bn(t).next((t=>t.targetCount))}getTargetData(t,e){const n=Di(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return vu(t).J({range:r,index:"queryTargetsIndex"},((t,n,r)=>{const i=kc(n);xi(e,i.target)&&(s=i,r.done())})).next((()=>s))}addMatchingKeys(t,e,n){const r=[],s=Iu(t);return e.forEach((e=>{const i=za(e.path);r.push(s.put({targetId:n,path:i})),r.push(this.referenceDelegate.addReference(t,n,e))})),ps.waitFor(r)}removeMatchingKeys(t,e,n){const r=Iu(t);return ps.forEach(e,(e=>{const s=za(e.path);return ps.waitFor([r.delete([n,s]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=Iu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Iu(t);let s=ra();return r.J({range:n,H:!0},((t,e,n)=>{const r=Wa(t[1]),i=new es(r);s=s.add(i)})).next((()=>s))}containsKey(t,e){const n=za(e.path),r=IDBKeyRange.bound([n],[Qr(n)],!1,!0);let s=0;return Iu(t).J({index:"documentTargetsIndex",H:!0,range:r},(([t,e],n,r)=>{0!==t&&(s++,r.done())})).next((()=>s>0))}te(t,e){return vu(t).get(e).next((t=>t?kc(t):null))}}function vu(t){return bc(t,"targets")}function bu(t){return bc(t,"targetGlobal")}function Iu(t){return bc(t,"targetDocuments")}function Eu([t,e],[n,r]){const s=zr(t,n);return 0===s?zr(e,r):s}class Tu{constructor(t){this.Sn=t,this.buffer=new Ls(Eu),this.Dn=0}Cn(){return++this.Dn}xn(t){const e=[t,this.Cn()];if(this.buffer.size<this.Sn)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Eu(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Su{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Nn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.kn(6e4)}stop(){this.Nn&&(this.Nn.cancel(),this.Nn=null)}get started(){return null!==this.Nn}kn(t){Sr("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Nn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Nn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Is(t)?Sr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await gs(t)}await this.kn(3e5)}))}}class Du{constructor(t,e){this.Mn=t,this.params=e}calculateTargetCount(t,e){return this.Mn.On(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return ps.resolve(As.ot);const n=new Tu(e);return this.Mn.forEachTarget(t,(t=>n.xn(t.sequenceNumber))).next((()=>this.Mn.Fn(t,(t=>n.xn(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.Mn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Mn.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(Sr("LruGarbageCollector","Garbage collection skipped; disabled"),ps.resolve(cu)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(Sr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cu):this.$n(t,e)))}getCacheSize(t){return this.Mn.getCacheSize(t)}$n(t,e){let n,r,s,i,a,c,u;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(Sr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,i=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,a=Date.now(),this.removeTargets(t,n,e)))).next((e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(u=Date.now(),Er()<=o.in.DEBUG&&Sr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-h}ms\n\tDetermined least recently used ${r} in `+(a-i)+"ms\n"+`\tRemoved ${s} targets in `+(c-a)+"ms\n"+`\tRemoved ${t} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-h}ms`),ps.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:t}))))}}class xu{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new Du(t,e)}(this,e)}On(t){const e=this.Bn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Bn(t){let e=0;return this.Fn(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Fn(t,e){return this.Ln(t,((t,n)=>e(n)))}addReference(t,e,n){return _u(t,n)}removeReference(t,e,n){return _u(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return _u(t,e)}Un(t,e){return function(t,e){let n=!1;return pu(t).Y((r=>fu(t,r,e).next((t=>(t&&(n=!0),ps.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Ln(t,((i,o)=>{if(o<=e){const e=this.Un(t,i).next((e=>{if(!e)return s++,n.getEntry(t,i).next((()=>(n.removeEntry(i,Xr.min()),Iu(t).delete([0,za(i.path)]))))}));r.push(e)}})).next((()=>ps.waitFor(r))).next((()=>n.apply(t))).next((()=>s))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return _u(t,e)}Ln(t,e){const n=Iu(t);let r,s=As.ot;return n.J({index:"documentTargetsIndex"},(([t,n],{path:i,sequenceNumber:o})=>{0===t?(s!==As.ot&&e(new es(Wa(r)),s),s=o,r=i):s=As.ot})).next((()=>{s!==As.ot&&e(new es(Wa(r)),s)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function _u(t,e){return Iu(t).put(function(t,e){return{targetId:0,path:za(t.path),sequenceNumber:e}}(e,t.currentSequenceNumber))}class Au{constructor(){this.changes=new zo((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ei.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?ps.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Cu{constructor(t){this.wt=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return Mu(t).put(n)}removeEntry(t,e,n){return Mu(t).delete(function(t,e){const n=t.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],_c(e),n[n.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.qn(t,n))))}getEntry(t,e){let n=Ei.newInvalidDocument(e);return Mu(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ru(e))},((t,r)=>{n=this.Kn(e,r)})).next((()=>n))}Gn(t,e){let n={size:0,document:Ei.newInvalidDocument(e)};return Mu(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ru(e))},((t,r)=>{n={document:this.Kn(e,r),size:lu(r)}})).next((()=>n))}getEntries(t,e){let n=Qo();return this.Qn(t,e,((t,e)=>{const r=this.Kn(t,e);n=n.insert(t,r)})).next((()=>n))}jn(t,e){let n=Qo(),r=new Os(es.comparator);return this.Qn(t,e,((t,e)=>{const s=this.Kn(t,e);n=n.insert(t,s),r=r.insert(t,lu(e))})).next((()=>({documents:n,Wn:r})))}Qn(t,e,n){if(e.isEmpty())return ps.resolve();let r=new Ls(Vu);e.forEach((t=>r=r.add(t)));const s=IDBKeyRange.bound(Ru(r.first()),Ru(r.last())),i=r.getIterator();let o=i.getNext();return Mu(t).J({index:"documentKeyIndex",range:s},((t,e,r)=>{const s=es.fromSegments([...e.prefixPath,e.collectionGroup,e.documentId]);for(;o&&Vu(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.q(Ru(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))}getAllFromCollection(t,e,n){const r=[e.popLast().toArray(),e.lastSegment(),_c(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],s=[e.popLast().toArray(),e.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Mu(t).K(IDBKeyRange.bound(r,s,!0)).next((t=>{let e=Qo();for(const n of t){const t=this.Kn(es.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);e=e.insert(t.key,t)}return e}))}getAllFromCollectionGroup(t,e,n,r){let s=Qo();const i=Lu(e,n),o=Lu(e,ls.max());return Mu(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(i,o,!0)},((t,e,n)=>{const i=this.Kn(es.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);s=s.insert(i.key,i),s.size===r&&n.done()})).next((()=>s))}newChangeBuffer(t){return new ku(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return Ou(t).get("remoteDocumentGlobalKey").next((t=>(Cr(!!t),t)))}qn(t,e){return Ou(t).put("remoteDocumentGlobalKey",e)}Kn(t,e){if(e){const t=function(t,e){let n;if(e.document)n=ka(t.ne,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=es.fromSegments(e.noDocument.path),r=Cc(e.noDocument.readTime);n=Ei.newNoDocument(t,r),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ar();{const t=es.fromSegments(e.unknownDocument.path),r=Cc(e.unknownDocument.version);n=Ei.newUnknownDocument(t,r)}}return e.readTime&&n.setReadTime(function(t){const e=new Wr(t[0],t[1]);return Xr.fromTimestamp(e)}(e.readTime)),n}(this.wt,e);if(!t.isNoDocument()||!t.version.isEqual(Xr.min()))return t}return Ei.newInvalidDocument(t)}}function Nu(t){return new Cu(t)}class ku extends Au{constructor(t,e){super(),this.zn=t,this.trackRemovals=e,this.Hn=new zo((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,r=new Ls(((t,e)=>zr(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((s,i)=>{const o=this.Hn.get(s);if(e.push(this.zn.removeEntry(t,s,o.readTime)),i.isValidDocument()){const a=xc(this.zn.wt,i);r=r.add(s.path.popLast());const c=lu(a);n+=c-o.size,e.push(this.zn.addEntry(t,s,a))}else if(n-=o.size,this.trackRemovals){const n=xc(this.zn.wt,i.convertToNoDocument(Xr.min()));e.push(this.zn.addEntry(t,s,n))}})),r.forEach((n=>{e.push(this.zn.indexManager.addToCollectionParentIndex(t,n))})),e.push(this.zn.updateMetadata(t,n)),ps.waitFor(e)}getFromCache(t,e){return this.zn.Gn(t,e).next((t=>(this.Hn.set(e,{size:t.size,readTime:t.document.readTime}),t.document)))}getAllFromCache(t,e){return this.zn.jn(t,e).next((({documents:t,Wn:e})=>(e.forEach(((e,n)=>{this.Hn.set(e,{size:n,readTime:t.get(e).readTime})})),t)))}}function Ou(t){return bc(t,"remoteDocumentGlobal")}function Mu(t){return bc(t,"remoteDocumentsV14")}function Ru(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Lu(t,e){const n=e.documentKey.path.toArray();return[t,_c(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Vu(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let t=0;t<n.length-2&&t<r.length-2;++t)if(s=zr(n[t],r[t]),s)return s;return s=zr(n.length,r.length),s||(s=zr(n[n.length-2],r[r.length-2]),s||zr(n[n.length-1],r[r.length-1]))}class Fu{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Pu{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.getBaseDocument(t,e,n)))).next((t=>(null!==n&&ko(n.mutation,t,Ps.empty(),Wr.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ra()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ra()){const r=Jo();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=Xo();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Jo();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ra())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=Qo();const i=ta(),o=ta();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Lo)?s=s.insert(e.key,e):void 0!==o&&(i.set(e.key,o.mutation.getFieldMask()),ko(o.mutation,e,o.mutation.getFieldMask(),Wr.now()))})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Fu(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=ta();let r=new Os(((t,e)=>t-e)),s=ra();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||Ps.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||ra()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Zo();c.forEach((t=>{if(!s.has(t)){const r=Co(e.get(t),n.get(t));null!==r&&u.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,u))}return ps.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return es.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Yi(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):ps.resolve(Jo());let o=-1,a=s;return i.next((e=>ps.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?ps.resolve():this.getBaseDocument(t,e,n).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,ra()))).next((t=>({batchId:o,changes:Yo(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new es(e)).next((t=>{let e=Xo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const r=e.collectionGroup;let s=Xo();return this.indexManager.getCollectionParents(t,r).next((i=>ps.forEach(i,(i=>{const o=function(t,e){return new $i(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,i.child(r));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n){let r;return this.remoteDocumentCache.getAllFromCollection(t,e.path,n).next((s=>(r=s,this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId)))).next((t=>{t.forEach(((t,e)=>{const n=e.getKey();null===r.get(n)&&(r=r.insert(n,Ei.newInvalidDocument(n)))}));let n=Xo();return r.forEach(((r,s)=>{const i=t.get(r);void 0!==i&&ko(i.mutation,s,Ps.empty(),Wr.now()),so(e,s)&&(n=n.insert(r,s))})),n}))}getBaseDocument(t,e,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(t,e):ps.resolve(Ei.newInvalidDocument(e))}}class Bu{constructor(t){this.wt=t,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(t,e){return ps.resolve(this.Jn.get(e))}saveBundleMetadata(t,e){var n;return this.Jn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ia(n.createTime)}),ps.resolve()}getNamedQuery(t,e){return ps.resolve(this.Yn.get(e))}saveNamedQuery(t,e){return this.Yn.set(e.name,function(t){return{name:t.name,query:Mc(t.bundledQuery),readTime:Ia(t.readTime)}}(e)),ps.resolve()}}class Uu{constructor(){this.overlays=new Os(es.comparator),this.Xn=new Map}getOverlay(t,e){return ps.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Jo();return ps.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ie(t,e,r)})),ps.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.Xn.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.Xn.delete(n)),ps.resolve()}getOverlaysForCollection(t,e,n){const r=Jo(),s=e.length+1,i=new es(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return ps.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new Os(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Jo(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Jo(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return ps.resolve(o)}ie(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.Xn.get(r.largestBatchId).delete(n.key);this.Xn.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Tc(e,n));let s=this.Xn.get(e);void 0===s&&(s=ra(),this.Xn.set(e,s)),this.Xn.set(e,s.add(n.key))}}class qu{constructor(){this.Zn=new Ls(ju.ts),this.es=new Ls(ju.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(t,e){const n=new ju(t,e);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.rs(new ju(t,e))}os(t,e){t.forEach((t=>this.removeReference(t,e)))}us(t){const e=new es(new Jr([])),n=new ju(e,t),r=new ju(e,t+1),s=[];return this.es.forEachInRange([n,r],(t=>{this.rs(t),s.push(t.key)})),s}cs(){this.Zn.forEach((t=>this.rs(t)))}rs(t){this.Zn=this.Zn.delete(t),this.es=this.es.delete(t)}hs(t){const e=new es(new Jr([])),n=new ju(e,t),r=new ju(e,t+1);let s=ra();return this.es.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new ju(t,0),n=this.Zn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class ju{constructor(t,e){this.key=t,this.ls=e}static ts(t,e){return es.comparator(t.key,e.key)||zr(t.ls,e.ls)}static ns(t,e){return zr(t.ls,e.ls)||es.comparator(t.key,e.key)}}class Ku{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.fs=1,this.ds=new Ls(ju.ts)}checkEmpty(t){return ps.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.fs;this.fs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Ic(s,e,n,r);this.mutationQueue.push(i);for(const e of r)this.ds=this.ds.add(new ju(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return ps.resolve(i)}lookupMutationBatch(t,e){return ps.resolve(this._s(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ws(n),s=r<0?0:r;return ps.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ps.resolve(0===this.mutationQueue.length?-1:this.fs-1)}getAllMutationBatches(t){return ps.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new ju(e,0),r=new ju(e,Number.POSITIVE_INFINITY),s=[];return this.ds.forEachInRange([n,r],(t=>{const e=this._s(t.ls);s.push(e)})),ps.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ls(zr);return e.forEach((t=>{const e=new ju(t,0),r=new ju(t,Number.POSITIVE_INFINITY);this.ds.forEachInRange([e,r],(t=>{n=n.add(t.ls)}))})),ps.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;es.isDocumentKey(s)||(s=s.child(""));const i=new ju(new es(s),0);let o=new Ls(zr);return this.ds.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.ls)),!0)}),i),ps.resolve(this.gs(o))}gs(t){const e=[];return t.forEach((t=>{const n=this._s(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Cr(0===this.ys(e.batchId,"removed")),this.mutationQueue.shift();let n=this.ds;return ps.forEach(e.mutations,(r=>{const s=new ju(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.ds=n}))}In(t){}containsKey(t,e){const n=new ju(e,0),r=this.ds.firstAfterOrEqual(n);return ps.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,ps.resolve()}ys(t,e){return this.ws(t)}ws(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}_s(t){const e=this.ws(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Gu{constructor(t){this.ps=t,this.docs=new Os(es.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.ps(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ps.resolve(n?n.document.mutableCopy():Ei.newInvalidDocument(e))}getEntries(t,e){let n=Qo();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Ei.newInvalidDocument(t))})),ps.resolve(n)}getAllFromCollection(t,e,n){let r=Qo();const s=new es(e.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:t,value:{document:s}}=i.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||ds(hs(s),n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return ps.resolve(r)}getAllFromCollectionGroup(t,e,n,r){Ar()}Is(t,e){return ps.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new $u(this)}getSize(t){return ps.resolve(this.size)}}class $u extends Au{constructor(t){super(),this.zn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.zn.addEntry(t,r)):this.zn.removeEntry(n)})),ps.waitFor(e)}getFromCache(t,e){return this.zn.getEntry(t,e)}getAllFromCache(t,e){return this.zn.getEntries(t,e)}}class zu{constructor(t){this.persistence=t,this.Ts=new zo((t=>Di(t)),xi),this.lastRemoteSnapshotVersion=Xr.min(),this.highestTargetId=0,this.Es=0,this.As=new qu,this.targetCount=0,this.Rs=yu.An()}forEachTarget(t,e){return this.Ts.forEach(((t,n)=>e(n))),ps.resolve()}getLastRemoteSnapshotVersion(t){return ps.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ps.resolve(this.Es)}allocateTargetId(t){return this.highestTargetId=this.Rs.next(),ps.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Es&&(this.Es=e),ps.resolve()}vn(t){this.Ts.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Rs=new yu(e),this.highestTargetId=e),t.sequenceNumber>this.Es&&(this.Es=t.sequenceNumber)}addTargetData(t,e){return this.vn(e),this.targetCount+=1,ps.resolve()}updateTargetData(t,e){return this.vn(e),ps.resolve()}removeTargetData(t,e){return this.Ts.delete(e.target),this.As.us(e.targetId),this.targetCount-=1,ps.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Ts.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Ts.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),ps.waitFor(s).next((()=>r))}getTargetCount(t){return ps.resolve(this.targetCount)}getTargetData(t,e){const n=this.Ts.get(e)||null;return ps.resolve(n)}addMatchingKeys(t,e,n){return this.As.ss(e,n),ps.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),ps.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.As.us(e),ps.resolve()}getMatchingKeysForTargetId(t,e){const n=this.As.hs(e);return ps.resolve(n)}containsKey(t,e){return ps.resolve(this.As.containsKey(e))}}class Hu{constructor(t,e){this.bs={},this.overlays={},this.Ps=new As(0),this.vs=!1,this.vs=!0,this.referenceDelegate=t(this),this.Vs=new zu(this),this.indexManager=new Zc,this.remoteDocumentCache=function(t){return new Gu(t)}((t=>this.referenceDelegate.Ss(t))),this.wt=new Dc(e),this.Ds=new Bu(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Uu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.bs[t.toKey()];return n||(n=new Ku(e,this.referenceDelegate),this.bs[t.toKey()]=n),n}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(t,e,n){Sr("MemoryPersistence","Starting transaction:",t);const r=new Qu(this.Ps.next());return this.referenceDelegate.Cs(),n(r).next((t=>this.referenceDelegate.xs(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Ns(t,e){return ps.or(Object.values(this.bs).map((n=>()=>n.containsKey(t,e))))}}class Qu extends ms{constructor(t){super(),this.currentSequenceNumber=t}}class Wu{constructor(t){this.persistence=t,this.ks=new qu,this.Ms=null}static Os(t){return new Wu(t)}get Fs(){if(this.Ms)return this.Ms;throw Ar()}addReference(t,e,n){return this.ks.addReference(n,e),this.Fs.delete(n.toString()),ps.resolve()}removeReference(t,e,n){return this.ks.removeReference(n,e),this.Fs.add(n.toString()),ps.resolve()}markPotentiallyOrphaned(t,e){return this.Fs.add(e.toString()),ps.resolve()}removeTarget(t,e){this.ks.us(e.targetId).forEach((t=>this.Fs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Fs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Cs(){this.Ms=new Set}xs(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ps.forEach(this.Fs,(n=>{const r=es.fromPath(n);return this.$s(t,r).next((t=>{t||e.removeEntry(r,Xr.min())}))})).next((()=>(this.Ms=null,e.apply(t))))}updateLimboDocument(t,e){return this.$s(t,e).next((t=>{t?this.Fs.delete(e.toString()):this.Fs.add(e.toString())}))}Ss(t){return 0}$s(t,e){return ps.or([()=>ps.resolve(this.ks.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ns(t,e)])}}class Xu{constructor(t){this.wt=t}M(t,e,n,r){const s=new ys("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore("owner")}(t),function(t){t.createObjectStore("mutationQueues",{keyPath:"userId"}),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Xa,{unique:!0}),t.createObjectStore("documentMutations")}(t),Yu(t),function(t){t.createObjectStore("remoteDocuments")}(t));let i=ps.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore("targetDocuments"),t.deleteObjectStore("targets"),t.deleteObjectStore("targetGlobal")}(t),Yu(t)),i=i.next((()=>function(t){const e=t.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Xr.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",n)}(s)))),n<4&&r>=4&&(0!==n&&(i=i.next((()=>function(t,e){return e.store("mutations").K().next((n=>{t.deleteObjectStore("mutations"),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Xa,{unique:!0});const r=e.store("mutations"),s=n.map((t=>r.put(t)));return ps.waitFor(s)}))}(t,s)))),i=i.next((()=>{!function(t){t.createObjectStore("clientMetadata",{keyPath:"clientId"})}(t)}))),n<5&&r>=5&&(i=i.next((()=>this.Bs(s)))),n<6&&r>=6&&(i=i.next((()=>(function(t){t.createObjectStore("remoteDocumentGlobal")}(t),this.Ls(s))))),n<7&&r>=7&&(i=i.next((()=>this.Us(s)))),n<8&&r>=8&&(i=i.next((()=>this.qs(t,s)))),n<9&&r>=9&&(i=i.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t)}))),n<10&&r>=10&&(i=i.next((()=>this.Ks(s)))),n<11&&r>=11&&(i=i.next((()=>{!function(t){t.createObjectStore("bundles",{keyPath:"bundleId"})}(t),function(t){t.createObjectStore("namedQueries",{keyPath:"name"})}(t)}))),n<12&&r>=12&&(i=i.next((()=>{!function(t){const e=t.createObjectStore("documentOverlays",{keyPath:lc});e.createIndex("collectionPathOverlayIndex",dc,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",fc,{unique:!1})}(t)}))),n<13&&r>=13&&(i=i.next((()=>function(t){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:tc});e.createIndex("documentKeyIndex",ec),e.createIndex("collectionGroupIndex",nc)}(t))).next((()=>this.Gs(t,s))).next((()=>t.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(i=i.next((()=>this.Qs(t,s)))),n<15&&r>=15&&(i=i.next((()=>function(t){t.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),t.createObjectStore("indexState",{keyPath:ac}).createIndex("sequenceNumberIndex",cc,{unique:!1}),t.createObjectStore("indexEntries",{keyPath:uc}).createIndex("documentKeyIndex",hc,{unique:!1})}(t)))),i}Ls(t){let e=0;return t.store("remoteDocuments").J(((t,n)=>{e+=lu(n)})).next((()=>{const n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Bs(t){const e=t.store("mutationQueues"),n=t.store("mutations");return e.K().next((e=>ps.forEach(e,(e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.K("userMutationsIndex",r).next((n=>ps.forEach(n,(n=>{Cr(n.userId===e.userId);const r=Nc(this.wt,n);return hu(t,e.userId,r).next((()=>{}))}))))}))))}Us(t){const e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next((t=>{const r=[];return n.J(((n,s)=>{const i=new Jr(n),o=function(t){return[0,za(t)]}(i);r.push(e.get(o).next((n=>n?ps.resolve():(n=>e.put({targetId:0,path:za(n),sequenceNumber:t.highestListenSequenceNumber}))(i))))})).next((()=>ps.waitFor(r)))}))}qs(t,e){t.createObjectStore("collectionParents",{keyPath:oc});const n=e.store("collectionParents"),r=new tu,s=t=>{if(r.add(t)){const e=t.lastSegment(),r=t.popLast();return n.put({collectionId:e,parent:za(r)})}};return e.store("remoteDocuments").J({H:!0},((t,e)=>{const n=new Jr(t);return s(n.popLast())})).next((()=>e.store("documentMutations").J({H:!0},(([t,e,n],r)=>{const i=Wa(e);return s(i.popLast())}))))}Ks(t){const e=t.store("targets");return e.J(((t,n)=>{const r=kc(n),s=Oc(this.wt,r);return e.put(s)}))}Gs(t,e){const n=e.store("remoteDocuments"),r=[];return n.J(((t,n)=>{const s=e.store("remoteDocumentsV14"),i=(o=n,o.document?new es(Jr.fromString(o.document.name).popFirst(5)):o.noDocument?es.fromSegments(o.noDocument.path):o.unknownDocument?es.fromSegments(o.unknownDocument.path):Ar()).path.toArray();var o;const a={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(s.put(a))})).next((()=>ps.waitFor(r)))}Qs(t,e){const n=e.store("mutations"),r=Nu(this.wt),s=new Hu(Wu.Os,this.wt.ne);return n.K().next((t=>{const n=new Map;return t.forEach((t=>{var e;let r=null!==(e=n.get(t.userId))&&void 0!==e?e:ra();Nc(this.wt,t).keys().forEach((t=>r=r.add(t))),n.set(t.userId,r)})),ps.forEach(n,((t,n)=>{const i=new vr(n),o=Uc.se(this.wt,i),a=s.getIndexManager(i),c=du.se(i,this.wt,a,s.referenceDelegate);return new Pu(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new vc(e,As.ot),t).next()}))}))}}function Yu(t){t.createObjectStore("targetDocuments",{keyPath:sc}).createIndex("documentTargetsIndex",ic,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",rc,{unique:!0}),t.createObjectStore("targetGlobal")}const Ju="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Zu{constructor(t,e,n,r,s,i,o,a,c,u,h=15){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.js=s,this.window=i,this.document=o,this.Ws=c,this.zs=u,this.Hs=h,this.Ps=null,this.vs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Js=null,this.inForeground=!1,this.Ys=null,this.Xs=null,this.Zs=Number.NEGATIVE_INFINITY,this.ti=t=>Promise.resolve(),!Zu.V())throw new Mr(Or.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xu(this,r),this.ei=e+"main",this.wt=new Dc(a),this.ni=new ws(this.ei,this.Hs,new Xu(this.wt)),this.Vs=new wu(this.referenceDelegate,this.wt),this.remoteDocumentCache=Nu(this.wt),this.Ds=new Fc,this.window&&this.window.localStorage?this.si=this.window.localStorage:(this.si=null,!1===u&&Dr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ii().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Mr(Or.FAILED_PRECONDITION,Ju);return this.ri(),this.oi(),this.ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Vs.getHighestSequenceNumber(t)))})).then((t=>{this.Ps=new As(t,this.Ws)})).then((()=>{this.vs=!0})).catch((t=>(this.ni&&this.ni.close(),Promise.reject(t))))}ci(t){return this.ti=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ni.F((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.js.enqueueAndForget((async()=>{this.started&&await this.ii()})))}ii(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>eh(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.ai(t).next((t=>{t||(this.isPrimary=!1,this.js.enqueueRetryable((()=>this.ti(!1))))}))})).next((()=>this.hi(t))).next((e=>this.isPrimary&&!e?this.li(t).next((()=>!1)):!!e&&this.fi(t).next((()=>!0)))))).catch((t=>{if(Is(t))return Sr("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return Sr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.js.enqueueRetryable((()=>this.ti(t))),this.isPrimary=t}))}ai(t){return th(t).get("owner").next((t=>ps.resolve(this.di(t))))}_i(t){return eh(t).delete(this.clientId)}async wi(){if(this.isPrimary&&!this.mi(this.Zs,18e5)){this.Zs=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=bc(t,"clientMetadata");return e.K().next((t=>{const n=this.gi(t,18e5),r=t.filter((t=>-1===n.indexOf(t)));return ps.forEach(r,(t=>e.delete(t.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.si)for(const e of t)this.si.removeItem(this.yi(e.clientId))}}ui(){this.Xs=this.js.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.ii().then((()=>this.wi())).then((()=>this.ui()))))}di(t){return!!t&&t.ownerId===this.clientId}hi(t){return this.zs?ps.resolve(!0):th(t).get("owner").next((e=>{if(null!==e&&this.mi(e.leaseTimestampMs,5e3)&&!this.pi(e.ownerId)){if(this.di(e)&&this.networkEnabled)return!0;if(!this.di(e)){if(!e.allowTabSynchronization)throw new Mr(Or.FAILED_PRECONDITION,Ju);return!1}}return!(!this.networkEnabled||!this.inForeground)||eh(t).K().next((t=>void 0===this.gi(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,r=this.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&Sr("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.vs=!1,this.Ii(),this.Xs&&(this.Xs.cancel(),this.Xs=null),this.Ti(),this.Ei(),await this.ni.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(t=>{const e=new vc(t,As.ot);return this.li(e).next((()=>this._i(e)))})),this.ni.close(),this.Ai()}gi(t,e){return t.filter((t=>this.mi(t.updateTimeMs,e)&&!this.pi(t.clientId)))}Ri(){return this.runTransaction("getActiveClients","readonly",(t=>eh(t).K().next((t=>this.gi(t,18e5).map((t=>t.clientId))))))}get started(){return this.vs}getMutationQueue(t,e){return du.se(t,this.wt,e,this.referenceDelegate)}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new nu(t,this.wt.ne.databaseId)}getDocumentOverlayCache(t){return Uc.se(this.wt,t)}getBundleCache(){return this.Ds}runTransaction(t,e,n){Sr("IndexedDbPersistence","Starting transaction:",t);const r="readonly"===e?"readonly":"readwrite",s=15===(i=this.Hs)?wc:14===i?yc:13===i?pc:12===i?gc:11===i?mc:void Ar();var i;let o;return this.ni.runTransaction(t,r,s,(r=>(o=new vc(r,this.Ps?this.Ps.next():As.ot),"readwrite-primary"===e?this.ai(o).next((t=>!!t||this.hi(o))).next((e=>{if(!e)throw Dr(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.js.enqueueRetryable((()=>this.ti(!1))),new Mr(Or.FAILED_PRECONDITION,fs);return n(o)})).next((t=>this.fi(o).next((()=>t)))):this.bi(o).next((()=>n(o)))))).then((t=>(o.raiseOnCommittedEvent(),t)))}bi(t){return th(t).get("owner").next((t=>{if(null!==t&&this.mi(t.leaseTimestampMs,5e3)&&!this.pi(t.ownerId)&&!this.di(t)&&!(this.zs||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Mr(Or.FAILED_PRECONDITION,Ju)}))}fi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return th(t).put("owner",e)}static V(){return ws.V()}li(t){const e=th(t);return e.get("owner").next((t=>this.di(t)?(Sr("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):ps.resolve()))}mi(t,e){const n=Date.now();return!(t<n-e||t>n&&(Dr(`Detected an update time that is in the future: ${t} > ${n}`),1))}ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ys=()=>{this.js.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.ii())))},this.document.addEventListener("visibilitychange",this.Ys),this.inForeground="visible"===this.document.visibilityState)}Ti(){this.Ys&&(this.document.removeEventListener("visibilitychange",this.Ys),this.Ys=null)}oi(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Js=()=>{this.Ii(),(0,a.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.js.enterRestrictedMode(!0),this.js.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Js))}Ei(){this.Js&&(this.window.removeEventListener("pagehide",this.Js),this.Js=null)}pi(t){var e;try{const n=null!==(null===(e=this.si)||void 0===e?void 0:e.getItem(this.yi(t)));return Sr("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return Dr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}Ii(){if(this.si)try{this.si.setItem(this.yi(this.clientId),String(Date.now()))}catch(t){Dr("Failed to set zombie client id.",t)}}Ai(){if(this.si)try{this.si.removeItem(this.yi(this.clientId))}catch(t){}}yi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function th(t){return bc(t,"owner")}function eh(t){return bc(t,"clientMetadata")}function nh(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class rh{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Pi=n,this.vi=r}static Vi(t,e){let n=ra(),r=ra();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new rh(t,e.fromCache,n,r)}}class sh{constructor(){this.Si=!1}initialize(t,e){this.Di=t,this.indexManager=e,this.Si=!0}getDocumentsMatchingQuery(t,e,n,r){return this.Ci(t,e).next((s=>s||this.xi(t,e,r,n))).next((n=>n||this.Ni(t,e)))}Ci(t,e){if(Qi(e))return ps.resolve(null);let n=Zi(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=to(e,null,"F"),n=Zi(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=ra(...r);return this.Di.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.ki(e,r);return this.Mi(e,i,s,n.readTime)?this.Ci(t,to(e,null,"F")):this.Oi(t,i,e,n)}))))})))))}xi(t,e,n,r){return Qi(e)||r.isEqual(Xr.min())?this.Ni(t,e):this.Di.getDocuments(t,n).next((s=>{const i=this.ki(e,s);return this.Mi(e,i,n,r)?this.Ni(t,e):(Er()<=o.in.DEBUG&&Sr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ro(e)),this.Oi(t,i,e,us(r,-1)))}))}ki(t,e){let n=new Ls(oo(t));return e.forEach(((e,r)=>{so(t,r)&&(n=n.add(r))})),n}Mi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ni(t,e){return Er()<=o.in.DEBUG&&Sr("QueryEngine","Using full collection scan to execute query:",ro(e)),this.Di.getDocumentsMatchingQuery(t,e,ls.min())}Oi(t,e,n,r){return this.Di.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class ih{constructor(t,e,n,r){this.persistence=t,this.Fi=e,this.wt=r,this.$i=new Os(zr),this.Bi=new zo((t=>Di(t)),xi),this.Li=new Map,this.Ui=t.getRemoteDocumentCache(),this.Vs=t.getTargetCache(),this.Ds=t.getBundleCache(),this.qi(n)}qi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Pu(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.$i)))}}function oh(t,e,n,r){return new ih(t,e,n,r)}async function ah(t,e){const n=kr(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n.qi(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=ra();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({Ki:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function ch(t){const e=kr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Vs.getLastRemoteSnapshotVersion(t)))}function uh(t,e,n){let r=ra(),s=ra();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Qo();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(Xr.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):Sr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{Gi:r,Qi:s}}))}function hh(t,e){const n=kr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function lh(t,e){const n=kr(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Vs.getTargetData(t,e).next((s=>s?(r=s,ps.resolve(r)):n.Vs.allocateTargetId(t).next((s=>(r=new Sc(e,s,0,t.currentSequenceNumber),n.Vs.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.$i.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.$i=n.$i.insert(t.targetId,t),n.Bi.set(e,t.targetId)),t}))}async function dh(t,e,n){const r=kr(t),s=r.$i.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Is(t))throw t;Sr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.$i=r.$i.remove(e),r.Bi.delete(s.target)}function fh(t,e,n){const r=kr(t);let s=Xr.min(),i=ra();return r.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const r=kr(t),s=r.Bi.get(n);return void 0!==s?ps.resolve(r.$i.get(s)):r.Vs.getTargetData(e,n)}(r,t,Zi(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Vs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.Fi.getDocumentsMatchingQuery(t,e,n?s:Xr.min(),n?i:ra()))).next((t=>(ph(r,io(e),t),{documents:t,ji:i})))))}function mh(t,e){const n=kr(t),r=kr(n.Vs),s=n.$i.get(e);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",(t=>r.te(t,e).next((t=>t?t.target:null))))}function gh(t,e){const n=kr(t),r=n.Li.get(e)||Xr.min();return n.persistence.runTransaction("Get new document changes","readonly",(t=>n.Ui.getAllFromCollectionGroup(t,e,us(r,-1),Number.MAX_SAFE_INTEGER))).then((t=>(ph(n,e,t),t)))}function ph(t,e,n){let r=Xr.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.Li.set(e,r)}async function yh(t,e,n=ra()){const r=await lh(t,Zi(Mc(e.bundledQuery))),s=kr(t);return s.persistence.runTransaction("Save named query","readwrite",(t=>{const i=Ia(e.readTime);if(r.snapshotVersion.compareTo(i)>=0)return s.Ds.saveNamedQuery(t,e);const o=r.withResumeToken(Us.EMPTY_BYTE_STRING,i);return s.$i=s.$i.insert(o.targetId,o),s.Vs.updateTargetData(t,o).next((()=>s.Vs.removeMatchingKeysForTargetId(t,r.targetId))).next((()=>s.Vs.addMatchingKeys(t,n,r.targetId))).next((()=>s.Ds.saveNamedQuery(t,e)))}))}function wh(t,e){return`firestore_clients_${t}_${e}`}function vh(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function bh(t,e){return`firestore_targets_${t}_${e}`}class Ih{constructor(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}static Ji(t,e,n){const r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new Mr(r.error.code,r.error.message))),i?new Ih(t,e,r.state,s):(Dr("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Yi(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Eh{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ji(t,e){const n=JSON.parse(e);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new Mr(n.error.code,n.error.message))),s?new Eh(t,n.state,r):(Dr("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Yi(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Th{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ji(t,e){const n=JSON.parse(e);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=ia();for(let t=0;r&&t<n.activeTargetIds.length;++t)r=Js(n.activeTargetIds[t]),s=s.add(n.activeTargetIds[t]);return r?new Th(t,s):(Dr("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class Sh{constructor(t,e){this.clientId=t,this.onlineState=e}static Ji(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Sh(e.clientId,e.onlineState):(Dr("SharedClientState",`Failed to parse online state: ${t}`),null)}}class Dh{constructor(){this.activeTargetIds=ia()}Xi(t){this.activeTargetIds=this.activeTargetIds.add(t)}Zi(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Yi(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class xh{constructor(t,e,n,r,s){this.window=t,this.js=e,this.persistenceKey=n,this.tr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.er=this.nr.bind(this),this.sr=new Os(zr),this.started=!1,this.ir=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.rr=wh(this.persistenceKey,this.tr),this.ur=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.sr=this.sr.insert(this.tr,new Dh),this.cr=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.ar=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.hr=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.lr=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.dr=function(t){return`firestore_bundle_loaded_v2_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.er)}static V(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.Ri();for(const e of t){if(e===this.tr)continue;const t=this.getItem(wh(this.persistenceKey,e));if(t){const n=Th.Ji(e,t);n&&(this.sr=this.sr.insert(n.clientId,n))}}this._r();const e=this.storage.getItem(this.lr);if(e){const t=this.wr(e);t&&this.mr(t)}for(const t of this.ir)this.nr(t);this.ir=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.ur,JSON.stringify(t))}getAllActiveQueryTargets(){return this.gr(this.sr)}isActiveQueryTarget(t){let e=!1;return this.sr.forEach(((n,r)=>{r.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.yr(t,"pending")}updateMutationState(t,e,n){this.yr(t,e,n),this.pr(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(bh(this.persistenceKey,t));if(n){const r=Eh.Ji(t,n);r&&(e=r.state)}}return this.Ir.Xi(t),this._r(),e}removeLocalQueryTarget(t){this.Ir.Zi(t),this._r()}isLocalQueryTarget(t){return this.Ir.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(bh(this.persistenceKey,t))}updateQueryState(t,e,n){this.Tr(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.pr(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.Er(t)}notifyBundleLoaded(t){this.Ar(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.er),this.removeItem(this.rr),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return Sr("SharedClientState","READ",t,e),e}setItem(t,e){Sr("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){Sr("SharedClientState","REMOVE",t),this.storage.removeItem(t)}nr(t){const e=t;if(e.storageArea===this.storage){if(Sr("SharedClientState","EVENT",e.key,e.newValue),e.key===this.rr)return void Dr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.js.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.cr.test(e.key)){if(null==e.newValue){const t=this.Rr(e.key);return this.br(t,null)}{const t=this.Pr(e.key,e.newValue);if(t)return this.br(t.clientId,t)}}else if(this.ar.test(e.key)){if(null!==e.newValue){const t=this.vr(e.key,e.newValue);if(t)return this.Vr(t)}}else if(this.hr.test(e.key)){if(null!==e.newValue){const t=this.Sr(e.key,e.newValue);if(t)return this.Dr(t)}}else if(e.key===this.lr){if(null!==e.newValue){const t=this.wr(e.newValue);if(t)return this.mr(t)}}else if(e.key===this.ur){const t=function(t){let e=As.ot;if(null!=t)try{const n=JSON.parse(t);Cr("number"==typeof n),e=n}catch(t){Dr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==As.ot&&this.sequenceNumberHandler(t)}else if(e.key===this.dr){const t=this.Cr(e.newValue);await Promise.all(t.map((t=>this.syncEngine.Nr(t))))}}else this.ir.push(e)}))}}get Ir(){return this.sr.get(this.tr)}_r(){this.setItem(this.rr,this.Ir.Yi())}yr(t,e,n){const r=new Ih(this.currentUser,t,e,n),s=vh(this.persistenceKey,this.currentUser,t);this.setItem(s,r.Yi())}pr(t){const e=vh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Er(t){const e={clientId:this.tr,onlineState:t};this.storage.setItem(this.lr,JSON.stringify(e))}Tr(t,e,n){const r=bh(this.persistenceKey,t),s=new Eh(t,e,n);this.setItem(r,s.Yi())}Ar(t){const e=JSON.stringify(Array.from(t));this.setItem(this.dr,e)}Rr(t){const e=this.cr.exec(t);return e?e[1]:null}Pr(t,e){const n=this.Rr(t);return Th.Ji(n,e)}vr(t,e){const n=this.ar.exec(t),r=Number(n[1]),s=void 0!==n[2]?n[2]:null;return Ih.Ji(new vr(s),r,e)}Sr(t,e){const n=this.hr.exec(t),r=Number(n[1]);return Eh.Ji(r,e)}wr(t){return Sh.Ji(t)}Cr(t){return JSON.parse(t)}async Vr(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.kr(t.batchId,t.state,t.error);Sr("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}Dr(t){return this.syncEngine.Mr(t.targetId,t.state,t.error)}br(t,e){const n=e?this.sr.insert(t,e):this.sr.remove(t),r=this.gr(this.sr),s=this.gr(n),i=[],o=[];return s.forEach((t=>{r.has(t)||i.push(t)})),r.forEach((t=>{s.has(t)||o.push(t)})),this.syncEngine.Or(i,o).then((()=>{this.sr=n}))}mr(t){this.sr.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}gr(t){let e=ia();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class _h{constructor(){this.Fr=new Dh,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Fr.Xi(t),this.$r[t]||"not-current"}updateQueryState(t,e,n){this.$r[t]=e}removeLocalQueryTarget(t){this.Fr.Zi(t)}isLocalQueryTarget(t){return this.Fr.activeTargetIds.has(t)}clearQueryState(t){delete this.$r[t]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(t){return this.Fr.activeTargetIds.has(t)}start(){return this.Fr=new Dh,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Ah{Br(t){}shutdown(){}}class Ch{constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(t){this.Gr.push(t)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){Sr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Gr)t(0)}Kr(){Sr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Gr)t(1)}static V(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Nh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class kh{constructor(t){this.jr=t.jr,this.Wr=t.Wr}zr(t){this.Hr=t}Jr(t){this.Yr=t}onMessage(t){this.Xr=t}close(){this.Wr()}send(t){this.jr(t)}Zr(){this.Hr()}eo(t){this.Yr(t)}no(t){this.Xr(t)}}class Oh extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.so=e+"://"+t.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(t,e,n,r,s){const i=this.oo(t,e);Sr("RestConnection","Sending: ",i,n);const o={};return this.uo(o,r,s),this.co(t,i,o,n).then((t=>(Sr("RestConnection","Received: ",t),t)),(e=>{throw xr("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e}))}ao(t,e,n,r,s,i){return this.ro(t,e,n,r,s)}uo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+br,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}oo(t,e){const n=Nh[t];return`${this.so}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}co(t,e,n,r){return new Promise(((s,i)=>{const o=new yr;o.listenOnce(dr.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case lr.NO_ERROR:const e=o.getResponseJson();Sr("Connection","XHR received:",JSON.stringify(e)),s(e);break;case lr.TIMEOUT:Sr("Connection",'RPC "'+t+'" timed out'),i(new Mr(Or.DEADLINE_EXCEEDED,"Request time out"));break;case lr.HTTP_ERROR:const n=o.getStatus();if(Sr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Or).indexOf(e)>=0?e:Or.UNKNOWN}(t.status);i(new Mr(e,t.message))}else i(new Mr(Or.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new Mr(Or.UNAVAILABLE,"Connection failed."));break;default:Ar()}}finally{Sr("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(r);o.send(e,"POST",a,n,15)}))}ho(t,e,n){const r=[this.so,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=ur(),i=hr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new gr({})),this.uo(o.initMessageHeaders,e,n),(0,a.uI)()||(0,a.b$)()||(0,a.d)()||(0,a.w1)()||(0,a.Mn)()||(0,a.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");const c=r.join("");Sr("Connection","Creating WebChannel: "+c,o);const u=s.createWebChannel(c,o);let h=!1,l=!1;const d=new kh({jr:t=>{l?Sr("Connection","Not sending because WebChannel is closed:",t):(h||(Sr("Connection","Opening WebChannel transport."),u.open(),h=!0),Sr("Connection","WebChannel sending:",t),u.send(t))},Wr:()=>u.close()}),f=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return f(u,pr.EventType.OPEN,(()=>{l||Sr("Connection","WebChannel transport opened.")})),f(u,pr.EventType.CLOSE,(()=>{l||(l=!0,Sr("Connection","WebChannel transport closed"),d.eo())})),f(u,pr.EventType.ERROR,(t=>{l||(l=!0,xr("Connection","WebChannel transport errored:",t),d.eo(new Mr(Or.UNAVAILABLE,"The operation could not be completed")))})),f(u,pr.EventType.MESSAGE,(t=>{var e;if(!l){const n=t.data[0];Cr(!!n);const r=n,s=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(s){Sr("Connection","WebChannel received error:",s);const t=s.status;let e=function(t){const e=jo[t];if(void 0!==e)return $o(e)}(t),n=s.message;void 0===e&&(e=Or.INTERNAL,n="Unknown error status: "+t+" with message "+s.message),l=!0,d.eo(new Mr(e,n)),u.close()}else Sr("Connection","WebChannel received:",n),d.no(n)}})),f(i,fr.STAT_EVENT,(t=>{t.stat===mr.PROXY?Sr("Connection","Detected buffering proxy"):t.stat===mr.NOPROXY&&Sr("Connection","Detected no buffering proxy")})),setTimeout((()=>{d.Zr()}),0),d}}function Mh(){return"undefined"!=typeof window?window:null}function Rh(){return"undefined"!=typeof document?document:null}function Lh(t){return new ya(t,!0)}class Vh{constructor(t,e,n=1e3,r=1.5,s=6e4){this.js=t,this.timerId=e,this.lo=n,this.fo=r,this._o=s,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(t){this.cancel();const e=Math.floor(this.wo+this.To()),n=Math.max(0,Date.now()-this.yo),r=Math.max(0,e-n);r>0&&Sr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.wo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,r,(()=>(this.yo=Date.now(),t()))),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}cancel(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}class Fh{constructor(t,e,n,r,s,i,o,a){this.js=t,this.Ao=n,this.Ro=r,this.bo=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new Vh(t,e)}Do(){return 1===this.state||5===this.state||this.Co()}Co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.xo()}async stop(){this.Do()&&await this.close(0)}No(){this.state=0,this.So.reset()}ko(){this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,(()=>this.Mo())))}Oo(t){this.Fo(),this.stream.send(t)}async Mo(){if(this.Co())return this.close(0)}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}async close(t,e){this.Fo(),this.$o(),this.So.cancel(),this.Po++,4!==t?this.So.reset():e&&e.code===Or.RESOURCE_EXHAUSTED?(Dr(e.toString()),Dr("Using maximum backoff delay to prevent overloading the backend."),this.So.po()):e&&e.code===Or.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Bo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Jr(e)}Bo(){}auth(){this.state=1;const t=this.Lo(this.Po),e=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Po===e&&this.Uo(t,n)}),(e=>{t((()=>{const t=new Mr(Or.UNKNOWN,"Fetching auth token failed: "+e.message);return this.qo(t)}))}))}Uo(t,e){const n=this.Lo(this.Po);this.stream=this.Ko(t,e),this.stream.zr((()=>{n((()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,(()=>(this.Co()&&(this.state=3),Promise.resolve()))),this.listener.zr())))})),this.stream.Jr((t=>{n((()=>this.qo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}xo(){this.state=5,this.So.Io((async()=>{this.state=0,this.start()}))}qo(t){return Sr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Lo(t){return e=>{this.js.enqueueAndForget((()=>this.Po===t?e():(Sr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ph extends Fh{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.wt=s}Ko(t,e){return this.bo.ho("Listen",t,e)}onMessage(t){this.So.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ar()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.dt?(Cr(void 0===e||"string"==typeof e),Us.fromBase64String(e||"")):(Cr(void 0===e||e instanceof Uint8Array),Us.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Or.UNKNOWN:$o(t.code);return new Mr(e,t.message||"")}(o);n=new ha(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Da(t,r.document.name),i=Ia(r.document.updateTime),o=new bi({mapValue:{fields:r.document.fields}}),a=Ei.newFoundDocument(s,i,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new ca(c,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Da(t,r.document),i=r.readTime?Ia(r.readTime):Xr.min(),o=Ei.newNoDocument(s,i),a=r.removedTargetIds||[];n=new ca([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Da(t,r.document),i=r.removedTargetIds||[];n=new ca([],i,s,null)}else{if(!("filter"in e))return Ar();{e.filter;const t=e.filter;t.targetId;const r=t.count||0,s=new qo(r),i=t.targetId;n=new ua(i,s)}}return n}(this.wt,t),n=function(t){if(!("targetChange"in t))return Xr.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Xr.min():e.readTime?Ia(e.readTime):Xr.min()}(t);return this.listener.Go(e,n)}Qo(t){const e={};e.database=Aa(this.wt),e.addTarget=function(t,e){let n;const r=e.target;return n=_i(r)?{documents:Ra(t,r)}:{query:La(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=va(t,e.resumeToken):e.snapshotVersion.compareTo(Xr.min())>0&&(n.readTime=wa(t,e.snapshotVersion.toTimestamp())),n}(this.wt,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ar()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.wt,t);n&&(e.labels=n),this.Oo(e)}jo(t){const e={};e.database=Aa(this.wt),e.removeTarget=t,this.Oo(e)}}class Bh extends Fh{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.wt=s,this.Wo=!1}get zo(){return this.Wo}start(){this.Wo=!1,this.lastStreamToken=void 0,super.start()}Bo(){this.Wo&&this.Ho([])}Ko(t,e){return this.bo.ho("Write",t,e)}onMessage(t){if(Cr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Wo){this.So.reset();const e=function(t,e){return t&&t.length>0?(Cr(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Ia(t.updateTime):Ia(e);return n.isEqual(Xr.min())&&(n=Ia(e)),new Do(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Ia(t.commitTime);return this.listener.Jo(n,e)}return Cr(!t.writeResults||0===t.writeResults.length),this.Wo=!0,this.listener.Yo()}Xo(){const t={};t.database=Aa(this.wt),this.Oo(t)}Ho(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Oa(this.wt,t)))};this.Oo(e)}}class Uh extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.bo=n,this.wt=r,this.Zo=!1}tu(){if(this.Zo)throw new Mr(Or.FAILED_PRECONDITION,"The client has already been terminated.")}ro(t,e,n){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.bo.ro(t,e,n,r,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Or.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Mr(Or.UNKNOWN,t.toString())}))}ao(t,e,n,r){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.bo.ao(t,e,n,s,i,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Or.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Mr(Or.UNKNOWN,t.toString())}))}terminate(){this.Zo=!0}}class qh{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve()))))}uu(t){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ru("Offline")))}set(t){this.cu(),this.eu=0,"Online"===t&&(this.su=!1),this.ru(t)}ru(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ou(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(Dr(e),this.su=!1):Sr("OnlineStateTracker",e)}cu(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}class jh{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=s,this.du.Br((t=>{n.enqueueAndForget((async()=>{Yh(this)&&(Sr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=kr(t);e.lu.add(4),await Gh(e),e._u.set("Unknown"),e.lu.delete(4),await Kh(e)}(this))}))})),this._u=new qh(n,r)}}async function Kh(t){if(Yh(t))for(const e of t.fu)await e(!0)}async function Gh(t){for(const e of t.fu)await e(!1)}function $h(t,e){const n=kr(t);n.hu.has(e.targetId)||(n.hu.set(e.targetId,e),Xh(n)?Wh(n):gl(n).Co()&&Hh(n,e))}function zh(t,e){const n=kr(t),r=gl(n);n.hu.delete(e),r.Co()&&Qh(n,e),0===n.hu.size&&(r.Co()?r.ko():Yh(n)&&n._u.set("Unknown"))}function Hh(t,e){t.wu.Nt(e.targetId),gl(t).Qo(e)}function Qh(t,e){t.wu.Nt(e),gl(t).jo(e)}function Wh(t){t.wu=new da({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),te:e=>t.hu.get(e)||null}),gl(t).start(),t._u.iu()}function Xh(t){return Yh(t)&&!gl(t).Do()&&t.hu.size>0}function Yh(t){return 0===kr(t).lu.size}function Jh(t){t.wu=void 0}async function Zh(t){t.hu.forEach(((e,n)=>{Hh(t,e)}))}async function tl(t,e){Jh(t),Xh(t)?(t._u.uu(e),Wh(t)):t._u.set("Unknown")}async function el(t,e,n){if(t._u.set("Online"),e instanceof ha&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.hu.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.hu.delete(r),t.wu.removeTarget(r))}(t,e)}catch(n){Sr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await nl(t,n)}else if(e instanceof ca?t.wu.Ut(e):e instanceof ua?t.wu.zt(e):t.wu.Gt(e),!n.isEqual(Xr.min()))try{const e=await ch(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.wu.Yt(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.hu.get(r);s&&t.hu.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.hu.get(e);if(!n)return;t.hu.set(e,n.withResumeToken(Us.EMPTY_BYTE_STRING,n.snapshotVersion)),Qh(t,e);const r=new Sc(n.target,e,1,n.sequenceNumber);Hh(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Sr("RemoteStore","Failed to raise snapshot:",e),await nl(t,e)}}async function nl(t,e,n){if(!Is(e))throw e;t.lu.add(1),await Gh(t),t._u.set("Offline"),n||(n=()=>ch(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Sr("RemoteStore","Retrying IndexedDB access"),await n(),t.lu.delete(1),await Kh(t)}))}function rl(t,e){return e().catch((n=>nl(t,n,e)))}async function sl(t){const e=kr(t),n=pl(e);let r=e.au.length>0?e.au[e.au.length-1].batchId:-1;for(;il(e);)try{const t=await hh(e.localStore,r);if(null===t){0===e.au.length&&n.ko();break}r=t.batchId,ol(e,t)}catch(t){await nl(e,t)}al(e)&&cl(e)}function il(t){return Yh(t)&&t.au.length<10}function ol(t,e){t.au.push(e);const n=pl(t);n.Co()&&n.zo&&n.Ho(e.mutations)}function al(t){return Yh(t)&&!pl(t).Do()&&t.au.length>0}function cl(t){pl(t).start()}async function ul(t){pl(t).Xo()}async function hl(t){const e=pl(t);for(const n of t.au)e.Ho(n.mutations)}async function ll(t,e,n){const r=t.au.shift(),s=Ec.from(r,e,n);await rl(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await sl(t)}async function dl(t,e){e&&pl(t).zo&&await async function(t,e){if(Go(n=e.code)&&n!==Or.ABORTED){const n=t.au.shift();pl(t).No(),await rl(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await sl(t)}var n}(t,e),al(t)&&cl(t)}async function fl(t,e){const n=kr(t);n.asyncQueue.verifyOperationInProgress(),Sr("RemoteStore","RemoteStore received new credentials");const r=Yh(n);n.lu.add(3),await Gh(n),r&&n._u.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.lu.delete(3),await Kh(n)}async function ml(t,e){const n=kr(t);e?(n.lu.delete(2),await Kh(n)):e||(n.lu.add(2),await Gh(n),n._u.set("Unknown"))}function gl(t){return t.mu||(t.mu=function(t,e,n){const r=kr(t);return r.tu(),new Ph(e,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(t.datastore,t.asyncQueue,{zr:Zh.bind(null,t),Jr:tl.bind(null,t),Go:el.bind(null,t)}),t.fu.push((async e=>{e?(t.mu.No(),Xh(t)?Wh(t):t._u.set("Unknown")):(await t.mu.stop(),Jh(t))}))),t.mu}function pl(t){return t.gu||(t.gu=function(t,e,n){const r=kr(t);return r.tu(),new Bh(e,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(t.datastore,t.asyncQueue,{zr:ul.bind(null,t),Jr:dl.bind(null,t),Yo:hl.bind(null,t),Jo:ll.bind(null,t)}),t.fu.push((async e=>{e?(t.gu.No(),await sl(t)):(await t.gu.stop(),t.au.length>0&&(Sr("RemoteStore",`Stopping write stream with ${t.au.length} pending writes`),t.au=[]))}))),t.gu}class yl{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new Rr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new yl(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Mr(Or.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wl(t,e){if(Dr("AsyncQueue",`${e}: ${t}`),Is(t))return new Mr(Or.UNAVAILABLE,`${e}: ${t}`);throw t}class vl{constructor(t){this.comparator=t?(e,n)=>t(e,n)||es.comparator(e.key,n.key):(t,e)=>es.comparator(t.key,e.key),this.keyedMap=Xo(),this.sortedSet=new Os(this.comparator)}static emptySet(t){return new vl(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof vl))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new vl;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class bl{constructor(){this.yu=new Os(es.comparator)}track(t){const e=t.doc.key,n=this.yu.get(e);n?0!==t.type&&3===n.type?this.yu=this.yu.insert(e,t):3===t.type&&1!==n.type?this.yu=this.yu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.yu=this.yu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.yu=this.yu.remove(e):1===t.type&&2===n.type?this.yu=this.yu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):Ar():this.yu=this.yu.insert(e,t)}pu(){const t=[];return this.yu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Il{constructor(t,e,n,r,s,i,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,r){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new Il(t,e,vl.emptySet(e),s,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&eo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class El{constructor(){this.Iu=void 0,this.listeners=[]}}class Tl{constructor(){this.queries=new zo((t=>no(t)),eo),this.onlineState="Unknown",this.Tu=new Set}}async function Sl(t,e){const n=kr(t),r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new El),s)try{i.Iu=await n.onListen(r)}catch(t){const n=wl(t,`Initialization of query '${ro(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.listeners.push(e),e.Eu(n.onlineState),i.Iu&&e.Au(i.Iu)&&Al(n)}async function Dl(t,e){const n=kr(t),r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function xl(t,e){const n=kr(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.Au(t)&&(r=!0);s.Iu=t}}r&&Al(n)}function _l(t,e,n){const r=kr(t),s=r.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);r.queries.delete(e)}function Al(t){t.Tu.forEach((t=>{t.next()}))}class Cl{constructor(t,e,n){this.query=t,this.Ru=e,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=n||{}}Au(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Il(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.bu?this.vu(t)&&(this.Ru.next(t),e=!0):this.Vu(t,this.onlineState)&&(this.Su(t),e=!0),this.Pu=t,e}onError(t){this.Ru.error(t)}Eu(t){this.onlineState=t;let e=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,t)&&(this.Su(this.Pu),e=!0),e}Vu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.Du&&n||t.docs.isEmpty()&&"Offline"!==e)}vu(t){if(t.docChanges.length>0)return!0;const e=this.Pu&&this.Pu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Su(t){t=Il.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.bu=!0,this.Ru.next(t)}}class Nl{constructor(t,e){this.payload=t,this.byteLength=e}Cu(){return"metadata"in this.payload}}class kl{constructor(t){this.wt=t}Wi(t){return Da(this.wt,t)}zi(t){return t.metadata.exists?ka(this.wt,t.document,!1):Ei.newNoDocument(this.Wi(t.metadata.name),this.Hi(t.metadata.readTime))}Hi(t){return Ia(t)}}class Ol{constructor(t,e,n){this.xu=t,this.localStore=e,this.wt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ml(t)}Nu(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.payload.namedQuery)this.queries.push(t.payload.namedQuery);else if(t.payload.documentMetadata){this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e;const n=Jr.fromString(t.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}ku(t){const e=new Map,n=new kl(this.wt);for(const r of t)if(r.metadata.queries){const t=n.Wi(r.metadata.name);for(const n of r.metadata.queries){const r=(e.get(n)||ra()).add(t);e.set(n,r)}}return e}async complete(){const t=await async function(t,e,n,r){const s=kr(t);let i=ra(),o=Qo();for(const t of n){const n=e.Wi(t.metadata.name);t.document&&(i=i.add(n));const r=e.zi(t);r.setReadTime(e.Hi(t.metadata.readTime)),o=o.insert(n,r)}const a=s.Ui.newChangeBuffer({trackRemovals:!0}),c=await lh(s,function(t){return Zi(Hi(Jr.fromString(`__bundle__/docs/${t}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",(t=>uh(t,a,o).next((e=>(a.apply(t),e))).next((e=>s.Vs.removeMatchingKeysForTargetId(t,c.targetId).next((()=>s.Vs.addMatchingKeys(t,i,c.targetId))).next((()=>s.localDocuments.getLocalViewOfDocuments(t,e.Gi,e.Qi))).next((()=>e.Gi))))))}(this.localStore,new kl(this.wt),this.documents,this.xu.id),e=this.ku(this.documents);for(const t of this.queries)await yh(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Mu:this.collectionGroups,Ou:t}}}function Ml(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class Rl{constructor(t){this.key=t}}class Ll{constructor(t){this.key=t}}class Vl{constructor(t,e){this.query=t,this.Fu=e,this.$u=null,this.current=!1,this.Bu=ra(),this.mutatedKeys=ra(),this.Lu=oo(t),this.Uu=new vl(this.Lu)}get qu(){return this.Fu}Ku(t,e){const n=e?e.Gu:new bl,r=e?e.Uu:this.Uu;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=so(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Qu(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Lu(h,a)>0||c&&this.Lu(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Uu:i,Gu:n,Mi:o,mutatedKeys:s}}Qu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const r=this.Uu;this.Uu=t.Uu,this.mutatedKeys=t.mutatedKeys;const s=t.Gu.pu();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ar()}};return n(t)-n(e)}(t.type,e.type)||this.Lu(t.doc,e.doc))),this.ju(n);const i=e?this.Wu():[],o=0===this.Bu.size&&this.current?1:0,a=o!==this.$u;return this.$u=o,0!==s.length||a?{snapshot:new Il(this.query,t.Uu,r,s,t.mutatedKeys,0===o,a,!1),zu:i}:{zu:i}}Eu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new bl,mutatedKeys:this.mutatedKeys,Mi:!1},!1)):{zu:[]}}Hu(t){return!this.Fu.has(t)&&!!this.Uu.has(t)&&!this.Uu.get(t).hasLocalMutations}ju(t){t&&(t.addedDocuments.forEach((t=>this.Fu=this.Fu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Fu=this.Fu.delete(t))),this.current=t.current)}Wu(){if(!this.current)return[];const t=this.Bu;this.Bu=ra(),this.Uu.forEach((t=>{this.Hu(t.key)&&(this.Bu=this.Bu.add(t.key))}));const e=[];return t.forEach((t=>{this.Bu.has(t)||e.push(new Ll(t))})),this.Bu.forEach((n=>{t.has(n)||e.push(new Rl(n))})),e}Ju(t){this.Fu=t.ji,this.Bu=ra();const e=this.Ku(t.documents);return this.applyChanges(e,!0)}Yu(){return Il.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}class Fl{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Pl{constructor(t){this.key=t,this.Xu=!1}}class Bl{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Zu={},this.tc=new zo((t=>no(t)),eo),this.ec=new Map,this.nc=new Set,this.sc=new Os(es.comparator),this.ic=new Map,this.rc=new qu,this.oc={},this.uc=new Map,this.cc=yu.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return!0===this.ac}}async function Ul(t,e){const n=dd(t);let r,s;const i=n.tc.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Yu();else{const t=await lh(n.localStore,Zi(e));n.isPrimaryClient&&$h(n.remoteStore,t);const i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await ql(n,e,r,"current"===i)}return s}async function ql(t,e,n,r){t.hc=(e,n,r)=>async function(t,e,n,r){let s=e.view.Ku(n);s.Mi&&(s=await fh(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ku(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,i);return Jl(t,e.targetId,o.zu),o.snapshot}(t,e,n,r);const s=await fh(t.localStore,e,!0),i=new Vl(e,s.ji),o=i.Ku(s.documents),a=aa.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),c=i.applyChanges(o,t.isPrimaryClient,a);Jl(t,n,c.zu);const u=new Fl(e,n,i);return t.tc.set(e,u),t.ec.has(n)?t.ec.get(n).push(e):t.ec.set(n,[e]),c.snapshot}async function jl(t,e){const n=kr(t),r=n.tc.get(e),s=n.ec.get(r.targetId);if(s.length>1)return n.ec.set(r.targetId,s.filter((t=>!eo(t,e)))),void n.tc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await dh(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),zh(n.remoteStore,r.targetId),Xl(n,r.targetId)})).catch(gs)):(Xl(n,r.targetId),await dh(n.localStore,r.targetId,!0))}async function Kl(t,e){const n=kr(t);try{const t=await function(t,e){const n=kr(t),r=e.snapshotVersion;let s=n.$i;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.Ui.newChangeBuffer({trackRemovals:!0});s=n.$i;const o=[];e.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Vs.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Vs.addMatchingKeys(t,i.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(a)?u=u.withResumeToken(Us.EMPTY_BYTE_STRING,Xr.min()).withLastLimboFreeSnapshotVersion(Xr.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Vs.updateTargetData(t,u))}));let a=Qo(),c=ra();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(uh(t,i,e.documentUpdates).next((t=>{a=t.Gi,c=t.Qi}))),!r.isEqual(Xr.min())){const e=n.Vs.getLastRemoteSnapshotVersion(t).next((e=>n.Vs.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return ps.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.$i=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.ic.get(e);r&&(Cr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Xu=!0:t.modifiedDocuments.size>0?Cr(r.Xu):t.removedDocuments.size>0&&(Cr(r.Xu),r.Xu=!1))})),await ed(n,t,e)}catch(t){await gs(t)}}function Gl(t,e,n){const r=kr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.tc.forEach(((n,r)=>{const s=r.view.Eu(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=kr(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Eu(e)&&(r=!0)})),r&&Al(n)}(r.eventManager,e),t.length&&r.Zu.Go(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function $l(t,e,n){const r=kr(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.ic.get(e),i=s&&s.key;if(i){let t=new Os(es.comparator);t=t.insert(i,Ei.newNoDocument(i,Xr.min()));const n=ra().add(i),s=new oa(Xr.min(),new Map,new Ls(zr),t,n);await Kl(r,s),r.sc=r.sc.remove(i),r.ic.delete(e),td(r)}else await dh(r.localStore,e,!1).then((()=>Xl(r,e,n))).catch(gs)}async function zl(t,e){const n=kr(t),r=e.batch.batchId;try{const t=await function(t,e){const n=kr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.Ui.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=ps.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);Cr(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ra();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);Wl(n,r,null),Ql(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await ed(n,t)}catch(t){await gs(t)}}async function Hl(t,e,n){const r=kr(t);try{const t=await function(t,e){const n=kr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Cr(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);Wl(r,e,n),Ql(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await ed(r,t)}catch(n){await gs(n)}}function Ql(t,e){(t.uc.get(e)||[]).forEach((t=>{t.resolve()})),t.uc.delete(e)}function Wl(t,e,n){const r=kr(t);let s=r.oc[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.oc[r.currentUser.toKey()]=s}}function Xl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.ec.get(e))t.tc.delete(r),n&&t.Zu.lc(r,n);t.ec.delete(e),t.isPrimaryClient&&t.rc.us(e).forEach((e=>{t.rc.containsKey(e)||Yl(t,e)}))}function Yl(t,e){t.nc.delete(e.path.canonicalString());const n=t.sc.get(e);null!==n&&(zh(t.remoteStore,n),t.sc=t.sc.remove(e),t.ic.delete(n),td(t))}function Jl(t,e,n){for(const r of n)r instanceof Rl?(t.rc.addReference(r.key,e),Zl(t,r)):r instanceof Ll?(Sr("SyncEngine","Document no longer in limbo: "+r.key),t.rc.removeReference(r.key,e),t.rc.containsKey(r.key)||Yl(t,r.key)):Ar()}function Zl(t,e){const n=e.key,r=n.path.canonicalString();t.sc.get(n)||t.nc.has(r)||(Sr("SyncEngine","New document in limbo: "+n),t.nc.add(r),td(t))}function td(t){for(;t.nc.size>0&&t.sc.size<t.maxConcurrentLimboResolutions;){const e=t.nc.values().next().value;t.nc.delete(e);const n=new es(Jr.fromString(e)),r=t.cc.next();t.ic.set(r,new Pl(n)),t.sc=t.sc.insert(n,r),$h(t.remoteStore,new Sc(Zi(Hi(n.path)),r,2,As.ot))}}async function ed(t,e,n){const r=kr(t),s=[],i=[],o=[];r.tc.isEmpty()||(r.tc.forEach(((t,a)=>{o.push(r.hc(a,e,n).then((t=>{if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),s.push(t);const e=rh.Vi(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.Zu.Go(s),await async function(t,e){const n=kr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>ps.forEach(e,(e=>ps.forEach(e.Pi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>ps.forEach(e.vi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Is(t))throw t;Sr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.$i.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.$i=n.$i.insert(e,s)}}}(r.localStore,i))}async function nd(t,e){const n=kr(t);if(!n.currentUser.isEqual(e)){Sr("SyncEngine","User change. New user:",e.toKey());const t=await ah(n.localStore,e);n.currentUser=e,function(t,e){t.uc.forEach((t=>{t.forEach((t=>{t.reject(new Mr(Or.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.uc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await ed(n,t.Ki)}}function rd(t,e){const n=kr(t),r=n.ic.get(e);if(r&&r.Xu)return ra().add(r.key);{let t=ra();const r=n.ec.get(e);if(!r)return t;for(const e of r){const r=n.tc.get(e);t=t.unionWith(r.view.qu)}return t}}async function sd(t,e){const n=kr(t),r=await fh(n.localStore,e.query,!0),s=e.view.Ju(r);return n.isPrimaryClient&&Jl(n,e.targetId,s.zu),s}async function id(t,e){const n=kr(t);return gh(n.localStore,e).then((t=>ed(n,t)))}async function od(t,e,n,r){const s=kr(t),i=await function(t,e){const n=kr(t),r=kr(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>r.yn(t,e).next((e=>e?n.localDocuments.getDocuments(t,e):ps.resolve(null)))))}(s.localStore,e);null!==i?("pending"===n?await sl(s.remoteStore):"acknowledged"===n||"rejected"===n?(Wl(s,e,r||null),Ql(s,e),function(t,e){kr(kr(t).mutationQueue).In(e)}(s.localStore,e)):Ar(),await ed(s,i)):Sr("SyncEngine","Cannot apply mutation batch with id: "+e)}async function ad(t,e,n){const r=kr(t),s=[],i=[];for(const t of e){let e;const n=r.ec.get(t);if(n&&0!==n.length){e=await lh(r.localStore,Zi(n[0]));for(const t of n){const e=r.tc.get(t),n=await sd(r,e);n.snapshot&&i.push(n.snapshot)}}else{const n=await mh(r.localStore,t);e=await lh(r.localStore,n),await ql(r,cd(n),t,!1)}s.push(e)}return r.Zu.Go(i),s}function cd(t){return zi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function ud(t){const e=kr(t);return kr(kr(e.localStore).persistence).Ri()}async function hd(t,e,n,r){const s=kr(t);if(s.ac)return void Sr("SyncEngine","Ignoring unexpected query state notification.");const i=s.ec.get(e);if(i&&i.length>0)switch(n){case"current":case"not-current":{const t=await gh(s.localStore,io(i[0])),r=oa.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await ed(s,t,r);break}case"rejected":await dh(s.localStore,e,!0),Xl(s,e,r);break;default:Ar()}}async function ld(t,e,n){const r=dd(t);if(r.ac){for(const t of e){if(r.ec.has(t)){Sr("SyncEngine","Adding an already active target "+t);continue}const e=await mh(r.localStore,t),n=await lh(r.localStore,e);await ql(r,cd(e),n.targetId,!1),$h(r.remoteStore,n)}for(const t of n)r.ec.has(t)&&await dh(r.localStore,t,!1).then((()=>{zh(r.remoteStore,t),Xl(r,t)})).catch(gs)}}function dd(t){const e=kr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Kl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=rd.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=$l.bind(null,e),e.Zu.Go=xl.bind(null,e.eventManager),e.Zu.lc=_l.bind(null,e.eventManager),e}function fd(t){const e=kr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=zl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Hl.bind(null,e),e}class md{constructor(){this.synchronizeTabs=!1}async initialize(t){this.wt=Lh(t.databaseInfo.databaseId),this.sharedClientState=this.dc(t),this.persistence=this._c(t),await this.persistence.start(),this.localStore=this.wc(t),this.gcScheduler=this.mc(t,this.localStore),this.indexBackfillerScheduler=this.gc(t,this.localStore)}mc(t,e){return null}gc(t,e){return null}wc(t){return oh(this.persistence,new sh,t.initialUser,this.wt)}_c(t){return new Hu(Wu.Os,this.wt)}dc(t){return new _h}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class gd extends md{constructor(t,e,n){super(),this.yc=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.yc.initialize(this,t),await fd(this.yc.syncEngine),await sl(this.yc.remoteStore),await this.persistence.ci((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}wc(t){return oh(this.persistence,new sh,t.initialUser,this.wt)}mc(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new Su(n,t.asyncQueue,e)}gc(t,e){const n=new _s(e,this.persistence);return new xs(t.asyncQueue,n)}_c(t){const e=nh(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?uu.withCacheSize(this.cacheSizeBytes):uu.DEFAULT;return new Zu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Mh(),Rh(),this.wt,this.sharedClientState,!!this.forceOwnership)}dc(t){return new _h}}class pd extends gd{constructor(t,e){super(t,e,!1),this.yc=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.yc.syncEngine;this.sharedClientState instanceof xh&&(this.sharedClientState.syncEngine={kr:od.bind(null,e),Mr:hd.bind(null,e),Or:ld.bind(null,e),Ri:ud.bind(null,e),Nr:id.bind(null,e)},await this.sharedClientState.start()),await this.persistence.ci((async t=>{await async function(t,e){const n=kr(t);if(dd(n),fd(n),!0===e&&!0!==n.ac){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await ad(n,t.toArray());n.ac=!0,await ml(n.remoteStore,!0);for(const t of e)$h(n.remoteStore,t)}else if(!1===e&&!1!==n.ac){const t=[];let e=Promise.resolve();n.ec.forEach(((r,s)=>{n.sharedClientState.isLocalQueryTarget(s)?t.push(s):e=e.then((()=>(Xl(n,s),dh(n.localStore,s,!0)))),zh(n.remoteStore,s)})),await e,await ad(n,t),function(t){const e=kr(t);e.ic.forEach(((t,n)=>{zh(e.remoteStore,n)})),e.rc.cs(),e.ic=new Map,e.sc=new Os(es.comparator)}(n),n.ac=!1,await ml(n.remoteStore,!1)}}(this.yc.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start():t||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(t&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():t||this.indexBackfillerScheduler.stop())}))}dc(t){const e=Mh();if(!xh.V(e))throw new Mr(Or.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=nh(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new xh(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class yd{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Gl(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=nd.bind(null,this.syncEngine),await ml(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Tl}createDatastore(t){const e=Lh(t.databaseInfo.databaseId),n=(r=t.databaseInfo,new Oh(r));var r;return function(t,e,n,r){return new Uh(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,s=t=>Gl(this.syncEngine,t,0),i=Ch.V()?new Ch:new Ah,new jh(e,n,r,s,i);var e,n,r,s,i}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new Bl(t,e,n,r,s,i);return o&&(a.ac=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=kr(t);Sr("RemoteStore","RemoteStore shutting down."),e.lu.add(5),await Gh(e),e.du.shutdown(),e._u.set("Unknown")}(this.remoteStore)}}function wd(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const r={value:t.slice(n,n+e),done:!1};return n+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class vd{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ic(this.observer.next,t)}error(t){this.observer.error?this.Ic(this.observer.error,t):Dr("Uncaught Error in snapshot listener:",t)}Tc(){this.muted=!0}Ic(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class bd{constructor(t,e){this.Ec=t,this.wt=e,this.metadata=new Rr,this.buffer=new Uint8Array,this.Ac=new TextDecoder("utf-8"),this.Rc().then((t=>{t&&t.Cu()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Ec.cancel()}async getMetadata(){return this.metadata.promise}async fc(){return await this.getMetadata(),this.Rc()}async Rc(){const t=await this.bc();if(null===t)return null;const e=this.Ac.decode(t),n=Number(e);isNaN(n)&&this.Pc(`length string (${e}) is not valid number`);const r=await this.vc(n);return new Nl(JSON.parse(r),t.length+n)}Vc(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async bc(){for(;this.Vc()<0&&!await this.Sc(););if(0===this.buffer.length)return null;const t=this.Vc();t<0&&this.Pc("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async vc(t){for(;this.buffer.length<t;)await this.Sc()&&this.Pc("Reached the end of bundle when more is expected.");const e=this.Ac.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}Pc(t){throw this.Ec.cancel(),new Error(`Invalid bundle format: ${t}`)}async Sc(){const t=await this.Ec.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class Id{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Mr(Or.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=kr(t),r=Aa(n.wt)+"/documents",s={documents:e.map((t=>Sa(n.wt,t)))},i=await n.ao("BatchGetDocuments",r,s,e.length),o=new Map;i.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){Cr(!!e.found),e.found.name,e.found.updateTime;const n=Da(t,e.found.name),r=Ia(e.found.updateTime),s=new bi({mapValue:{fields:e.found.fields}});return Ei.newFoundDocument(n,r,s)}(t,e):"missing"in e?function(t,e){Cr(!!e.missing),Cr(!!e.readTime);const n=Da(t,e.missing),r=Ia(e.readTime);return Ei.newNoDocument(n,r)}(t,e):Ar()}(n.wt,t);o.set(e.key.toString(),e)}));const a=[];return e.forEach((t=>{const e=o.get(t.toString());Cr(!!e),a.push(e)})),a}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Bo(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=es.fromPath(e);this.mutations.push(new Uo(n,this.precondition(n)))})),await async function(t,e){const n=kr(t),r=Aa(n.wt)+"/documents",s={writes:e.map((t=>Oa(n.wt,t)))};await n.ro("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Ar();e=Xr.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Mr(Or.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?xo.updateTime(e):xo.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Xr.min()))throw new Mr(Or.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return xo.updateTime(e)}return xo.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class Ed{constructor(t,e,n,r,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=r,this.deferred=s,this.Dc=n.maxAttempts,this.So=new Vh(this.asyncQueue,"transaction_retry")}run(){this.Dc-=1,this.Cc()}Cc(){this.So.Io((async()=>{const t=new Id(this.datastore),e=this.xc(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.Nc(t)}))))})).catch((t=>{this.Nc(t)}))}))}xc(t){try{const e=this.updateFunction(t);return!Xs(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Nc(t){this.Dc>0&&this.kc(t)?(this.Dc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Cc(),Promise.resolve())))):this.deferred.reject(t)}kc(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!Go(e)}return!1}}class Td{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=vr.UNAUTHENTICATED,this.clientId=$r.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Sr("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Sr("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Mr(Or.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Rr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=wl(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Sd(t,e){t.asyncQueue.verifyOperationInProgress(),Sr("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await ah(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function Dd(t,e){t.asyncQueue.verifyOperationInProgress();const n=await xd(t);Sr("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>fl(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>fl(e.remoteStore,n))),t.onlineComponents=e}async function xd(t){return t.offlineComponents||(Sr("FirestoreClient","Using default OfflineComponentProvider"),await Sd(t,new md)),t.offlineComponents}async function _d(t){return t.onlineComponents||(Sr("FirestoreClient","Using default OnlineComponentProvider"),await Dd(t,new yd)),t.onlineComponents}function Ad(t){return xd(t).then((t=>t.persistence))}function Cd(t){return xd(t).then((t=>t.localStore))}function Nd(t){return _d(t).then((t=>t.remoteStore))}function kd(t){return _d(t).then((t=>t.syncEngine))}async function Od(t){const e=await _d(t),n=e.eventManager;return n.onListen=Ul.bind(null,e.syncEngine),n.onUnlisten=jl.bind(null,e.syncEngine),n}function Md(t,e,n={}){const r=new Rr;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new vd({next:i=>{e.enqueueAndForget((()=>Dl(t,o)));const a=i.docs.has(n);!a&&i.fromCache?s.reject(new Mr(Or.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&r&&"server"===r.source?s.reject(new Mr(Or.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(i)},error:t=>s.reject(t)}),o=new Cl(Hi(n.path),i,{includeMetadataChanges:!0,Du:!0});return Sl(t,o)}(await Od(t),t.asyncQueue,e,n,r))),r.promise}function Rd(t,e,n={}){const r=new Rr;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new vd({next:n=>{e.enqueueAndForget((()=>Dl(t,o))),n.fromCache&&"server"===r.source?s.reject(new Mr(Or.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new Cl(n,i,{includeMetadataChanges:!0,Du:!0});return Sl(t,o)}(await Od(t),t.asyncQueue,e,n,r))),r.promise}const Ld=new Map;function Vd(t,e,n){if(!n)throw new Mr(Or.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Fd(t,e,n,r){if(!0===e&&!0===r)throw new Mr(Or.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Pd(t){if(!es.isDocumentKey(t))throw new Mr(Or.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Bd(t){if(es.isDocumentKey(t))throw new Mr(Or.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Ud(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Ar()}function qd(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Mr(Or.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ud(t);throw new Mr(Or.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function jd(t,e){if(e<=0)throw new Mr(Or.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class Kd{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Mr(Or.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Mr(Or.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Fd("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Gd{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Kd({}),this._settingsFrozen=!1,t instanceof Ws?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Mr(Or.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ws(t.options.projectId)}(t))}get app(){if(!this._app)throw new Mr(Or.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Mr(Or.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Kd(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Vr;switch(t.type){case"gapi":const e=t.client;return Cr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ur(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Mr(Or.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Ld.get(t);e&&(Sr("ComponentProvider","Removing Datastore"),Ld.delete(t),e.terminate())}(this),Promise.resolve()}}function $d(t,e,n,r={}){var s;const i=(t=qd(t,Gd))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&xr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${n}`,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=vr.MOCK_USER;else{e=(0,a.Sg)(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Mr(Or.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new vr(i)}t._authCredentials=new Fr(new Lr(e,n))}}class zd{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Qd(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new zd(this.firestore,t,this._key)}}class Hd{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Hd(this.firestore,t,this._query)}}class Qd extends Hd{constructor(t,e,n){super(t,e,Hi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new zd(this.firestore,null,new es(t))}withConverter(t){return new Qd(this.firestore,t,this._path)}}function Wd(t,e,...n){if(t=(0,a.m9)(t),Vd("collection","path",e),t instanceof Gd){const r=Jr.fromString(e,...n);return Bd(r),new Qd(t,null,r)}{if(!(t instanceof zd||t instanceof Qd))throw new Mr(Or.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Jr.fromString(e,...n));return Bd(r),new Qd(t.firestore,null,r)}}function Xd(t,e){if(t=qd(t,Gd),Vd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Mr(Or.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Hd(t,null,function(t){return new $i(Jr.emptyPath(),t)}(e))}function Yd(t,e,...n){if(t=(0,a.m9)(t),1===arguments.length&&(e=$r.I()),Vd("doc","path",e),t instanceof Gd){const r=Jr.fromString(e,...n);return Pd(r),new zd(t,null,new es(r))}{if(!(t instanceof zd||t instanceof Qd))throw new Mr(Or.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Jr.fromString(e,...n));return Pd(r),new zd(t.firestore,t instanceof Qd?t.converter:null,new es(r))}}function Jd(t,e){return t=(0,a.m9)(t),e=(0,a.m9)(e),(t instanceof zd||t instanceof Qd)&&(e instanceof zd||e instanceof Qd)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Zd(t,e){return t=(0,a.m9)(t),e=(0,a.m9)(e),t instanceof Hd&&e instanceof Hd&&t.firestore===e.firestore&&eo(t._query,e._query)&&t.converter===e.converter}class tf{constructor(){this.Mc=Promise.resolve(),this.Oc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new Vh(this,"async_queue_retry"),this.Kc=()=>{const t=Rh();t&&Sr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.So.Eo()};const t=Rh();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Gc(),this.Qc(t)}enterRestrictedMode(t){if(!this.Fc){this.Fc=!0,this.Uc=t||!1;const e=Rh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Kc)}}enqueue(t){if(this.Gc(),this.Fc)return new Promise((()=>{}));const e=new Rr;return this.Qc((()=>this.Fc&&this.Uc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Oc.push(t),this.jc())))}async jc(){if(0!==this.Oc.length){try{await this.Oc[0](),this.Oc.shift(),this.So.reset()}catch(t){if(!Is(t))throw t;Sr("AsyncQueue","Operation failed with retryable error: "+t)}this.Oc.length>0&&this.So.Io((()=>this.jc()))}}Qc(t){const e=this.Mc.then((()=>(this.Lc=!0,t().catch((t=>{this.Bc=t,this.Lc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Dr("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Lc=!1,t))))));return this.Mc=e,e}enqueueAfterDelay(t,e,n){this.Gc(),this.qc.indexOf(t)>-1&&(e=0);const r=yl.createAndSchedule(this,t,e,n,(t=>this.Wc(t)));return this.$c.push(r),r}Gc(){this.Bc&&Ar()}verifyOperationInProgress(){}async zc(){let t;do{t=this.Mc,await t}while(t!==this.Mc)}Hc(t){for(const e of this.$c)if(e.timerId===t)return!0;return!1}Jc(t){return this.zc().then((()=>{this.$c.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.$c)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.zc()}))}Yc(t){this.qc.push(t)}Wc(t){const e=this.$c.indexOf(t);this.$c.splice(e,1)}}function ef(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class nf{constructor(){this._progressObserver={},this._taskCompletionResolver=new Rr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const rf=-1;class sf extends Gd{constructor(t,e,n){super(t,e,n),this.type="firestore",this._queue=new tf,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||uf(this),this._firestoreClient.terminate()}}function of(t,e){const n=(0,s.qX)(t,"firestore");if(n.isInitialized()){const t=n.getImmediate(),r=n.getOptions();if((0,a.vZ)(r,e))return t;throw new Mr(Or.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==e.cacheSizeBytes&&-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Mr(Or.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:e})}function af(t=(0,s.Mq)()){return(0,s.qX)(t,"firestore").getImmediate()}function cf(t){return t._firestoreClient||uf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function uf(t){var e;const n=t._freezeSettings(),r=function(t,e,n,r){return new Qs(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Td(t._authCredentials,t._appCheckCredentials,t._queue,r)}function hf(t,e){bf(t=qd(t,sf));const n=cf(t),r=t._freezeSettings(),s=new yd;return df(n,s,new gd(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function lf(t){bf(t=qd(t,sf));const e=cf(t),n=t._freezeSettings(),r=new yd;return df(e,r,new pd(r,n.cacheSizeBytes))}function df(t,e,n){const r=new Rr;return t.asyncQueue.enqueue((async()=>{try{await Sd(t,n),await Dd(t,e),r.resolve()}catch(t){const e=t;if(!function(t){return"FirebaseError"===t.name?t.code===Or.FAILED_PRECONDITION||t.code===Or.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(e))throw e;xr("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.reject(e)}})).then((()=>r.promise))}function ff(t){if(t._initialized&&!t._terminated)throw new Mr(Or.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Rr;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!ws.V())return Promise.resolve();const e=t+"main";await ws.delete(e)}(nh(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function mf(t){return function(t){const e=new Rr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=kr(t);Yh(n.remoteStore)||Sr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=kr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const r=n.uc.get(t)||[];r.push(e),n.uc.set(t,r)}catch(t){const n=wl(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await kd(t),e))),e.promise}(cf(t=qd(t,sf)))}function gf(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Ad(t),n=await Nd(t);return e.setNetworkEnabled(!0),function(t){const e=kr(t);return e.lu.delete(0),Kh(e)}(n)}))}(cf(t=qd(t,sf)))}function pf(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Ad(t),n=await Nd(t);return e.setNetworkEnabled(!1),async function(t){const e=kr(t);e.lu.add(0),await Gh(e),e._u.set("Offline")}(n)}))}(cf(t=qd(t,sf)))}function yf(t){return(0,s.wN)(t.app,"firestore"),t._delete()}function wf(t,e){const n=cf(t=qd(t,sf)),r=new nf;return function(t,e,n,r){const s=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new bd(t,e)}(function(t,e){if(t instanceof Uint8Array)return wd(t,e);if(t instanceof ArrayBuffer)return wd(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,Lh(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const r=kr(t);(async function(t,e,n){try{const r=await e.getMetadata();if(await function(t,e){const n=kr(t),r=Ia(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Ds.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(r)>=0))}(t.localStore,r))return await e.close(),n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(Ml(r));const s=new Ol(r,t.localStore,e.wt);let i=await e.fc();for(;i;){const t=await s.Nu(i);t&&n._updateProgress(t),i=await e.fc()}const o=await s.complete();return await ed(t,o.Ou,void 0),await function(t,e){const n=kr(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Ds.saveBundleMetadata(t,e)))}(t.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Mu)}catch(t){return xr("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t),Promise.resolve(new Set)}})(r,e,n).then((t=>{r.sharedClientState.notifyBundleLoaded(t)}))}(await kd(t),s,r)}))}(n,t._databaseId,e,r),r}function vf(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=kr(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Ds.getNamedQuery(t,e)))}(await Cd(t),e)))}(cf(t=qd(t,sf)),e).then((e=>e?new Hd(t,null,e.query):null))}function bf(t){if(t._initialized||t._terminated)throw new Mr(Or.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class If{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Mr(Or.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ts(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}function Ef(){return new If("__name__")}class Tf{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Tf(Us.fromBase64String(t))}catch(t){throw new Mr(Or.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Tf(Us.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Sf{constructor(t){this._methodName=t}}class Df{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Mr(Or.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Mr(Or.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return zr(this._lat,t._lat)||zr(this._long,t._long)}}const xf=/^__.*__$/;class _f{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Lo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ro(t,this.data,e,this.fieldTransforms)}}class Af{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Lo(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Cf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ar()}}class Nf{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.wt=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Xc(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Zc(){return this.settings.Zc}ta(t){return new Nf(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ea(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.ta({path:n,na:!1});return r.sa(t),r}ia(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.ta({path:n,na:!1});return r.Xc(),r}ra(t){return this.ta({path:void 0,na:!0})}oa(t){return Xf(t,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Xc(){if(this.path)for(let t=0;t<this.path.length;t++)this.sa(this.path.get(t))}sa(t){if(0===t.length)throw this.oa("Document fields must not be empty");if(Cf(this.Zc)&&xf.test(t))throw this.oa('Document fields cannot begin and end with "__"')}}class kf{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.wt=n||Lh(t)}aa(t,e,n,r=!1){return new Nf({Zc:t,methodName:e,ca:n,path:ts.emptyPath(),na:!1,ua:r},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}function Of(t){const e=t._freezeSettings(),n=Lh(t._databaseId);return new kf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Mf(t,e,n,r,s,i={}){const o=t.aa(i.merge||i.mergeFields?2:0,e,n,s);zf("Data must be an object, but it was:",o,r);const a=Gf(r,o);let c,u;if(i.merge)c=new Ps(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=Hf(e,r,n);if(!o.contains(s))throw new Mr(Or.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Yf(t,s)||t.push(s)}c=new Ps(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new _f(new bi(a),c,u)}class Rf extends Sf{_toFieldTransform(t){if(2!==t.Zc)throw 1===t.Zc?t.oa(`${this._methodName}() can only appear at the top level of your update data`):t.oa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Rf}}function Lf(t,e,n){return new Nf({Zc:3,ca:e.settings.ca,methodName:t._methodName,na:n},e.databaseId,e.wt,e.ignoreUndefinedProperties)}class Vf extends Sf{_toFieldTransform(t){return new So(t.path,new po)}isEqual(t){return t instanceof Vf}}class Ff extends Sf{constructor(t,e){super(t),this.ha=e}_toFieldTransform(t){const e=Lf(this,t,!0),n=this.ha.map((t=>Kf(t,e))),r=new yo(n);return new So(t.path,r)}isEqual(t){return this===t}}class Pf extends Sf{constructor(t,e){super(t),this.ha=e}_toFieldTransform(t){const e=Lf(this,t,!0),n=this.ha.map((t=>Kf(t,e))),r=new vo(n);return new So(t.path,r)}isEqual(t){return this===t}}class Bf extends Sf{constructor(t,e){super(t),this.la=e}_toFieldTransform(t){const e=new Io(t.wt,ho(t.wt,this.la));return new So(t.path,e)}isEqual(t){return this===t}}function Uf(t,e,n,r){const s=t.aa(1,e,n);zf("Data must be an object, but it was:",s,r);const i=[],o=bi.empty();Ns(r,((t,r)=>{const c=Wf(e,t,n);r=(0,a.m9)(r);const u=s.ia(c);if(r instanceof Rf)i.push(c);else{const t=Kf(r,u);null!=t&&(i.push(c),o.set(c,t))}}));const c=new Ps(i);return new Af(o,c,s.fieldTransforms)}function qf(t,e,n,r,s,i){const o=t.aa(1,e,n),c=[Hf(e,r,n)],u=[s];if(i.length%2!=0)throw new Mr(Or.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)c.push(Hf(e,i[t])),u.push(i[t+1]);const h=[],l=bi.empty();for(let t=c.length-1;t>=0;--t)if(!Yf(h,c[t])){const e=c[t];let n=u[t];n=(0,a.m9)(n);const r=o.ia(e);if(n instanceof Rf)h.push(e);else{const t=Kf(n,r);null!=t&&(h.push(e),l.set(e,t))}}const d=new Ps(h);return new Af(l,d,o.fieldTransforms)}function jf(t,e,n,r=!1){return Kf(n,t.aa(r?4:3,e))}function Kf(t,e){if($f(t=(0,a.m9)(t)))return zf("Unsupported field value:",e,t),Gf(t,e);if(t instanceof Sf)return function(t,e){if(!Cf(e.Zc))throw e.oa(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.oa(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.na&&4!==e.Zc)throw e.oa("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=Kf(s,e.ra(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,a.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ho(e.wt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Wr.fromDate(t);return{timestampValue:wa(e.wt,n)}}if(t instanceof Wr){const n=new Wr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:wa(e.wt,n)}}if(t instanceof Df)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Tf)return{bytesValue:va(e.wt,t._byteString)};if(t instanceof zd){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.oa(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ea(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.oa(`Unsupported field value: ${Ud(t)}`)}(t,e)}function Gf(t,e){const n={};return ks(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ns(t,((t,r)=>{const s=Kf(r,e.ea(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function $f(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Wr||t instanceof Df||t instanceof Tf||t instanceof zd||t instanceof Sf)}function zf(t,e,n){if(!$f(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Ud(n);throw"an object"===r?e.oa(t+" a custom object"):e.oa(t+" "+r)}}function Hf(t,e,n){if((e=(0,a.m9)(e))instanceof If)return e._internalPath;if("string"==typeof e)return Wf(t,e);throw Xf("Field path arguments must be of type string or ",t,!1,void 0,n)}const Qf=new RegExp("[~\\*/\\[\\]]");function Wf(t,e,n){if(e.search(Qf)>=0)throw Xf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new If(...e.split("."))._internalPath}catch(r){throw Xf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Xf(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new Mr(Or.INVALID_ARGUMENT,a+t+c)}function Yf(t,e){return t.some((t=>t.isEqual(e)))}class Jf{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new zd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Zf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(tm("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Zf extends Jf{data(){return super.data()}}function tm(t,e){return"string"==typeof e?Wf(t,e):e instanceof If?e._internalPath:e._delegate._internalPath}class em{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class nm extends Jf{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new rm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(tm("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class rm extends nm{data(t={}){return super.data(t)}}class sm{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new em(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new rm(this._firestore,this._userDataWriter,n.key,n,new em(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Mr(Or.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new rm(t._firestore,t._userDataWriter,n.doc.key,n.doc,new em(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new rm(t._firestore,t._userDataWriter,e.doc.key,e.doc,new em(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:im(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function im(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ar()}}function om(t,e){return t instanceof nm&&e instanceof nm?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof sm&&e instanceof sm&&t._firestore===e._firestore&&Zd(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function am(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Mr(Or.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cm{}function um(t,...e){for(const n of e)t=n._apply(t);return t}class hm extends cm{constructor(t,e,n){super(),this.fa=t,this.da=e,this._a=n,this.type="where"}_apply(t){const e=Of(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Mr(Or.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){Dm(o,i);const e=[];for(const n of o)e.push(Sm(r,t,n));a={arrayValue:{values:e}}}else a=Sm(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Dm(o,i),a=jf(n,"where",o,"in"===i||"not-in"===i);const c=ki.create(s,i,a);return function(t,e){if(e.ht()){const n=Xi(t);if(null!==n&&!n.isEqual(e.field))throw new Mr(Or.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=Wi(t);null!==r&&xm(0,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Mr(Or.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Mr(Or.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,c),c}(t._query,0,e,t.firestore._databaseId,this.fa,this.da,this._a);return new Hd(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new $i(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function lm(t,e,n){const r=e,s=tm("where",t);return new hm(s,r,n)}class dm extends cm{constructor(t,e){super(),this.fa=t,this.wa=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Mr(Or.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Mr(Or.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new qi(e,n);return function(t,e){if(null===Wi(t)){const n=Xi(t);null!==n&&xm(0,n,e.field)}}(t,r),r}(t._query,this.fa,this.wa);return new Hd(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new $i(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function fm(t,e="asc"){const n=e,r=tm("orderBy",t);return new dm(r,n)}class mm extends cm{constructor(t,e,n){super(),this.type=t,this.ma=e,this.ga=n}_apply(t){return new Hd(t.firestore,t.converter,to(t._query,this.ma,this.ga))}}function gm(t){return jd("limit",t),new mm("limit",t,"F")}function pm(t){return jd("limitToLast",t),new mm("limitToLast",t,"L")}class ym extends cm{constructor(t,e,n){super(),this.type=t,this.ya=e,this.pa=n}_apply(t){const e=Tm(t,this.type,this.ya,this.pa);return new Hd(t.firestore,t.converter,function(t,e){return new $i(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function wm(...t){return new ym("startAt",t,!0)}function vm(...t){return new ym("startAfter",t,!1)}class bm extends cm{constructor(t,e,n){super(),this.type=t,this.ya=e,this.pa=n}_apply(t){const e=Tm(t,this.type,this.ya,this.pa);return new Hd(t.firestore,t.converter,function(t,e){return new $i(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function Im(...t){return new bm("endBefore",t,!1)}function Em(...t){return new bm("endAt",t,!0)}function Tm(t,e,n,r){if(n[0]=(0,a.m9)(n[0]),n[0]instanceof Jf)return function(t,e,n,r,s){if(!r)throw new Mr(Or.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of Ji(t))if(n.field.isKeyField())i.push(ci(e,r.key));else{const t=r.data.field(n.field);if($s(t))throw new Mr(Or.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new Mr(Or.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new Ui(i,s)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=Of(t.firestore);return function(t,e,n,r,s,i){const o=t.explicitOrderBy;if(s.length>o.length)throw new Mr(Or.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<s.length;i++){const c=s[i];if(o[i].field.isKeyField()){if("string"!=typeof c)throw new Mr(Or.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Yi(t)&&-1!==c.indexOf("/"))throw new Mr(Or.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=t.path.child(Jr.fromString(c));if(!es.isDocumentKey(n))throw new Mr(Or.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new es(n);a.push(ci(e,s))}else{const t=jf(n,r,c);a.push(t)}}return new Ui(a,i)}(t._query,t.firestore._databaseId,s,e,n,r)}}function Sm(t,e,n){if("string"==typeof(n=(0,a.m9)(n))){if(""===n)throw new Mr(Or.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yi(e)&&-1!==n.indexOf("/"))throw new Mr(Or.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Jr.fromString(n));if(!es.isDocumentKey(r))throw new Mr(Or.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ci(t,new es(r))}if(n instanceof zd)return ci(t,n._key);throw new Mr(Or.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ud(n)}.`)}function Dm(t,e){if(!Array.isArray(t)||0===t.length)throw new Mr(Or.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Mr(Or.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function xm(t,e,n){if(!n.isEqual(e))throw new Mr(Or.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}const _m={maxAttempts:5};class Am{convertValue(t,e="none"){switch(ei(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ks(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Gs(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Ar()}}convertObject(t,e){const n={};return Ns(t.fields,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Df(Ks(t.latitude),Ks(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=zs(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Hs(t));default:return null}}convertTimestamp(t){const e=js(t);return new Wr(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Jr.fromString(t);Cr($a(n));const r=new Ws(n.get(1),n.get(3)),s=new es(n.popFirst(5));return r.isEqual(e)||Dr(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}function Cm(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Nm extends Am{constructor(t){super(),this.firestore=t}convertBytes(t){return new Tf(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new zd(this.firestore,null,e)}}class km{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Of(t)}set(t,e,n){this._verifyNotCommitted();const r=Om(t,this._firestore),s=Cm(r.converter,e,n),i=Mf(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,xo.none())),this}update(t,e,n,...r){this._verifyNotCommitted();const s=Om(t,this._firestore);let i;return i="string"==typeof(e=(0,a.m9)(e))||e instanceof If?qf(this._dataReader,"WriteBatch.update",s._key,e,n,r):Uf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(i.toMutation(s._key,xo.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=Om(t,this._firestore);return this._mutations=this._mutations.concat(new Bo(e._key,xo.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Mr(Or.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Om(t,e){if((t=(0,a.m9)(t)).firestore!==e)throw new Mr(Or.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Mm(t){t=qd(t,zd);const e=qd(t.firestore,sf);return Md(cf(e),t._key).then((n=>Hm(e,t,n)))}class Rm extends Am{constructor(t){super(),this.firestore=t}convertBytes(t){return new Tf(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new zd(this.firestore,null,e)}}function Lm(t){t=qd(t,zd);const e=qd(t.firestore,sf),n=cf(e),r=new Rm(e);return function(t,e){const n=new Rr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await function(t,e){const n=kr(t);return n.persistence.runTransaction("read document","readonly",(t=>n.localDocuments.getDocument(t,e)))}(t,e);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Mr(Or.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const r=wl(t,`Failed to get document '${e} from cache`);n.reject(r)}}(await Cd(t),e,n))),n.promise}(n,t._key).then((n=>new nm(e,r,t._key,n,new em(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Vm(t){t=qd(t,zd);const e=qd(t.firestore,sf);return Md(cf(e),t._key,{source:"server"}).then((n=>Hm(e,t,n)))}function Fm(t){t=qd(t,Hd);const e=qd(t.firestore,sf),n=cf(e),r=new Rm(e);return am(t._query),Rd(n,t._query).then((n=>new sm(e,r,t,n)))}function Pm(t){t=qd(t,Hd);const e=qd(t.firestore,sf),n=cf(e),r=new Rm(e);return function(t,e){const n=new Rr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await fh(t,e,!0),s=new Vl(e,r.ji),i=s.Ku(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(t){const r=wl(t,`Failed to execute query '${e} against cache`);n.reject(r)}}(await Cd(t),e,n))),n.promise}(n,t._query).then((n=>new sm(e,r,t,n)))}function Bm(t){t=qd(t,Hd);const e=qd(t.firestore,sf),n=cf(e),r=new Rm(e);return Rd(n,t._query,{source:"server"}).then((n=>new sm(e,r,t,n)))}function Um(t,e,n){t=qd(t,zd);const r=qd(t.firestore,sf),s=Cm(t.converter,e,n);return zm(r,[Mf(Of(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,xo.none())])}function qm(t,e,n,...r){t=qd(t,zd);const s=qd(t.firestore,sf),i=Of(s);let o;return o="string"==typeof(e=(0,a.m9)(e))||e instanceof If?qf(i,"updateDoc",t._key,e,n,r):Uf(i,"updateDoc",t._key,e),zm(s,[o.toMutation(t._key,xo.exists(!0))])}function jm(t){return zm(qd(t.firestore,sf),[new Bo(t._key,xo.none())])}function Km(t,e){const n=qd(t.firestore,sf),r=Yd(t),s=Cm(t.converter,e);return zm(n,[Mf(Of(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,xo.exists(!1))]).then((()=>r))}function Gm(t,...e){var n,r,s;t=(0,a.m9)(t);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||ef(e[o])||(i=e[o],o++);const c={includeMetadataChanges:i.includeMetadataChanges};if(ef(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}let u,h,l;if(t instanceof zd)h=qd(t.firestore,sf),l=Hi(t._key.path),u={next:n=>{e[o]&&e[o](Hm(h,t,n))},error:e[o+1],complete:e[o+2]};else{const n=qd(t,Hd);h=qd(n.firestore,sf),l=n._query;const r=new Rm(h);u={next:t=>{e[o]&&e[o](new sm(h,r,n,t))},error:e[o+1],complete:e[o+2]},am(t._query)}return function(t,e,n,r){const s=new vd(r),i=new Cl(e,s,n);return t.asyncQueue.enqueueAndForget((async()=>Sl(await Od(t),i))),()=>{s.Tc(),t.asyncQueue.enqueueAndForget((async()=>Dl(await Od(t),i)))}}(cf(h),l,c,u)}function $m(t,e){return function(t,e){const n=new vd(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){kr(t).Tu.add(e),e.next()}(await Od(t),n))),()=>{n.Tc(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){kr(t).Tu.delete(e)}(await Od(t),n)))}}(cf(t=qd(t,sf)),ef(e)?e:{next:e})}function zm(t,e){return function(t,e){const n=new Rr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=fd(t);try{const t=await function(t,e){const n=kr(t),r=Wr.now(),s=e.reduce(((t,e)=>t.add(e.key)),ra());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Qo(),c=ra();return n.Ui.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{i=s;const o=[];for(const t of e){const e=Oo(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new Lo(t.key,e,Ii(e.value.mapValue),xo.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Yo(i)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.oc[t.currentUser.toKey()];r||(r=new Os(zr)),r=r.insert(e,n),t.oc[t.currentUser.toKey()]=r}(r,t.batchId,n),await ed(r,t.changes),await sl(r.remoteStore)}catch(t){const e=wl(t,"Failed to persist write");n.reject(e)}}(await kd(t),e,n))),n.promise}(cf(t),e)}function Hm(t,e,n){const r=n.docs.get(e._key),s=new Rm(t);return new nm(t,s,e._key,r,new em(n.hasPendingWrites,n.fromCache),e.converter)}class Qm extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Of(t)}get(t){const e=Om(t,this._firestore),n=new Nm(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return Ar();const r=t[0];if(r.isFoundDocument())return new Jf(this._firestore,n,r.key,r,e.converter);if(r.isNoDocument())return new Jf(this._firestore,n,e._key,null,e.converter);throw Ar()}))}set(t,e,n){const r=Om(t,this._firestore),s=Cm(r.converter,e,n),i=Mf(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(t,e,n,...r){const s=Om(t,this._firestore);let i;return i="string"==typeof(e=(0,a.m9)(e))||e instanceof If?qf(this._dataReader,"Transaction.update",s._key,e,n,r):Uf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,i),this}delete(t){const e=Om(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=Om(t,this._firestore),n=new Rm(this._firestore);return super.get(t).then((t=>new nm(this._firestore,n,e._key,t._document,new em(!1,!1),e.converter)))}}function Wm(t,e,n){t=qd(t,sf);const r=Object.assign(Object.assign({},_m),n);return function(t){if(t.maxAttempts<1)throw new Mr(Or.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(t,e,n){const r=new Rr;return t.asyncQueue.enqueueAndForget((async()=>{const s=await function(t){return _d(t).then((t=>t.datastore))}(t);new Ed(t.asyncQueue,s,n,e,r).run()})),r.promise}(cf(t),(n=>e(new Qm(t,n))),r)}function Xm(){return new Rf("deleteField")}function Ym(){return new Vf("serverTimestamp")}function Jm(...t){return new Ff("arrayUnion",t)}function Zm(...t){return new Pf("arrayRemove",t)}function tg(t){return new Bf("increment",t)}function eg(t){return cf(t=qd(t,sf)),new km(t,(e=>zm(t,e)))}function ng(t,e){var n;const r=cf(t=qd(t,sf));if(!(null===(n=r.offlineComponents)||void 0===n?void 0:n.indexBackfillerScheduler))return xr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const s=function(t){const e="string"==typeof t?function(t){var e;try{return JSON.parse(t)}catch(t){throw new Mr(Or.INVALID_ARGUMENT,"Failed to parse JSON: "+(null===(e=t)||void 0===e?void 0:e.message))}}(t):t,n=[];if(Array.isArray(e.indexes))for(const t of e.indexes){const e=rg(t,"collectionGroup"),r=[];if(Array.isArray(t.fields))for(const e of t.fields){const t=Wf("setIndexConfiguration",rg(e,"fieldPath"));"CONTAINS"===e.arrayConfig?r.push(new os(t,2)):"ASCENDING"===e.order?r.push(new os(t,0)):"DESCENDING"===e.order&&r.push(new os(t,1))}n.push(new ns(ns.UNKNOWN_ID,e,r,cs.empty()))}return n}(e);return Cd(r).then((t=>async function(t,e){const n=kr(t),r=n.indexManager,s=[];return n.persistence.runTransaction("Configure indexes","readwrite",(t=>r.getFieldIndexes(t).next((n=>function(t,e,n,r,s){t=[...t],e=[...e],t.sort(n),e.sort(n);const i=t.length,o=e.length;let a=0,c=0;for(;a<o&&c<i;){const i=n(t[c],e[a]);i<0?s(t[c++]):i>0?r(e[a++]):(a++,c++)}for(;a<o;)r(e[a++]);for(;c<i;)s(t[c++])}(n,e,is,(e=>{s.push(r.addFieldIndex(t,e))}),(e=>{s.push(r.deleteFieldIndex(t,e))})))).next((()=>ps.waitFor(s)))))}(t,s)))}function rg(t,e){if("string"!=typeof t[e])throw new Mr(Or.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}!function(t,e=!0){!function(t){br=t}(s.Jn),(0,s.Xd)(new i.wA("firestore",((t,{options:n})=>{const r=t.getProvider("app").getImmediate(),s=new sf(r,new Pr(t.getProvider("auth-internal")),new jr(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),s._setSettings(n),s}),"PUBLIC")),(0,s.KN)(wr,"3.4.14",t),(0,s.KN)(wr,"3.4.14","esm2017")}()},770:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};e.__esModule=!0;var i,o=n(503),a=n(591),c=(0,o.initializeApp)({apiKey:"AIzaSyB-fs9R5apksupNHBHzBAUyegC36dEnD7Y",authDomain:"reservare-49dae.firebaseapp.com",databaseURL:"https://reservare-49dae-default-rtdb.europe-west1.firebasedatabase.app",projectId:"reservare-49dae",storageBucket:"reservare-49dae.appspot.com",messagingSenderId:"457704470781",appId:"1:457704470781:web:e48786e9d863bcaf6ba694",measurementId:"G-GZC437KJ4Y"}),u=(0,a.getFirestore)(c),h=document.querySelector(".nume"),l=document.querySelector(".prenume"),d=document.querySelector(".email"),f=document.querySelector(".info.gen"),m=document.querySelector(".serviciu.nr1"),g=(document.querySelector(".pret.n1"),document.querySelector(".pret.n2"),document.querySelector(".data_text")),p=document.querySelector(".data_text_sec"),y=document.querySelector(".an"),w=document.querySelector(".luna"),v=document.querySelector(".zi"),b=document.querySelector(".ora"),I=[31,28,31,30,31,30,31,31,30,31,30,31],E=["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],T=["12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"],S=new Date,D=S.getMonth(),x=S.getFullYear(),_=S.getDate(),A=S.getHours(),C=S.getMinutes(),N=0,k=1;function O(t,e,n,r){for(var s,o=!1,a=0,c=i.docs;a<c.length;a++){s=c[a];var u=JSON.parse(s.id);if(u.an==t&&u.luna==e&&u.zi==n&&u.ora==r){o=!0;break}}return o}function M(t){for(var e=t;e<I.length;e++){var n=document.createElement("option");n.text=E[e],n.value=(e+1).toString(),w.add(n)}}function R(t){for(var e=t;e<=I[Number.parseInt(w.options[w.selectedIndex].value)-k];e++){var n=document.createElement("option");n.innerText=e.toString(),n.value=e.toString(),v.add(n)}}function L(t){for(var e=t;e<T.length;e++)if(0==O(y.options[y.selectedIndex].innerText,w.options[w.selectedIndex].innerText,v.options[v.selectedIndex].innerText,T[e])){var n=document.createElement("option");n.text=T[e],n.value=T[e],b.add(n)}}function V(){if(b.length<0){var t=document.createElement("option");t.text="Indisponibil",t.value="0",b.add(t)}}function F(){p.textContent="".concat(v.options[v.selectedIndex].text," ").concat(w.options[w.selectedIndex].text,", ora ").concat("0"==b.options[b.selectedIndex].value?"indisponibila":b.options[b.selectedIndex].text)}function P(){for(;v.length>0;)v.remove(v.lastChild)}function B(){for(;b.length>0;)b.remove(b.lastChild)}function U(){return r(this,void 0,void 0,(function(){var t;return s(this,(function(e){return g.textContent="".concat("Barbat"==f.options[f.selectedIndex].innerText?"Sunteti programat pentru data de":"Sunteti programata pentru data de"),b.remove(b.options[b.selectedIndex].index),0==b.length&&((t=document.createElement("option")).text="Indisponibil",t.value="0",b.add(t)),F(),[2]}))}))}function q(t){return!!/^[a-zA-Z-'. ]+$/.test(t)}window.onload=function(){return r(void 0,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e=window.navigator.userAgent,n=window.navigator.platform,r=null,-1!==["Macintosh","MacIntel","MacPPC","Mac68K","Darwin"].indexOf(n)?r="Mac":-1!==["iPhone","iPad","iPod"].indexOf(n)?r="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(n)?r="Windows":/Android/.test(e)?r="Android":/Linux/.test(n)&&(r="Linux"),"Mac"!=r&&"Windows"!=r&&"Linux"!=r||(document.querySelector(".os_style").href="./dist/pcstyle.css"),[4,(0,a.getDocs)((0,a.collection)(u,"clients"))];case 1:return i=t.sent(),function(){for(var t=0;t<=1;t++){var e=document.createElement("option"),n=(x+t).toString();e.text=n,e.value=n,y.add(e)}}(),function(){if(Number.parseInt(T[T.length-1].substring(0,2))<A)_==I[D]?(D++,k=0,_=1):_++;else for(var t=0;t<T.length;t++)if(A<=Number.parseInt(T[t].substring(0,2))){if(A==Number.parseInt(T[t].substring(0,2))){if(C<=Number.parseInt(T[t].substring(3))){N=t;break}N=t+2;break}N=t;break}}(),M(D),R(_),L(N),V(),F(),[2]}var e,n,r}))}))},f.onchange=function(){f.blur()},y.onchange=function(){y.blur(),function(){for(;w.length>0;)w.remove(w.lastChild)}(),y.options[y.selectedIndex].value!=x.toString()?M(0):M(D),P(),B(),Number.parseInt(w.options[w.selectedIndex].value)-k==D&&Number.parseInt(y.options[y.selectedIndex].value)==x?(R(_),L(N)):(R(1),L(0)),V(),F()},w.onchange=function(){w.blur(),P(),B(),Number.parseInt(w.options[w.selectedIndex].value)-k==D&&Number.parseInt(y.options[y.selectedIndex].value)==x?(R(_),L(N)):(R(1),L(0)),V(),F()},v.onchange=function(){v.blur(),Number.parseInt(y.options[y.selectedIndex].value)==x&&Number.parseInt(w.options[w.selectedIndex].value)-k==D&&Number.parseInt(v.options[v.selectedIndex].value)==_&&0!=N?(B(),L(N)):Number.parseInt(v.options[v.selectedIndex].value)!=_&&0!=N&&(B(),L(0)),V(),F()},b.onchange=function(){b.blur(),F()};var j=document.querySelector(".send_btn");j.addEventListener("click",(function(){h.style.borderColor="#acacac",l.style.borderColor="#acacac",d.style.borderColor="#acacac",m.style.background="#5F8575";var t=h.value;if(0==q(t))return h.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),void(h.style.borderColor="#FF6347");var e=l.value;if(0==q(e))return l.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),void(l.style.borderColor="#FF6347");var n=d.value;if(0==!!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(n))return d.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),void(d.style.borderColor="#FF6347");var o=f.options[f.selectedIndex].innerText,c=[],g=!1;if(document.querySelectorAll(".chk").forEach((function(t){1==t.checked&&(c.push(t.value),g=!0)})),0==g)return m.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),void(m.style.background="#FF6347");var p=y.options[y.selectedIndex].innerText,I=w.options[w.selectedIndex].innerText,E=v.options[v.selectedIndex].innerText,T=b.options[b.selectedIndex].innerText;!function(t,e,n,o,c,h,l,d,f,m){r(this,void 0,void 0,(function(){var r;return s(this,(function(s){switch(s.label){case 0:return r='{"an":"'.concat(l,'", "luna":"').concat(d,'", "zi":"').concat(f,'", "ora":"').concat(m,'"}'),[4,U()];case 1:return s.sent(),document.querySelector(".fa-check-double").style.opacity="1",[4,(0,a.setDoc)((0,a.doc)(u,"clients",r),{A_nume:t,B_prenume:e,C_mail:n,D_Gen:o,E_tip_serviciu:c,F_pret:"250",G_An:l,H_luna:d,I_ziua:f,J_ora:m})];case 2:return s.sent(),[4,(0,a.getDocs)((0,a.collection)(u,"clients"))];case 3:return i=s.sent(),[2]}}))}))}(t,e,n,o,c,0,p,I,E,T),j.style.pointerEvents="none",setTimeout((function(){j.style.pointerEvents="all"}),1e4)}))},389:(t,e,n)=>{n.d(e,{ZR:()=>i.ZR,Jn:()=>P,l4:()=>x,H9:()=>N,Vr:()=>k,Af:()=>A,Z8:()=>L,lz:()=>C,qX:()=>M,Xd:()=>O,wN:()=>R,P2:()=>j,Mq:()=>U,C6:()=>q,ZF:()=>B,TP:()=>G,KN:()=>K,Ub:()=>$});var r=n(463),s=n(333),i=n(444);let o,a;const c=new WeakMap,u=new WeakMap,h=new WeakMap,l=new WeakMap,d=new WeakMap;let f={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return u.get(t);if("objectStoreNames"===e)return t.objectStoreNames||h.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function m(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(p(this),t),g(c.get(this))}:function(...t){return g(e.apply(p(this),t))}:function(t,...n){const r=e.call(p(this),t,...n);return h.set(r,t.sort?t.sort():[t]),g(r)}:(t instanceof IDBTransaction&&function(t){if(u.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));u.set(t,e)}(t),n=t,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,f):t);var e,n}function g(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(g(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&c.set(e,t)})).catch((()=>{})),d.set(e,t),e}(t);if(l.has(t))return l.get(t);const e=m(t);return e!==t&&(l.set(t,e),d.set(e,t)),e}const p=t=>d.get(t),y=["get","getKey","getAll","getAllKeys","count"],w=["put","add","delete","clear"],v=new Map;function b(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(v.get(e))return v.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=w.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!y.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return v.set(e,i),i}var I;I=f,f={...I,get:(t,e,n)=>b(t,e)||I.get(t,e,n),has:(t,e)=>!!b(t,e)||I.has(t,e)};class E{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const T="@firebase/app",S="0.7.30",D=new s.Yd("@firebase/app"),x="[DEFAULT]",_={[T]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},A=new Map,C=new Map;function N(t,e){try{t.container.addComponent(e)}catch(n){D.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function k(t,e){t.container.addOrOverwriteComponent(e)}function O(t){const e=t.name;if(C.has(e))return D.debug(`There were multiple attempts to register component ${e}.`),!1;C.set(e,t);for(const e of A.values())N(e,t);return!0}function M(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function R(t,e,n=x){M(t,e).clearInstance(n)}function L(){C.clear()}const V=new i.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class F{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw V.create("app-deleted",{appName:this._name})}}const P="9.9.2";function B(t,e={}){"object"!=typeof e&&(e={name:e});const n=Object.assign({name:x,automaticDataCollectionEnabled:!1},e),s=n.name;if("string"!=typeof s||!s)throw V.create("bad-app-name",{appName:String(s)});const o=A.get(s);if(o){if((0,i.vZ)(t,o.options)&&(0,i.vZ)(n,o.config))return o;throw V.create("duplicate-app",{appName:s})}const a=new r.H0(s);for(const t of C.values())a.addComponent(t);const c=new F(t,n,a);return A.set(s,c),c}function U(t=x){const e=A.get(t);if(!e)throw V.create("no-app",{appName:t});return e}function q(){return Array.from(A.values())}async function j(t){const e=t.name;A.has(e)&&(A.delete(e),await Promise.all(t.container.getProviders().map((t=>t.delete()))),t.isDeleted=!0)}function K(t,e,n){var s;let i=null!==(s=_[t])&&void 0!==s?s:t;n&&(i+=`-${n}`);const o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const t=[`Unable to register library "${i}" with version "${e}":`];return o&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&t.push("and"),a&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void D.warn(t.join(" "))}O(new r.wA(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}function G(t,e){if(null!==t&&"function"!=typeof t)throw V.create("invalid-log-argument");(0,s.Am)(t,e)}function $(t){(0,s.Ub)(t)}const z="firebase-heartbeat-store";let H=null;function Q(){return H||(H=function(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=g(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(g(o.result),t.oldVersion,t.newVersion,g(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(z)}}).catch((t=>{throw V.create("idb-open",{originalErrorMessage:t.message})}))),H}async function W(t,e){var n;try{const n=(await Q()).transaction(z,"readwrite"),r=n.objectStore(z);return await r.put(e,X(t)),n.done}catch(t){if(t instanceof i.ZR)D.warn(t.message);else{const e=V.create("idb-set",{originalErrorMessage:null===(n=t)||void 0===n?void 0:n.message});D.warn(e.message)}}}function X(t){return`${t.name}!${t.options.appId}`}class Y{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Z(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=J();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=J(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),tt(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),tt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,i.L)(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function J(){return(new Date).toISOString().substring(0,10)}class Z{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,i.hl)()&&(0,i.eu)().then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(t){var e;try{return(await Q()).transaction(z).objectStore(z).get(X(t))}catch(t){if(t instanceof i.ZR)D.warn(t.message);else{const n=V.create("idb-get",{originalErrorMessage:null===(e=t)||void 0===e?void 0:e.message});D.warn(n.message)}}}(this.app)||{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return W(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return W(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function tt(t){return(0,i.L)(JSON.stringify({version:2,heartbeats:t})).length}O(new r.wA("platform-logger",(t=>new E(t)),"PRIVATE")),O(new r.wA("heartbeat",(t=>new Y(t)),"PRIVATE")),K(T,S,""),K(T,S,"esm2017"),K("fire-js","")},463:(t,e,n)=>{n.d(e,{H0:()=>a,wA:()=>s});var r=n(444);class s{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const i="[DEFAULT]";class o{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new r.BH;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:i})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===i?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:i:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new o(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},333:(t,e,n)=>{n.d(e,{Am:()=>l,Ub:()=>h,Yd:()=>u,in:()=>s});const r=[];var s;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(s||(s={}));const i={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},o=s.INFO,a={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},c=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=a[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)};class u{constructor(t){this.name=t,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in s))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?i[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...t),this._logHandler(this,s.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...t),this._logHandler(this,s.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,s.INFO,...t),this._logHandler(this,s.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,s.WARN,...t),this._logHandler(this,s.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...t),this._logHandler(this,s.ERROR,...t)}}function h(t){r.forEach((e=>{e.setLogLevel(t)}))}function l(t,e){for(const n of r){let r=null;e&&e.level&&(r=i[e.level]),n.userLogHandler=null===t?null:(e,n,...i)=>{const o=i.map((t=>{if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((t=>t)).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:s[n].toLowerCase(),message:o,args:i,type:e.name})}}}}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(770)})();